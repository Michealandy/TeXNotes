<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 13.1.1"/>
    <title>manage API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Helper">Helper</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Helper.help">help</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.addtodocuments">addtodocuments</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.newnote">newnote</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.newproject">newproject</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.list_recent_files">list_recent_files</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.rename_recent">rename_recent</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.rename_file">rename_file</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.rename_reference">rename_reference</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.remove_note">remove_note</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.render">render</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.render_all">render_all</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.biber">biber</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.render_all_html">render_all_html</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.render_all_pdf">render_all_pdf</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.render_updates">render_updates</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.synchronize">synchronize</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.force_synchronize">force_synchronize</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.list_unreferenced">list_unreferenced</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.edit">edit</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.to_md">to_md</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.export_project">export_project</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.export_draft">export_draft</a>
                        </li>
                        <li>
                                <a class="function" href="#Helper.list_citations">list_citations</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
manage    </h1>

                
                        <input id="mod-manage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-manage-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/bin/python3</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">shutil</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">from</span> <span class="nn">LatexZettel</span> <span class="kn">import</span> <span class="n">files</span><span class="p">,</span> <span class="n">database</span> 
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">import</span> <span class="nn">peewee</span> <span class="k">as</span> <span class="nn">pw</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">import</span> <span class="nn">datetime</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">platform</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="n">OPEN_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;xdg-open&#39;</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Darwin&#39;</span><span class="p">:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>    <span class="n">OPEN_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;open&#39;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="k">elif</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Windows&#39;</span><span class="p">:</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a>    <span class="n">OPEN_COMMAND</span> <span class="o">=</span> <span class="s1">&#39;start&#39;</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="k">class</span> <span class="nc">Helper</span><span class="p">:</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="sd">        Collection of functions for managing a LaTeX Zettelkasten. Each of these functions can be run from the command line by running</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="sd">        `python manage.py function_name arg1 arg2 ...`</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="sd">        For example, running </span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        `python manage.py newnote note_name`</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">        executes `Hepler.newnote(note_name)`.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">        These can be executed by hand (for now). The plan for the future is to get other applications (eg a text editor) to run these functions.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>    <span class="n">renderers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;pdflatex&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--interaction=scrollmode&#39;</span><span class="p">]],</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;make4ht&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-um&#39;</span><span class="p">,</span> <span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;make4ht.cfg&#39;</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">]]}</span> <span class="c1"># {&#39;format&#39;: [&#39;command_line_command&#39;, [&#39;list&#39;, &#39;of&#39;, &#39;commandline&#39;, &#39;options&#39;]]}</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a>    <span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="s2">            Manage the LaTeX slip box. The file manage.py is documented with docstrings, see /docs for detailed information</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="k">def</span> <span class="nf">addtodocuments</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="sd">            Adds line \externaldocument[reference-]{filename} to documents.tex</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a><span class="sd">            If reference is not supplied then it defaults to, for example, NoteName if filename=note_name</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>            
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;\externaldocument[</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">-]</span><span class="se">{{</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">}}\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>                
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="k">def</span> <span class="nf">newnote</span><span class="p">(</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a><span class="sd">            Makes a new note with name note_name [Optional ReferenceName]</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a><span class="sd">            Creates note with name note_name.tex, Second argument is optional and is the name in the reference, defaults to NoteName</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a><span class="sd">            to do: check whether a file already exists etc</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="k">if</span> <span class="n">reference_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>            <span class="n">reference_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">note_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>        
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>        <span class="c1">#see if the note already exists</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note_name</span><span class="p">)</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A note with file name </span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s1"> already exists in the database. If this is not the case then run manage.py synchronize to update the database, and then try again&#39;</span><span class="p">)</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="k">return</span> 
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>        <span class="k">except</span> <span class="n">pw</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">:</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>            <span class="n">database</span><span class="o">.</span><span class="n">create_all_tables</span><span class="p">()</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>        <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>            <span class="k">try</span><span class="p">:</span> 
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">)</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A note with reference </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1"> already exists in the database. If this is not the case then run manage.py synchronize to update the database, and then try again. If the problem persists check the documents.tex file is correctly setup&#39;</span><span class="p">)</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>                <span class="k">return</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>                <span class="k">pass</span> 
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>    
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">__createnotefile</span><span class="p">(</span><span class="n">note_name</span><span class="p">)</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">addtodocuments</span><span class="p">(</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference_name</span><span class="p">)</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>        <span class="c1">#once created, add note to database </span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>    <span class="k">def</span> <span class="nf">newproject</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a><span class="sd">            Creates a project folder (for exporting notes) and copies the project.tex file into the folder</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>            <span class="k">pass</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>            <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error: project directory already exists&#39;</span><span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;project.tex&#39;</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="n">tex_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">tex_file</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>    <span class="k">def</span> <span class="nf">list_recent_files</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a><span class="sd">            List the most recently edited files.</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>        <span class="n">recent_files</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recent_files</span><span class="p">):</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>    <span class="k">def</span> <span class="nf">rename_recent</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">            Rename the most recent nth file.</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="n">db_file</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>        
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>        <span class="n">new_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Change file name to [</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">db_file</span><span class="o">.</span><span class="n">filename</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="n">new_reference</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Change reference to [</span><span class="si">{</span><span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">db_file</span><span class="o">.</span><span class="n">reference</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="k">if</span> <span class="n">new_name</span> <span class="o">!=</span> <span class="n">db_file</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">rename_file</span><span class="p">(</span><span class="n">db_file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>        <span class="k">if</span> <span class="n">new_reference</span> <span class="o">!=</span> <span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">rename_reference</span><span class="p">(</span><span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">new_reference</span><span class="p">)</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>    <span class="k">def</span> <span class="nf">rename_file</span><span class="p">(</span><span class="n">old_filename</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">            Rename the .tex file, fairly straightforward since only need to change documents.tex</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>                <span class="k">pass</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File, </span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex already exists&#39;</span><span class="p">)</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="k">pass</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>        <span class="c1">#copy file</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="c1">#change documents.tex</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">old_filename</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">new_filename</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument\[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;\-\]\{&#39;</span> <span class="o">+</span> <span class="n">old_filename</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;-]{&#39;</span> <span class="o">+</span> <span class="n">new_filename</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>        
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>    <span class="k">def</span> <span class="nf">rename_reference</span><span class="p">(</span><span class="n">old_reference</span><span class="p">,</span> <span class="n">new_reference</span><span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">            Rename the reference used throughout the whole Zettelkasten. This function changes documents.tex and also any documents that reference this note.</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>        <span class="c1">#function for regex replacement</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>        <span class="k">def</span> <span class="nf">replace_text</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">excref</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">excref[</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">]</span><span class="se">{{</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">exhyperref</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">exhyperref[</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">]</span><span class="se">{{</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="c1"># Update documents.tex</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">old_reference</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument\[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;\-\]\{&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument[&#39;</span> <span class="o">+</span> <span class="n">new_reference</span> <span class="o">+</span> <span class="s1">&#39;-]{&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> 
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>            <span class="n">backrefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>            <span class="k">for</span> <span class="n">backref</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>                <span class="n">backrefs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">backref</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>            <span class="k">for</span> <span class="n">backref</span> <span class="ow">in</span> <span class="n">backrefs</span><span class="p">:</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">backref</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{&#39;</span> <span class="o">+</span> <span class="n">old_reference</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">replace_text</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">backref</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="c1">#update note db</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">new_reference</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>    <span class="k">def</span> <span class="nf">remove_note</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">            Delete a note with given filename</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Delete database entry? (y/n)&#39;</span><span class="p">)</span> 
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>            <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>        <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No note with filename </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> exists in db&#39;</span><span class="p">)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>        
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>        <span class="n">to_delete</span><span class="o">=</span> <span class="p">[]</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">externaldocument\[)(.+?)(\-\]\</span><span class="se">{{</span><span class="s1">)</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">(\</span><span class="se">}}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>                <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>           
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">to_delete</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;delete line </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1"> from notes/documents.tex? (y/n)&#39;</span><span class="p">)</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>            <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Delete notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex? (y/n)&#39;</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error, no such file exists&#39;</span><span class="p">)</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">biber</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">            Render the LaTeX file. By default renders as a pdf and output is stored in the folder /pdf. The other format option is html, although support is currently experimental.</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>        <span class="k">if</span> <span class="n">biber</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>        <span class="n">command</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>        
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>            <span class="k">pass</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>        
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>        <span class="n">linked_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>        <span class="n">external_documents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>        <span class="n">references</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">:</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>                <span class="n">source</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">source</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>                <span class="n">references</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>                <span class="n">linked_files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">reference</span><span class="p">)</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="n">target_note</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>                <span class="n">references</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_note</span><span class="p">)</span> 
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>      
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>        <span class="c1">#inject external documents </span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>            <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">references</span><span class="p">:</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>                <span class="k">if</span> <span class="n">reference</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>                    <span class="n">external_documents</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">externaldocument[</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">-]</span><span class="se">{{</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="se">}}\n</span><span class="s2">&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>       
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>        <span class="n">referenced_by_section</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section*{Referenced In}</span><span class="se">\n\\</span><span class="s2">begin</span><span class="si">{itemize}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>        <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">linked_files</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>            <span class="n">referenced_by_section</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">item </span><span class="se">\\</span><span class="s2">excref</span><span class="se">{{</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>        <span class="n">referenced_by_section</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{itemize}</span><span class="s2">&quot;</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>        
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>        <span class="n">path_to_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;../notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>                <span class="k">pass</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No such file!&#39;</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t find </span><span class="si">{</span><span class="n">path_to_file</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;--jobname=</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">]</span> <span class="o">+</span> <span class="n">options</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&quot;svg-&quot;&#39;</span><span class="p">]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>            <span class="c1">#options = [&#39;-j&#39;, filename] + options</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a> 
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>            <span class="n">document</span> <span class="o">+=</span> <span class="n">referenced_by_section</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>            <span class="c1">#replace include with preamble_html and inject external documents</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subimport{../template}</span><span class="si">{preamble.tex}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subimport{../template}</span><span class="si">{preamble_html.tex}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">external_documents</span><span class="p">)</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>        <span class="n">document</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{document}</span><span class="s2">&quot;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">options</span><span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to compile&#39;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span> <span class="c1">#TODO: Exceptions</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>            <span class="k">return</span> <span class="n">process</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>            <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>            <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>        <span class="k">return</span> <span class="n">process</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>        
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>    <span class="k">def</span> <span class="nf">render_all</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a><span class="sd">            Function to replace renderallhtml and renderallpdf, rendering notes in a sensible order with regards to dependencies for PDFLaTeX links. Not currently implemented.</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="k">pass</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>    <span class="k">def</span> <span class="nf">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">            Run biber on the render of the note. Folder can be either html or pdf, depending on the format.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;biber&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">error</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>        
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="k">def</span> <span class="nf">render_all_html</span><span class="p">():</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a><span class="sd">            Renderes all the notes using make4ht. Saves output in /html</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>        
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>        
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 1&#39;</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> 
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running biber...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 2&#39;</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>       
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>       
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>    <span class="k">def</span> <span class="nf">render_all_pdf</span><span class="p">():</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">            Renderes all the notes using pdflatex. Saves output in /pdf</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>        
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>        
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 1&#39;</span><span class="p">)</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running biber...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>                <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error!&#39;</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 2&#39;</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="k">def</span> <span class="nf">render_updates</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="n">updated</span><span class="p">,</span> <span class="n">new_links</span><span class="p">,</span> <span class="n">run_biber</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>        
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>            <span class="k">if</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>                <span class="k">continue</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span><span class="p">:</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>                    <span class="n">updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>                    <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>                    <span class="c1">#fix reference in</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>                    <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">])</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span><span class="p">:</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                    <span class="n">updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>                    <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>                    <span class="c1">#fix referenced in</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                    <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">])</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>        
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="c1">#render the updated files</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rendering </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">])</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>        <span class="n">rerendered</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">new_links</span><span class="p">:</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span> <span class="ow">in</span> <span class="n">rerendered</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>                <span class="k">continue</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rendering </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="n">rerendered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>                
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>    <span class="k">def</span> <span class="nf">synchronize</span><span class="p">():</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a><span class="sd">            Reads all the files that have been changed since the last call of this function and updates the database</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>        <span class="c1">#loop through all the tracked notes and check for required updates</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>        <span class="n">to_read</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>            <span class="c1">#try and get the edit date from the file system. </span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>                <span class="n">modified</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>                <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span><span class="p">:</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>                    <span class="n">to_read</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>                <span class="c1">#Todo: file has been deleted or renamed without the database being updated really need to run force_synchronize.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file not found for note with reference </span><span class="si">{note.reference}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>                <span class="k">pass</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>        <span class="c1">#update labels </span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="n">run_biber</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">to_read</span><span class="p">:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>            <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>        <span class="n">new_links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">to_read</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>            <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Helper</span><span class="o">.</span><span class="n">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">))</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>        <span class="k">return</span> <span class="n">to_read</span><span class="p">,</span> <span class="n">new_links</span><span class="p">,</span> <span class="n">run_biber</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>    <span class="k">def</span> <span class="nf">force_synchronize</span><span class="p">():</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">            Reads the file documents.tex and adds these files to the database (/slipbox.db) and checks for files in /notes that aren&#39;t in the documents. Then fixes and confilcts with these before reading the notes and creating database objects for labels, links and citations. </span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>        <span class="n">database</span><span class="o">.</span><span class="n">create_all_tables</span><span class="p">()</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>        <span class="c1">#get all the tracked notes (the ones in documents.tex)</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>        <span class="n">tracked_notes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">externaldocument\[)(.+?)(\-\]\{)(.+?)(\})&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                    <span class="n">reference_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>                    <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> with reference </span><span class="si">{</span><span class="n">reference_name</span><span class="si">}</span><span class="s1"> missing from notes. Make new note now? (y/n)&#39;</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>                        <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                            <span class="n">Helper</span><span class="o">.</span><span class="n">__createnotefile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>                            <span class="n">tracked_notes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>                            
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>                        <span class="n">tracked_notes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">reference_name</span> <span class="ow">in</span> <span class="n">tracked_notes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="n">modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>            
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">modified</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>                    <span class="n">html_render</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;html/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">))</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="o">=</span> <span class="n">html_render</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>                    <span class="c1">#print(f&#39;{filename} is yet to be rendered as html&#39;)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>                    <span class="k">pass</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>                
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>                    <span class="n">pdf_render</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pdf/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">))</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="o">=</span> <span class="n">pdf_render</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> is yet to be rendered as pdf&#39;</span><span class="p">)</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>                
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">==</span> <span class="n">reference_name</span><span class="p">:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                    <span class="k">pass</span> <span class="c1">#nothing to do</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                    <span class="c1">#update note reference to the one in documents.tex, might want to check that this is the right thing to do</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>            
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>                    <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>                    <span class="c1">#update the filename in database, might want to check that this is the right thing to do</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                    <span class="c1">#create the note if there are no close matches</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>                    <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="n">modified</span><span class="p">,</span> <span class="n">last_edit_date</span><span class="o">=</span><span class="n">modified</span><span class="p">)</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>            <span class="c1">#add any notes to documents.tex</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>            <span class="k">if</span> <span class="n">note</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked_notes</span><span class="p">:</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">note</span><span class="si">}</span><span class="s1"> not tracked by the file documents.tex. Add to the file now? (y/n)&#39;</span><span class="p">)</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span> 
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>                    <span class="n">reference</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reference (defaults to </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">):&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>                    <span class="n">new_reference</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>                    <span class="k">if</span> <span class="n">new_reference</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>                        <span class="n">reference</span> <span class="o">=</span> <span class="n">new_reference</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>                        <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>                        <span class="n">Helper</span><span class="o">.</span><span class="n">addtodocuments</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>                    <span class="k">except</span> <span class="n">pw</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error adding note, note already exists in database&#39;</span><span class="p">)</span> 
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>        
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>        <span class="c1">#add labels</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>                   
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="c1">#add connections</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span> 
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>            
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>                        
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>    <span class="k">def</span> <span class="nf">list_unreferenced</span><span class="p">():</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>        <span class="kn">from</span> <span class="nn">LatexZettel</span> <span class="kn">import</span> <span class="n">analysis</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">            Prints a list of notes that are not referenced in any other note. These might want to be added to the index, for example. </span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>        <span class="n">notes</span><span class="p">,</span> <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">calculate_adjacency_matrix</span><span class="p">()</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>        <span class="n">referenced_by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>        
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>        <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>        <span class="k">for</span> <span class="n">note</span><span class="p">,</span> <span class="n">links_from</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">referenced_by</span><span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>            <span class="k">if</span> <span class="n">links_from</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>                <span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a><span class="sd">            Open the note default text editor in the directory /notes/slipbox. If no file is passed then this opens </span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="n">most_recent</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;slipbox&#39;</span><span class="p">))</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">OPEN_COMMAND</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">most_recent</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;slipbox&#39;</span><span class="p">))</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">OPEN_COMMAND</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">])</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="k">def</span> <span class="nf">to_md</span><span class="p">(</span><span class="n">note_name</span><span class="p">):</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;            </span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">            Work in progress. Export a LaTeX document note to markdown, and convert references to [[WikiLink]] style references.</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>        <span class="k">def</span> <span class="nf">replace_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">md_links</span><span class="p">):</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>            <span class="n">replacement</span> <span class="o">=</span> <span class="s1">&#39;[[&#39;</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                <span class="n">replacement</span> <span class="o">+=</span> <span class="n">md_links</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;hyper&#39;</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                <span class="n">replacement</span> <span class="o">+=</span> <span class="n">md_links</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">replacement</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>            <span class="k">return</span> <span class="n">replacement</span> <span class="o">+</span> <span class="s1">&#39;]]&#39;</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>        <span class="c1"># load the file and convert exhyperref and excref to Wiki links</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>        <span class="n">file_references</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex?(hyper)?(c)?ref(\[([^]+)\])?\{(.*?)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                        <span class="n">label</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                    <span class="n">file_references</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">label</span><span class="p">))</span> 
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                                 
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="n">md_links</span> <span class="o">=</span> <span class="p">{}</span> 
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>        <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span> <span class="ow">in</span> <span class="n">file_references</span><span class="p">:</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>            <span class="k">if</span> <span class="n">tex_label</span> <span class="o">==</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>                <span class="n">md_links</span><span class="p">[(</span><span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span><span class="p">)]</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>                <span class="n">md_links</span><span class="p">[(</span><span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">#</span><span class="si">{</span><span class="n">tex_label</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>        <span class="n">new_file</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>            <span class="n">new_file</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{(.*?)\}(\{(.*?)\})?&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span> <span class="p">:</span> <span class="n">replace_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">md_links</span><span class="p">),</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;pandoc&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;markdown/</span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s2">.md&quot;</span> <span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="n">new_file</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="k">def</span> <span class="nf">export_project</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">texfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">            Replaces \\transclude calls in a project file with the contents of the notes. Output is saved in project_dir/standalone</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>        <span class="k">if</span> <span class="n">texfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>            <span class="n">texfile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">project_folder</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Export already exists, continue? (Warning: This will overwrite any changes you have made to the file </span><span class="si">{texfile}</span><span class="s1"> in </span><span class="si">{output_dir}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>                <span class="k">return</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>        <span class="n">input_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="n">texfile</span><span class="p">)</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>        
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>                <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">transclude(\[[^]]+\]+)?\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>                <span class="n">external_documents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">transclude(\[([^]]+)\])?\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>                <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">external_documents</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                    <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>                    <span class="n">document</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>                        <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>                    <span class="n">note_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">document</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">note_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>                        <span class="n">full_document</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>                        <span class="n">import_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%&lt;\*</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;((.|</span><span class="se">\n</span><span class="s1">)*?)%&lt;/</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">full_document</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">import_text</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>        <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">texfile</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>    <span class="k">def</span> <span class="nf">export_draft</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a><span class="sd">            Exports the export input_file (a file like /export/example.tex containing \ExecuteMetaData calls) and creates a .tex file (by default in /draft/filename.tex) where the \ExecuteMetadata commands are replaced with the body of the notes that they reference.</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>                <span class="k">pass</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;draft/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>    
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>                <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ExecuteMetaData\[\.\./([^]]+)\]\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>                <span class="n">external_documents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ExecuteMetaData\[\.\./([^]]+)\]\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>                <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">external_documents</span><span class="p">:</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>                    <span class="n">import_file</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>                    <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">import_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>                        <span class="n">import_text_file</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>                        <span class="n">import_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%&lt;\*</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;((.|</span><span class="se">\n</span><span class="s1">)*?)%&lt;/</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">import_text_file</span><span class="p">)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">import_text</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="k">def</span> <span class="nf">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getcitations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>        <span class="n">tracked</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">citations</span><span class="p">]</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>        
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>        <span class="n">updates_to_citations</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tracked</span><span class="p">:</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>                <span class="k">continue</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>            <span class="n">database</span><span class="o">.</span><span class="n">Citation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">citationkey</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>            <span class="n">updates_to_citations</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>            
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>        <span class="k">for</span> <span class="n">citation</span> <span class="ow">in</span> <span class="n">tracked</span><span class="p">:</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>            <span class="k">if</span> <span class="n">citation</span><span class="o">.</span><span class="n">citationkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>                <span class="n">citation</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>                <span class="n">updates_to_citations</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>        <span class="k">return</span> <span class="n">updates_to_citations</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>                
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="k">def</span> <span class="nf">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getlabels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="n">tracked_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">]</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked_labels</span><span class="p">:</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>                <span class="n">database</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="c1">#remove extra labels</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>                <span class="n">label</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>                   
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="c1">#add connections</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>    <span class="k">def</span> <span class="nf">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>        <span class="n">links</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getlinks</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>        <span class="n">modified</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>        <span class="n">tracked</span> <span class="o">=</span> <span class="p">[(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">]</span> 
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="c1">#add in untracked</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>            <span class="k">if</span> <span class="n">link</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked</span><span class="p">:</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">note__reference</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                    <span class="n">link</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                    <span class="n">modified</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;label in </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1"> with details </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> does not exist&#39;</span><span class="p">)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>        <span class="c1">#remove any that no longer exist</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;link </span><span class="si">{</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span><span class="w"> </span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s1"> no longer exists, deleting&#39;</span><span class="p">)</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                <span class="n">link</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                <span class="n">modified</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>        <span class="k">return</span> <span class="n">modified</span> 
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>    <span class="k">def</span> <span class="nf">__getnotefiles</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;notes/slipbox&#39;</span><span class="p">):</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;.tex&#39;</span><span class="p">)]</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>        <span class="k">return</span> <span class="n">notes</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    <span class="k">def</span> <span class="nf">__createnotefile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">)</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">pass</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;notes/slipbox&#39;</span><span class="p">)</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="k">pass</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                <span class="k">pass</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File notes/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex already exists, skipping copying the template&#39;</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>            <span class="k">return</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="k">pass</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s1">&#39;template/note.tex&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;template/note.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">title\{(.*?)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">title{&#39;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>    <span class="k">def</span> <span class="nf">__getlabels</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="n">file_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">(label|currentdoc)\{)(.*?)(\})&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>                    <span class="n">file_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>                    <span class="k">pass</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="k">return</span> <span class="n">file_labels</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>    <span class="k">def</span> <span class="nf">list_citations</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">__getcitations</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="k">def</span> <span class="nf">__getcitations</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>        <span class="n">citation_commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cite&#39;</span><span class="p">,</span> <span class="s1">&#39;parencite&#39;</span><span class="p">,</span> <span class="s1">&#39;footcite&#39;</span><span class="p">,</span> <span class="s1">&#39;footcitetext&#39;</span><span class="p">,</span> <span class="s1">&#39;textcite&#39;</span><span class="p">,</span> <span class="s1">&#39;smartcite&#39;</span><span class="p">,</span> <span class="s1">&#39;cite*&#39;</span><span class="p">,</span> <span class="s1">&#39;parencite*&#39;</span><span class="p">,</span> <span class="s1">&#39;supercite&#39;</span><span class="p">,</span> <span class="s1">&#39;autocite&#39;</span><span class="p">,</span> <span class="s1">&#39;autocite*&#39;</span><span class="p">,</span> <span class="s1">&#39;citeauthor&#39;</span><span class="p">,</span> <span class="s1">&#39;citeauthor*&#39;</span><span class="p">,</span> <span class="s1">&#39;citetitle&#39;</span><span class="p">,</span> <span class="s1">&#39;citeyear&#39;</span><span class="p">,</span> <span class="s1">&#39;citedate&#39;</span><span class="p">,</span> <span class="s1">&#39;citeurl&#39;</span><span class="p">,</span> <span class="s1">&#39;volcite&#39;</span><span class="p">,</span> <span class="s1">&#39;pvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;fvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;ftvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;svolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;tvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;avolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;fillcite&#39;</span><span class="p">,</span> <span class="s1">&#39;footfullcite&#39;</span><span class="p">,</span> <span class="s1">&#39;nocite&#39;</span><span class="p">,</span> <span class="s1">&#39;notecite&#39;</span><span class="p">,</span> <span class="s1">&#39;pnotecite&#39;</span><span class="p">,</span> <span class="s1">&#39;fnotecite&#39;</span><span class="p">]</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                <span class="n">citations</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">(&#39;</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">citation_commands</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)(\[([^]]+)\])?(\{[^\}]+\})?(\[([^]]+)\])?\{([^\}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">:</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                    <span class="n">keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="k">return</span> <span class="n">keys</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>    <span class="k">def</span> <span class="nf">__getlinks</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>        <span class="n">file_references</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{(.*?)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>                        <span class="n">ref</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>                        <span class="n">ref</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>                    <span class="n">file_references</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">ref</span><span class="p">))</span> 
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>        <span class="k">return</span> <span class="n">file_references</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="k">def</span> <span class="nf">__gettags</span><span class="p">():</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">note</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>                <span class="n">last_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">end\{document\}&quot;</span><span class="p">,</span> <span class="n">last_line</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>                    <span class="n">note_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">last_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>                    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">note_tags</span><span class="p">:</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>                        <span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;notes/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;notes/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="k">def</span> <span class="nf">__get_recent_files</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>       
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>        <span class="n">file_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>            <span class="n">time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="p">:</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="n">file_dict</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="n">file_dict</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="p">]</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>        <span class="n">ordered</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_dict</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ordered</span><span class="p">):</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>            <span class="n">r</span> <span class="o">+=</span> <span class="n">file_dict</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>        <span class="k">return</span> <span class="n">r</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>                
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>    <span class="k">def</span> <span class="nf">__getyesno</span><span class="p">():</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter either </span><span class="se">\&#39;</span><span class="s1">y</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">n</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>         
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a><span class="sd">        </span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a><span class="sd">        Execute the helper functions from the command line.</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No argument passed, try &#39;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> help&#39;&quot;</span><span class="p">)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="k">return</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>    <span class="k">try</span><span class="p">:</span> 
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Helper</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unregognised command </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, try &#39;help&#39; for a list of availlable commands&quot;</span><span class="p">)</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>    <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>    <span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="Helper">
                            <input id="Helper-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Helper</span>:

                <label class="view-source-button" for="Helper-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper-22"><a href="#Helper-22"><span class="linenos">  22</span></a><span class="k">class</span> <span class="nc">Helper</span><span class="p">:</span>
</span><span id="Helper-23"><a href="#Helper-23"><span class="linenos">  23</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-24"><a href="#Helper-24"><span class="linenos">  24</span></a><span class="sd">        Collection of functions for managing a LaTeX Zettelkasten. Each of these functions can be run from the command line by running</span>
</span><span id="Helper-25"><a href="#Helper-25"><span class="linenos">  25</span></a>
</span><span id="Helper-26"><a href="#Helper-26"><span class="linenos">  26</span></a><span class="sd">        `python manage.py function_name arg1 arg2 ...`</span>
</span><span id="Helper-27"><a href="#Helper-27"><span class="linenos">  27</span></a>
</span><span id="Helper-28"><a href="#Helper-28"><span class="linenos">  28</span></a><span class="sd">        For example, running </span>
</span><span id="Helper-29"><a href="#Helper-29"><span class="linenos">  29</span></a>
</span><span id="Helper-30"><a href="#Helper-30"><span class="linenos">  30</span></a><span class="sd">        `python manage.py newnote note_name`</span>
</span><span id="Helper-31"><a href="#Helper-31"><span class="linenos">  31</span></a>
</span><span id="Helper-32"><a href="#Helper-32"><span class="linenos">  32</span></a><span class="sd">        executes `Hepler.newnote(note_name)`.</span>
</span><span id="Helper-33"><a href="#Helper-33"><span class="linenos">  33</span></a>
</span><span id="Helper-34"><a href="#Helper-34"><span class="linenos">  34</span></a><span class="sd">        These can be executed by hand (for now). The plan for the future is to get other applications (eg a text editor) to run these functions.</span>
</span><span id="Helper-35"><a href="#Helper-35"><span class="linenos">  35</span></a>
</span><span id="Helper-36"><a href="#Helper-36"><span class="linenos">  36</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Helper-37"><a href="#Helper-37"><span class="linenos">  37</span></a>    <span class="n">renderers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;pdf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;pdflatex&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;--interaction=scrollmode&#39;</span><span class="p">]],</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;make4ht&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-um&#39;</span><span class="p">,</span> <span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;..&#39;</span><span class="p">,</span> <span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="s1">&#39;make4ht.cfg&#39;</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">]]}</span> <span class="c1"># {&#39;format&#39;: [&#39;command_line_command&#39;, [&#39;list&#39;, &#39;of&#39;, &#39;commandline&#39;, &#39;options&#39;]]}</span>
</span><span id="Helper-38"><a href="#Helper-38"><span class="linenos">  38</span></a>
</span><span id="Helper-39"><a href="#Helper-39"><span class="linenos">  39</span></a>    <span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
</span><span id="Helper-40"><a href="#Helper-40"><span class="linenos">  40</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="Helper-41"><a href="#Helper-41"><span class="linenos">  41</span></a><span class="s2">            Manage the LaTeX slip box. The file manage.py is documented with docstrings, see /docs for detailed information</span>
</span><span id="Helper-42"><a href="#Helper-42"><span class="linenos">  42</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="Helper-43"><a href="#Helper-43"><span class="linenos">  43</span></a>
</span><span id="Helper-44"><a href="#Helper-44"><span class="linenos">  44</span></a>    <span class="k">def</span> <span class="nf">addtodocuments</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="Helper-45"><a href="#Helper-45"><span class="linenos">  45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-46"><a href="#Helper-46"><span class="linenos">  46</span></a><span class="sd">            Adds line \externaldocument[reference-]{filename} to documents.tex</span>
</span><span id="Helper-47"><a href="#Helper-47"><span class="linenos">  47</span></a><span class="sd">            If reference is not supplied then it defaults to, for example, NoteName if filename=note_name</span>
</span><span id="Helper-48"><a href="#Helper-48"><span class="linenos">  48</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-49"><a href="#Helper-49"><span class="linenos">  49</span></a>            
</span><span id="Helper-50"><a href="#Helper-50"><span class="linenos">  50</span></a>
</span><span id="Helper-51"><a href="#Helper-51"><span class="linenos">  51</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-52"><a href="#Helper-52"><span class="linenos">  52</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;\externaldocument[</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">-]</span><span class="se">{{</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">}}\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper-53"><a href="#Helper-53"><span class="linenos">  53</span></a>
</span><span id="Helper-54"><a href="#Helper-54"><span class="linenos">  54</span></a>                
</span><span id="Helper-55"><a href="#Helper-55"><span class="linenos">  55</span></a>
</span><span id="Helper-56"><a href="#Helper-56"><span class="linenos">  56</span></a>    
</span><span id="Helper-57"><a href="#Helper-57"><span class="linenos">  57</span></a>
</span><span id="Helper-58"><a href="#Helper-58"><span class="linenos">  58</span></a>    <span class="k">def</span> <span class="nf">newnote</span><span class="p">(</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="Helper-59"><a href="#Helper-59"><span class="linenos">  59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-60"><a href="#Helper-60"><span class="linenos">  60</span></a><span class="sd">            Makes a new note with name note_name [Optional ReferenceName]</span>
</span><span id="Helper-61"><a href="#Helper-61"><span class="linenos">  61</span></a><span class="sd">            Creates note with name note_name.tex, Second argument is optional and is the name in the reference, defaults to NoteName</span>
</span><span id="Helper-62"><a href="#Helper-62"><span class="linenos">  62</span></a>
</span><span id="Helper-63"><a href="#Helper-63"><span class="linenos">  63</span></a><span class="sd">            to do: check whether a file already exists etc</span>
</span><span id="Helper-64"><a href="#Helper-64"><span class="linenos">  64</span></a>
</span><span id="Helper-65"><a href="#Helper-65"><span class="linenos">  65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-66"><a href="#Helper-66"><span class="linenos">  66</span></a>        <span class="k">if</span> <span class="n">reference_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Helper-67"><a href="#Helper-67"><span class="linenos">  67</span></a>            <span class="n">reference_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">note_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="Helper-68"><a href="#Helper-68"><span class="linenos">  68</span></a>        
</span><span id="Helper-69"><a href="#Helper-69"><span class="linenos">  69</span></a>        <span class="c1">#see if the note already exists</span>
</span><span id="Helper-70"><a href="#Helper-70"><span class="linenos">  70</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-71"><a href="#Helper-71"><span class="linenos">  71</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note_name</span><span class="p">)</span>
</span><span id="Helper-72"><a href="#Helper-72"><span class="linenos">  72</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A note with file name </span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s1"> already exists in the database. If this is not the case then run manage.py synchronize to update the database, and then try again&#39;</span><span class="p">)</span>
</span><span id="Helper-73"><a href="#Helper-73"><span class="linenos">  73</span></a>            <span class="k">return</span> 
</span><span id="Helper-74"><a href="#Helper-74"><span class="linenos">  74</span></a>        <span class="k">except</span> <span class="n">pw</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">:</span>
</span><span id="Helper-75"><a href="#Helper-75"><span class="linenos">  75</span></a>            <span class="n">database</span><span class="o">.</span><span class="n">create_all_tables</span><span class="p">()</span>
</span><span id="Helper-76"><a href="#Helper-76"><span class="linenos">  76</span></a>        <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-77"><a href="#Helper-77"><span class="linenos">  77</span></a>            <span class="k">try</span><span class="p">:</span> 
</span><span id="Helper-78"><a href="#Helper-78"><span class="linenos">  78</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">)</span>
</span><span id="Helper-79"><a href="#Helper-79"><span class="linenos">  79</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A note with reference </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1"> already exists in the database. If this is not the case then run manage.py synchronize to update the database, and then try again. If the problem persists check the documents.tex file is correctly setup&#39;</span><span class="p">)</span>
</span><span id="Helper-80"><a href="#Helper-80"><span class="linenos">  80</span></a>                <span class="k">return</span>
</span><span id="Helper-81"><a href="#Helper-81"><span class="linenos">  81</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-82"><a href="#Helper-82"><span class="linenos">  82</span></a>                <span class="k">pass</span> 
</span><span id="Helper-83"><a href="#Helper-83"><span class="linenos">  83</span></a>    
</span><span id="Helper-84"><a href="#Helper-84"><span class="linenos">  84</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">__createnotefile</span><span class="p">(</span><span class="n">note_name</span><span class="p">)</span>
</span><span id="Helper-85"><a href="#Helper-85"><span class="linenos">  85</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">addtodocuments</span><span class="p">(</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference_name</span><span class="p">)</span>
</span><span id="Helper-86"><a href="#Helper-86"><span class="linenos">  86</span></a>        <span class="c1">#once created, add note to database </span>
</span><span id="Helper-87"><a href="#Helper-87"><span class="linenos">  87</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="Helper-88"><a href="#Helper-88"><span class="linenos">  88</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-89"><a href="#Helper-89"><span class="linenos">  89</span></a>
</span><span id="Helper-90"><a href="#Helper-90"><span class="linenos">  90</span></a>    <span class="k">def</span> <span class="nf">newproject</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper-91"><a href="#Helper-91"><span class="linenos">  91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-92"><a href="#Helper-92"><span class="linenos">  92</span></a><span class="sd">            Creates a project folder (for exporting notes) and copies the project.tex file into the folder</span>
</span><span id="Helper-93"><a href="#Helper-93"><span class="linenos">  93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-94"><a href="#Helper-94"><span class="linenos">  94</span></a>
</span><span id="Helper-95"><a href="#Helper-95"><span class="linenos">  95</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-96"><a href="#Helper-96"><span class="linenos">  96</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">)</span>
</span><span id="Helper-97"><a href="#Helper-97"><span class="linenos">  97</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-98"><a href="#Helper-98"><span class="linenos">  98</span></a>            <span class="k">pass</span>
</span><span id="Helper-99"><a href="#Helper-99"><span class="linenos">  99</span></a>
</span><span id="Helper-100"><a href="#Helper-100"><span class="linenos"> 100</span></a>
</span><span id="Helper-101"><a href="#Helper-101"><span class="linenos"> 101</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-102"><a href="#Helper-102"><span class="linenos"> 102</span></a>            <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
</span><span id="Helper-103"><a href="#Helper-103"><span class="linenos"> 103</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="Helper-104"><a href="#Helper-104"><span class="linenos"> 104</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-105"><a href="#Helper-105"><span class="linenos"> 105</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error: project directory already exists&#39;</span><span class="p">)</span>
</span><span id="Helper-106"><a href="#Helper-106"><span class="linenos"> 106</span></a>
</span><span id="Helper-107"><a href="#Helper-107"><span class="linenos"> 107</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="Helper-108"><a href="#Helper-108"><span class="linenos"> 108</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="Helper-109"><a href="#Helper-109"><span class="linenos"> 109</span></a>
</span><span id="Helper-110"><a href="#Helper-110"><span class="linenos"> 110</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;project.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-111"><a href="#Helper-111"><span class="linenos"> 111</span></a>        <span class="n">tex_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-112"><a href="#Helper-112"><span class="linenos"> 112</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">tex_file</span><span class="p">)</span>
</span><span id="Helper-113"><a href="#Helper-113"><span class="linenos"> 113</span></a>
</span><span id="Helper-114"><a href="#Helper-114"><span class="linenos"> 114</span></a>
</span><span id="Helper-115"><a href="#Helper-115"><span class="linenos"> 115</span></a>    <span class="k">def</span> <span class="nf">list_recent_files</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="Helper-116"><a href="#Helper-116"><span class="linenos"> 116</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-117"><a href="#Helper-117"><span class="linenos"> 117</span></a><span class="sd">            List the most recently edited files.</span>
</span><span id="Helper-118"><a href="#Helper-118"><span class="linenos"> 118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-119"><a href="#Helper-119"><span class="linenos"> 119</span></a>
</span><span id="Helper-120"><a href="#Helper-120"><span class="linenos"> 120</span></a>        <span class="n">recent_files</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span><span id="Helper-121"><a href="#Helper-121"><span class="linenos"> 121</span></a>
</span><span id="Helper-122"><a href="#Helper-122"><span class="linenos"> 122</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recent_files</span><span class="p">):</span>
</span><span id="Helper-123"><a href="#Helper-123"><span class="linenos"> 123</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
</span><span id="Helper-124"><a href="#Helper-124"><span class="linenos"> 124</span></a>
</span><span id="Helper-125"><a href="#Helper-125"><span class="linenos"> 125</span></a>
</span><span id="Helper-126"><a href="#Helper-126"><span class="linenos"> 126</span></a>
</span><span id="Helper-127"><a href="#Helper-127"><span class="linenos"> 127</span></a>
</span><span id="Helper-128"><a href="#Helper-128"><span class="linenos"> 128</span></a>    <span class="k">def</span> <span class="nf">rename_recent</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Helper-129"><a href="#Helper-129"><span class="linenos"> 129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-130"><a href="#Helper-130"><span class="linenos"> 130</span></a><span class="sd">            Rename the most recent nth file.</span>
</span><span id="Helper-131"><a href="#Helper-131"><span class="linenos"> 131</span></a>
</span><span id="Helper-132"><a href="#Helper-132"><span class="linenos"> 132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-133"><a href="#Helper-133"><span class="linenos"> 133</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="Helper-134"><a href="#Helper-134"><span class="linenos"> 134</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="Helper-135"><a href="#Helper-135"><span class="linenos"> 135</span></a>
</span><span id="Helper-136"><a href="#Helper-136"><span class="linenos"> 136</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper-137"><a href="#Helper-137"><span class="linenos"> 137</span></a>
</span><span id="Helper-138"><a href="#Helper-138"><span class="linenos"> 138</span></a>        <span class="n">db_file</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper-139"><a href="#Helper-139"><span class="linenos"> 139</span></a>        
</span><span id="Helper-140"><a href="#Helper-140"><span class="linenos"> 140</span></a>        <span class="n">new_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Change file name to [</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">db_file</span><span class="o">.</span><span class="n">filename</span>
</span><span id="Helper-141"><a href="#Helper-141"><span class="linenos"> 141</span></a>        <span class="n">new_reference</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Change reference to [</span><span class="si">{</span><span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">db_file</span><span class="o">.</span><span class="n">reference</span>
</span><span id="Helper-142"><a href="#Helper-142"><span class="linenos"> 142</span></a>
</span><span id="Helper-143"><a href="#Helper-143"><span class="linenos"> 143</span></a>
</span><span id="Helper-144"><a href="#Helper-144"><span class="linenos"> 144</span></a>        <span class="k">if</span> <span class="n">new_name</span> <span class="o">!=</span> <span class="n">db_file</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
</span><span id="Helper-145"><a href="#Helper-145"><span class="linenos"> 145</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">rename_file</span><span class="p">(</span><span class="n">db_file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="Helper-146"><a href="#Helper-146"><span class="linenos"> 146</span></a>
</span><span id="Helper-147"><a href="#Helper-147"><span class="linenos"> 147</span></a>        <span class="k">if</span> <span class="n">new_reference</span> <span class="o">!=</span> <span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
</span><span id="Helper-148"><a href="#Helper-148"><span class="linenos"> 148</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">rename_reference</span><span class="p">(</span><span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">new_reference</span><span class="p">)</span>
</span><span id="Helper-149"><a href="#Helper-149"><span class="linenos"> 149</span></a>
</span><span id="Helper-150"><a href="#Helper-150"><span class="linenos"> 150</span></a>    <span class="k">def</span> <span class="nf">rename_file</span><span class="p">(</span><span class="n">old_filename</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">):</span>
</span><span id="Helper-151"><a href="#Helper-151"><span class="linenos"> 151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-152"><a href="#Helper-152"><span class="linenos"> 152</span></a><span class="sd">            Rename the .tex file, fairly straightforward since only need to change documents.tex</span>
</span><span id="Helper-153"><a href="#Helper-153"><span class="linenos"> 153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-154"><a href="#Helper-154"><span class="linenos"> 154</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-155"><a href="#Helper-155"><span class="linenos"> 155</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="Helper-156"><a href="#Helper-156"><span class="linenos"> 156</span></a>                <span class="k">pass</span>
</span><span id="Helper-157"><a href="#Helper-157"><span class="linenos"> 157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File, </span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex already exists&#39;</span><span class="p">)</span>
</span><span id="Helper-158"><a href="#Helper-158"><span class="linenos"> 158</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper-159"><a href="#Helper-159"><span class="linenos"> 159</span></a>            <span class="k">pass</span>
</span><span id="Helper-160"><a href="#Helper-160"><span class="linenos"> 160</span></a>        <span class="c1">#copy file</span>
</span><span id="Helper-161"><a href="#Helper-161"><span class="linenos"> 161</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-162"><a href="#Helper-162"><span class="linenos"> 162</span></a>
</span><span id="Helper-163"><a href="#Helper-163"><span class="linenos"> 163</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-164"><a href="#Helper-164"><span class="linenos"> 164</span></a>
</span><span id="Helper-165"><a href="#Helper-165"><span class="linenos"> 165</span></a>        <span class="c1">#change documents.tex</span>
</span><span id="Helper-166"><a href="#Helper-166"><span class="linenos"> 166</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">old_filename</span><span class="p">)</span>
</span><span id="Helper-167"><a href="#Helper-167"><span class="linenos"> 167</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">new_filename</span>
</span><span id="Helper-168"><a href="#Helper-168"><span class="linenos"> 168</span></a>
</span><span id="Helper-169"><a href="#Helper-169"><span class="linenos"> 169</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-170"><a href="#Helper-170"><span class="linenos"> 170</span></a>
</span><span id="Helper-171"><a href="#Helper-171"><span class="linenos"> 171</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-172"><a href="#Helper-172"><span class="linenos"> 172</span></a>
</span><span id="Helper-173"><a href="#Helper-173"><span class="linenos"> 173</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-174"><a href="#Helper-174"><span class="linenos"> 174</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-175"><a href="#Helper-175"><span class="linenos"> 175</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument\[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;\-\]\{&#39;</span> <span class="o">+</span> <span class="n">old_filename</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;-]{&#39;</span> <span class="o">+</span> <span class="n">new_filename</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-176"><a href="#Helper-176"><span class="linenos"> 176</span></a>
</span><span id="Helper-177"><a href="#Helper-177"><span class="linenos"> 177</span></a>
</span><span id="Helper-178"><a href="#Helper-178"><span class="linenos"> 178</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-179"><a href="#Helper-179"><span class="linenos"> 179</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="Helper-180"><a href="#Helper-180"><span class="linenos"> 180</span></a>        
</span><span id="Helper-181"><a href="#Helper-181"><span class="linenos"> 181</span></a>
</span><span id="Helper-182"><a href="#Helper-182"><span class="linenos"> 182</span></a>    <span class="k">def</span> <span class="nf">rename_reference</span><span class="p">(</span><span class="n">old_reference</span><span class="p">,</span> <span class="n">new_reference</span><span class="p">):</span>
</span><span id="Helper-183"><a href="#Helper-183"><span class="linenos"> 183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-184"><a href="#Helper-184"><span class="linenos"> 184</span></a><span class="sd">            Rename the reference used throughout the whole Zettelkasten. This function changes documents.tex and also any documents that reference this note.</span>
</span><span id="Helper-185"><a href="#Helper-185"><span class="linenos"> 185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-186"><a href="#Helper-186"><span class="linenos"> 186</span></a>
</span><span id="Helper-187"><a href="#Helper-187"><span class="linenos"> 187</span></a>        <span class="c1">#function for regex replacement</span>
</span><span id="Helper-188"><a href="#Helper-188"><span class="linenos"> 188</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="Helper-189"><a href="#Helper-189"><span class="linenos"> 189</span></a>        <span class="k">def</span> <span class="nf">replace_text</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="Helper-190"><a href="#Helper-190"><span class="linenos"> 190</span></a>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-191"><a href="#Helper-191"><span class="linenos"> 191</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">excref</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper-192"><a href="#Helper-192"><span class="linenos"> 192</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-193"><a href="#Helper-193"><span class="linenos"> 193</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">excref[</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">]</span><span class="se">{{</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
</span><span id="Helper-194"><a href="#Helper-194"><span class="linenos"> 194</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-195"><a href="#Helper-195"><span class="linenos"> 195</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">exhyperref</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper-196"><a href="#Helper-196"><span class="linenos"> 196</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-197"><a href="#Helper-197"><span class="linenos"> 197</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">exhyperref[</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">]</span><span class="se">{{</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
</span><span id="Helper-198"><a href="#Helper-198"><span class="linenos"> 198</span></a>
</span><span id="Helper-199"><a href="#Helper-199"><span class="linenos"> 199</span></a>
</span><span id="Helper-200"><a href="#Helper-200"><span class="linenos"> 200</span></a>        <span class="c1"># Update documents.tex</span>
</span><span id="Helper-201"><a href="#Helper-201"><span class="linenos"> 201</span></a>
</span><span id="Helper-202"><a href="#Helper-202"><span class="linenos"> 202</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">old_reference</span><span class="p">)</span>
</span><span id="Helper-203"><a href="#Helper-203"><span class="linenos"> 203</span></a>
</span><span id="Helper-204"><a href="#Helper-204"><span class="linenos"> 204</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-205"><a href="#Helper-205"><span class="linenos"> 205</span></a>
</span><span id="Helper-206"><a href="#Helper-206"><span class="linenos"> 206</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-207"><a href="#Helper-207"><span class="linenos"> 207</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-208"><a href="#Helper-208"><span class="linenos"> 208</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument\[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;\-\]\{&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument[&#39;</span> <span class="o">+</span> <span class="n">new_reference</span> <span class="o">+</span> <span class="s1">&#39;-]{&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-209"><a href="#Helper-209"><span class="linenos"> 209</span></a>        
</span><span id="Helper-210"><a href="#Helper-210"><span class="linenos"> 210</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-211"><a href="#Helper-211"><span class="linenos"> 211</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="Helper-212"><a href="#Helper-212"><span class="linenos"> 212</span></a>
</span><span id="Helper-213"><a href="#Helper-213"><span class="linenos"> 213</span></a>
</span><span id="Helper-214"><a href="#Helper-214"><span class="linenos"> 214</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> 
</span><span id="Helper-215"><a href="#Helper-215"><span class="linenos"> 215</span></a>            <span class="n">backrefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper-216"><a href="#Helper-216"><span class="linenos"> 216</span></a>            <span class="k">for</span> <span class="n">backref</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">:</span>
</span><span id="Helper-217"><a href="#Helper-217"><span class="linenos"> 217</span></a>                <span class="n">backrefs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">backref</span><span class="p">)</span>
</span><span id="Helper-218"><a href="#Helper-218"><span class="linenos"> 218</span></a>            <span class="k">for</span> <span class="n">backref</span> <span class="ow">in</span> <span class="n">backrefs</span><span class="p">:</span>
</span><span id="Helper-219"><a href="#Helper-219"><span class="linenos"> 219</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-220"><a href="#Helper-220"><span class="linenos"> 220</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">backref</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-221"><a href="#Helper-221"><span class="linenos"> 221</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-222"><a href="#Helper-222"><span class="linenos"> 222</span></a>                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{&#39;</span> <span class="o">+</span> <span class="n">old_reference</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">replace_text</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-223"><a href="#Helper-223"><span class="linenos"> 223</span></a>
</span><span id="Helper-224"><a href="#Helper-224"><span class="linenos"> 224</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">backref</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-225"><a href="#Helper-225"><span class="linenos"> 225</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="Helper-226"><a href="#Helper-226"><span class="linenos"> 226</span></a>        
</span><span id="Helper-227"><a href="#Helper-227"><span class="linenos"> 227</span></a>        <span class="c1">#update note db</span>
</span><span id="Helper-228"><a href="#Helper-228"><span class="linenos"> 228</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">new_reference</span>
</span><span id="Helper-229"><a href="#Helper-229"><span class="linenos"> 229</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-230"><a href="#Helper-230"><span class="linenos"> 230</span></a>
</span><span id="Helper-231"><a href="#Helper-231"><span class="linenos"> 231</span></a>
</span><span id="Helper-232"><a href="#Helper-232"><span class="linenos"> 232</span></a>    <span class="k">def</span> <span class="nf">remove_note</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="Helper-233"><a href="#Helper-233"><span class="linenos"> 233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-234"><a href="#Helper-234"><span class="linenos"> 234</span></a><span class="sd">            Delete a note with given filename</span>
</span><span id="Helper-235"><a href="#Helper-235"><span class="linenos"> 235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-236"><a href="#Helper-236"><span class="linenos"> 236</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-237"><a href="#Helper-237"><span class="linenos"> 237</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-238"><a href="#Helper-238"><span class="linenos"> 238</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Delete database entry? (y/n)&#39;</span><span class="p">)</span> 
</span><span id="Helper-239"><a href="#Helper-239"><span class="linenos"> 239</span></a>            <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper-240"><a href="#Helper-240"><span class="linenos"> 240</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="Helper-241"><a href="#Helper-241"><span class="linenos"> 241</span></a>        <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-242"><a href="#Helper-242"><span class="linenos"> 242</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Helper-243"><a href="#Helper-243"><span class="linenos"> 243</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No note with filename </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> exists in db&#39;</span><span class="p">)</span>
</span><span id="Helper-244"><a href="#Helper-244"><span class="linenos"> 244</span></a>
</span><span id="Helper-245"><a href="#Helper-245"><span class="linenos"> 245</span></a>
</span><span id="Helper-246"><a href="#Helper-246"><span class="linenos"> 246</span></a>
</span><span id="Helper-247"><a href="#Helper-247"><span class="linenos"> 247</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-248"><a href="#Helper-248"><span class="linenos"> 248</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="Helper-249"><a href="#Helper-249"><span class="linenos"> 249</span></a>        
</span><span id="Helper-250"><a href="#Helper-250"><span class="linenos"> 250</span></a>        <span class="n">to_delete</span><span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-251"><a href="#Helper-251"><span class="linenos"> 251</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="Helper-252"><a href="#Helper-252"><span class="linenos"> 252</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">externaldocument\[)(.+?)(\-\]\</span><span class="se">{{</span><span class="s1">)</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">(\</span><span class="se">}}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-253"><a href="#Helper-253"><span class="linenos"> 253</span></a>            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="Helper-254"><a href="#Helper-254"><span class="linenos"> 254</span></a>                <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Helper-255"><a href="#Helper-255"><span class="linenos"> 255</span></a>           
</span><span id="Helper-256"><a href="#Helper-256"><span class="linenos"> 256</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">to_delete</span><span class="p">):</span>
</span><span id="Helper-257"><a href="#Helper-257"><span class="linenos"> 257</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;delete line </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1"> from notes/documents.tex? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper-258"><a href="#Helper-258"><span class="linenos"> 258</span></a>            <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper-259"><a href="#Helper-259"><span class="linenos"> 259</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Helper-260"><a href="#Helper-260"><span class="linenos"> 260</span></a>        
</span><span id="Helper-261"><a href="#Helper-261"><span class="linenos"> 261</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-262"><a href="#Helper-262"><span class="linenos"> 262</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="Helper-263"><a href="#Helper-263"><span class="linenos"> 263</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Helper-264"><a href="#Helper-264"><span class="linenos"> 264</span></a>
</span><span id="Helper-265"><a href="#Helper-265"><span class="linenos"> 265</span></a>
</span><span id="Helper-266"><a href="#Helper-266"><span class="linenos"> 266</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Delete notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper-267"><a href="#Helper-267"><span class="linenos"> 267</span></a>        <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper-268"><a href="#Helper-268"><span class="linenos"> 268</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-269"><a href="#Helper-269"><span class="linenos"> 269</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-270"><a href="#Helper-270"><span class="linenos"> 270</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper-271"><a href="#Helper-271"><span class="linenos"> 271</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error, no such file exists&#39;</span><span class="p">)</span>
</span><span id="Helper-272"><a href="#Helper-272"><span class="linenos"> 272</span></a>
</span><span id="Helper-273"><a href="#Helper-273"><span class="linenos"> 273</span></a>    
</span><span id="Helper-274"><a href="#Helper-274"><span class="linenos"> 274</span></a>
</span><span id="Helper-275"><a href="#Helper-275"><span class="linenos"> 275</span></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">biber</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Helper-276"><a href="#Helper-276"><span class="linenos"> 276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-277"><a href="#Helper-277"><span class="linenos"> 277</span></a>
</span><span id="Helper-278"><a href="#Helper-278"><span class="linenos"> 278</span></a><span class="sd">            Render the LaTeX file. By default renders as a pdf and output is stored in the folder /pdf. The other format option is html, although support is currently experimental.</span>
</span><span id="Helper-279"><a href="#Helper-279"><span class="linenos"> 279</span></a>
</span><span id="Helper-280"><a href="#Helper-280"><span class="linenos"> 280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-281"><a href="#Helper-281"><span class="linenos"> 281</span></a>
</span><span id="Helper-282"><a href="#Helper-282"><span class="linenos"> 282</span></a>        <span class="k">if</span> <span class="n">biber</span><span class="p">:</span>
</span><span id="Helper-283"><a href="#Helper-283"><span class="linenos"> 283</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="Helper-284"><a href="#Helper-284"><span class="linenos"> 284</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-285"><a href="#Helper-285"><span class="linenos"> 285</span></a>
</span><span id="Helper-286"><a href="#Helper-286"><span class="linenos"> 286</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper-287"><a href="#Helper-287"><span class="linenos"> 287</span></a>        <span class="n">command</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span>
</span><span id="Helper-288"><a href="#Helper-288"><span class="linenos"> 288</span></a>        
</span><span id="Helper-289"><a href="#Helper-289"><span class="linenos"> 289</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-290"><a href="#Helper-290"><span class="linenos"> 290</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="Helper-291"><a href="#Helper-291"><span class="linenos"> 291</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-292"><a href="#Helper-292"><span class="linenos"> 292</span></a>            <span class="k">pass</span>
</span><span id="Helper-293"><a href="#Helper-293"><span class="linenos"> 293</span></a>
</span><span id="Helper-294"><a href="#Helper-294"><span class="linenos"> 294</span></a>        
</span><span id="Helper-295"><a href="#Helper-295"><span class="linenos"> 295</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-296"><a href="#Helper-296"><span class="linenos"> 296</span></a>        <span class="n">linked_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper-297"><a href="#Helper-297"><span class="linenos"> 297</span></a>
</span><span id="Helper-298"><a href="#Helper-298"><span class="linenos"> 298</span></a>        <span class="n">external_documents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Helper-299"><a href="#Helper-299"><span class="linenos"> 299</span></a>        <span class="n">references</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper-300"><a href="#Helper-300"><span class="linenos"> 300</span></a>
</span><span id="Helper-301"><a href="#Helper-301"><span class="linenos"> 301</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
</span><span id="Helper-302"><a href="#Helper-302"><span class="linenos"> 302</span></a>            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">:</span>
</span><span id="Helper-303"><a href="#Helper-303"><span class="linenos"> 303</span></a>                <span class="n">source</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">source</span>
</span><span id="Helper-304"><a href="#Helper-304"><span class="linenos"> 304</span></a>                <span class="n">references</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="Helper-305"><a href="#Helper-305"><span class="linenos"> 305</span></a>                <span class="n">linked_files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">reference</span><span class="p">)</span>
</span><span id="Helper-306"><a href="#Helper-306"><span class="linenos"> 306</span></a>
</span><span id="Helper-307"><a href="#Helper-307"><span class="linenos"> 307</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
</span><span id="Helper-308"><a href="#Helper-308"><span class="linenos"> 308</span></a>            <span class="n">target_note</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span>
</span><span id="Helper-309"><a href="#Helper-309"><span class="linenos"> 309</span></a>            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-310"><a href="#Helper-310"><span class="linenos"> 310</span></a>                <span class="n">references</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_note</span><span class="p">)</span> 
</span><span id="Helper-311"><a href="#Helper-311"><span class="linenos"> 311</span></a>      
</span><span id="Helper-312"><a href="#Helper-312"><span class="linenos"> 312</span></a>        <span class="c1">#inject external documents </span>
</span><span id="Helper-313"><a href="#Helper-313"><span class="linenos"> 313</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper-314"><a href="#Helper-314"><span class="linenos"> 314</span></a>            <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">references</span><span class="p">:</span>
</span><span id="Helper-315"><a href="#Helper-315"><span class="linenos"> 315</span></a>                <span class="k">if</span> <span class="n">reference</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-316"><a href="#Helper-316"><span class="linenos"> 316</span></a>                    <span class="n">external_documents</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">externaldocument[</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">-]</span><span class="se">{{</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="se">}}\n</span><span class="s2">&quot;</span>
</span><span id="Helper-317"><a href="#Helper-317"><span class="linenos"> 317</span></a>       
</span><span id="Helper-318"><a href="#Helper-318"><span class="linenos"> 318</span></a>        <span class="n">referenced_by_section</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section*{Referenced In}</span><span class="se">\n\\</span><span class="s2">begin</span><span class="si">{itemize}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Helper-319"><a href="#Helper-319"><span class="linenos"> 319</span></a>        <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">linked_files</span><span class="p">:</span>
</span><span id="Helper-320"><a href="#Helper-320"><span class="linenos"> 320</span></a>            <span class="n">referenced_by_section</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">item </span><span class="se">\\</span><span class="s2">excref</span><span class="se">{{</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>
</span><span id="Helper-321"><a href="#Helper-321"><span class="linenos"> 321</span></a>
</span><span id="Helper-322"><a href="#Helper-322"><span class="linenos"> 322</span></a>        <span class="n">referenced_by_section</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{itemize}</span><span class="s2">&quot;</span>
</span><span id="Helper-323"><a href="#Helper-323"><span class="linenos"> 323</span></a>
</span><span id="Helper-324"><a href="#Helper-324"><span class="linenos"> 324</span></a>        
</span><span id="Helper-325"><a href="#Helper-325"><span class="linenos"> 325</span></a>
</span><span id="Helper-326"><a href="#Helper-326"><span class="linenos"> 326</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="Helper-327"><a href="#Helper-327"><span class="linenos"> 327</span></a>
</span><span id="Helper-328"><a href="#Helper-328"><span class="linenos"> 328</span></a>
</span><span id="Helper-329"><a href="#Helper-329"><span class="linenos"> 329</span></a>        <span class="n">path_to_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;../notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="Helper-330"><a href="#Helper-330"><span class="linenos"> 330</span></a>
</span><span id="Helper-331"><a href="#Helper-331"><span class="linenos"> 331</span></a>
</span><span id="Helper-332"><a href="#Helper-332"><span class="linenos"> 332</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-333"><a href="#Helper-333"><span class="linenos"> 333</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="Helper-334"><a href="#Helper-334"><span class="linenos"> 334</span></a>                <span class="k">pass</span>
</span><span id="Helper-335"><a href="#Helper-335"><span class="linenos"> 335</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper-336"><a href="#Helper-336"><span class="linenos"> 336</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No such file!&#39;</span><span class="p">)</span>
</span><span id="Helper-337"><a href="#Helper-337"><span class="linenos"> 337</span></a>            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t find </span><span class="si">{</span><span class="n">path_to_file</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper-338"><a href="#Helper-338"><span class="linenos"> 338</span></a>
</span><span id="Helper-339"><a href="#Helper-339"><span class="linenos"> 339</span></a>
</span><span id="Helper-340"><a href="#Helper-340"><span class="linenos"> 340</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-341"><a href="#Helper-341"><span class="linenos"> 341</span></a>            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="Helper-342"><a href="#Helper-342"><span class="linenos"> 342</span></a>
</span><span id="Helper-343"><a href="#Helper-343"><span class="linenos"> 343</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="Helper-344"><a href="#Helper-344"><span class="linenos"> 344</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;--jobname=</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Helper-345"><a href="#Helper-345"><span class="linenos"> 345</span></a>        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper-346"><a href="#Helper-346"><span class="linenos"> 346</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">]</span> <span class="o">+</span> <span class="n">options</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&quot;svg-&quot;&#39;</span><span class="p">]</span>
</span><span id="Helper-347"><a href="#Helper-347"><span class="linenos"> 347</span></a>            <span class="c1">#options = [&#39;-j&#39;, filename] + options</span>
</span><span id="Helper-348"><a href="#Helper-348"><span class="linenos"> 348</span></a>            
</span><span id="Helper-349"><a href="#Helper-349"><span class="linenos"> 349</span></a> 
</span><span id="Helper-350"><a href="#Helper-350"><span class="linenos"> 350</span></a>
</span><span id="Helper-351"><a href="#Helper-351"><span class="linenos"> 351</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Helper-352"><a href="#Helper-352"><span class="linenos"> 352</span></a>
</span><span id="Helper-353"><a href="#Helper-353"><span class="linenos"> 353</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper-354"><a href="#Helper-354"><span class="linenos"> 354</span></a>            <span class="n">document</span> <span class="o">+=</span> <span class="n">referenced_by_section</span>
</span><span id="Helper-355"><a href="#Helper-355"><span class="linenos"> 355</span></a>
</span><span id="Helper-356"><a href="#Helper-356"><span class="linenos"> 356</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper-357"><a href="#Helper-357"><span class="linenos"> 357</span></a>            <span class="c1">#replace include with preamble_html and inject external documents</span>
</span><span id="Helper-358"><a href="#Helper-358"><span class="linenos"> 358</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subimport{../template}</span><span class="si">{preamble.tex}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subimport{../template}</span><span class="si">{preamble_html.tex}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">external_documents</span><span class="p">)</span>
</span><span id="Helper-359"><a href="#Helper-359"><span class="linenos"> 359</span></a>
</span><span id="Helper-360"><a href="#Helper-360"><span class="linenos"> 360</span></a>        <span class="n">document</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{document}</span><span class="s2">&quot;</span>
</span><span id="Helper-361"><a href="#Helper-361"><span class="linenos"> 361</span></a>
</span><span id="Helper-362"><a href="#Helper-362"><span class="linenos"> 362</span></a>
</span><span id="Helper-363"><a href="#Helper-363"><span class="linenos"> 363</span></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">options</span><span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper-364"><a href="#Helper-364"><span class="linenos"> 364</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
</span><span id="Helper-365"><a href="#Helper-365"><span class="linenos"> 365</span></a>
</span><span id="Helper-366"><a href="#Helper-366"><span class="linenos"> 366</span></a>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper-367"><a href="#Helper-367"><span class="linenos"> 367</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to compile&#39;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span> <span class="c1">#TODO: Exceptions</span>
</span><span id="Helper-368"><a href="#Helper-368"><span class="linenos"> 368</span></a>            <span class="k">return</span> <span class="n">process</span>
</span><span id="Helper-369"><a href="#Helper-369"><span class="linenos"> 369</span></a>
</span><span id="Helper-370"><a href="#Helper-370"><span class="linenos"> 370</span></a>
</span><span id="Helper-371"><a href="#Helper-371"><span class="linenos"> 371</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper-372"><a href="#Helper-372"><span class="linenos"> 372</span></a>            <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Helper-373"><a href="#Helper-373"><span class="linenos"> 373</span></a>        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="Helper-374"><a href="#Helper-374"><span class="linenos"> 374</span></a>            <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Helper-375"><a href="#Helper-375"><span class="linenos"> 375</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-376"><a href="#Helper-376"><span class="linenos"> 376</span></a>        
</span><span id="Helper-377"><a href="#Helper-377"><span class="linenos"> 377</span></a>        <span class="k">return</span> <span class="n">process</span>
</span><span id="Helper-378"><a href="#Helper-378"><span class="linenos"> 378</span></a>
</span><span id="Helper-379"><a href="#Helper-379"><span class="linenos"> 379</span></a>        
</span><span id="Helper-380"><a href="#Helper-380"><span class="linenos"> 380</span></a>
</span><span id="Helper-381"><a href="#Helper-381"><span class="linenos"> 381</span></a>    <span class="k">def</span> <span class="nf">render_all</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="Helper-382"><a href="#Helper-382"><span class="linenos"> 382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-383"><a href="#Helper-383"><span class="linenos"> 383</span></a><span class="sd">            Function to replace renderallhtml and renderallpdf, rendering notes in a sensible order with regards to dependencies for PDFLaTeX links. Not currently implemented.</span>
</span><span id="Helper-384"><a href="#Helper-384"><span class="linenos"> 384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-385"><a href="#Helper-385"><span class="linenos"> 385</span></a>        <span class="k">pass</span>
</span><span id="Helper-386"><a href="#Helper-386"><span class="linenos"> 386</span></a>
</span><span id="Helper-387"><a href="#Helper-387"><span class="linenos"> 387</span></a>        
</span><span id="Helper-388"><a href="#Helper-388"><span class="linenos"> 388</span></a>    <span class="k">def</span> <span class="nf">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="Helper-389"><a href="#Helper-389"><span class="linenos"> 389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-390"><a href="#Helper-390"><span class="linenos"> 390</span></a>
</span><span id="Helper-391"><a href="#Helper-391"><span class="linenos"> 391</span></a><span class="sd">            Run biber on the render of the note. Folder can be either html or pdf, depending on the format.</span>
</span><span id="Helper-392"><a href="#Helper-392"><span class="linenos"> 392</span></a>
</span><span id="Helper-393"><a href="#Helper-393"><span class="linenos"> 393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-394"><a href="#Helper-394"><span class="linenos"> 394</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper-395"><a href="#Helper-395"><span class="linenos"> 395</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="Helper-396"><a href="#Helper-396"><span class="linenos"> 396</span></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;biber&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper-397"><a href="#Helper-397"><span class="linenos"> 397</span></a>        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span>
</span><span id="Helper-398"><a href="#Helper-398"><span class="linenos"> 398</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
</span><span id="Helper-399"><a href="#Helper-399"><span class="linenos"> 399</span></a>
</span><span id="Helper-400"><a href="#Helper-400"><span class="linenos"> 400</span></a>        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">error</span>
</span><span id="Helper-401"><a href="#Helper-401"><span class="linenos"> 401</span></a>        
</span><span id="Helper-402"><a href="#Helper-402"><span class="linenos"> 402</span></a>
</span><span id="Helper-403"><a href="#Helper-403"><span class="linenos"> 403</span></a>    <span class="k">def</span> <span class="nf">render_all_html</span><span class="p">():</span>
</span><span id="Helper-404"><a href="#Helper-404"><span class="linenos"> 404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-405"><a href="#Helper-405"><span class="linenos"> 405</span></a><span class="sd">            Renderes all the notes using make4ht. Saves output in /html</span>
</span><span id="Helper-406"><a href="#Helper-406"><span class="linenos"> 406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-407"><a href="#Helper-407"><span class="linenos"> 407</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper-408"><a href="#Helper-408"><span class="linenos"> 408</span></a>        
</span><span id="Helper-409"><a href="#Helper-409"><span class="linenos"> 409</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper-410"><a href="#Helper-410"><span class="linenos"> 410</span></a>        
</span><span id="Helper-411"><a href="#Helper-411"><span class="linenos"> 411</span></a>
</span><span id="Helper-412"><a href="#Helper-412"><span class="linenos"> 412</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 1&#39;</span><span class="p">)</span>
</span><span id="Helper-413"><a href="#Helper-413"><span class="linenos"> 413</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-414"><a href="#Helper-414"><span class="linenos"> 414</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper-415"><a href="#Helper-415"><span class="linenos"> 415</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-416"><a href="#Helper-416"><span class="linenos"> 416</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> 
</span><span id="Helper-417"><a href="#Helper-417"><span class="linenos"> 417</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper-418"><a href="#Helper-418"><span class="linenos"> 418</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running biber...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-419"><a href="#Helper-419"><span class="linenos"> 419</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span><span id="Helper-420"><a href="#Helper-420"><span class="linenos"> 420</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper-421"><a href="#Helper-421"><span class="linenos"> 421</span></a>        
</span><span id="Helper-422"><a href="#Helper-422"><span class="linenos"> 422</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 2&#39;</span><span class="p">)</span>
</span><span id="Helper-423"><a href="#Helper-423"><span class="linenos"> 423</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-424"><a href="#Helper-424"><span class="linenos"> 424</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper-425"><a href="#Helper-425"><span class="linenos"> 425</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-426"><a href="#Helper-426"><span class="linenos"> 426</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span><span id="Helper-427"><a href="#Helper-427"><span class="linenos"> 427</span></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper-428"><a href="#Helper-428"><span class="linenos"> 428</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper-429"><a href="#Helper-429"><span class="linenos"> 429</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-430"><a href="#Helper-430"><span class="linenos"> 430</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="Helper-431"><a href="#Helper-431"><span class="linenos"> 431</span></a>       
</span><span id="Helper-432"><a href="#Helper-432"><span class="linenos"> 432</span></a>       
</span><span id="Helper-433"><a href="#Helper-433"><span class="linenos"> 433</span></a>    <span class="k">def</span> <span class="nf">render_all_pdf</span><span class="p">():</span>
</span><span id="Helper-434"><a href="#Helper-434"><span class="linenos"> 434</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-435"><a href="#Helper-435"><span class="linenos"> 435</span></a><span class="sd">            Renderes all the notes using pdflatex. Saves output in /pdf</span>
</span><span id="Helper-436"><a href="#Helper-436"><span class="linenos"> 436</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-437"><a href="#Helper-437"><span class="linenos"> 437</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper-438"><a href="#Helper-438"><span class="linenos"> 438</span></a>        
</span><span id="Helper-439"><a href="#Helper-439"><span class="linenos"> 439</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper-440"><a href="#Helper-440"><span class="linenos"> 440</span></a>        
</span><span id="Helper-441"><a href="#Helper-441"><span class="linenos"> 441</span></a>
</span><span id="Helper-442"><a href="#Helper-442"><span class="linenos"> 442</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 1&#39;</span><span class="p">)</span>
</span><span id="Helper-443"><a href="#Helper-443"><span class="linenos"> 443</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-444"><a href="#Helper-444"><span class="linenos"> 444</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper-445"><a href="#Helper-445"><span class="linenos"> 445</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-446"><a href="#Helper-446"><span class="linenos"> 446</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
</span><span id="Helper-447"><a href="#Helper-447"><span class="linenos"> 447</span></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="Helper-448"><a href="#Helper-448"><span class="linenos"> 448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper-449"><a href="#Helper-449"><span class="linenos"> 449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running biber...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-450"><a href="#Helper-450"><span class="linenos"> 450</span></a>                <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-451"><a href="#Helper-451"><span class="linenos"> 451</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper-452"><a href="#Helper-452"><span class="linenos"> 452</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-453"><a href="#Helper-453"><span class="linenos"> 453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error!&#39;</span><span class="p">)</span>
</span><span id="Helper-454"><a href="#Helper-454"><span class="linenos"> 454</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="Helper-455"><a href="#Helper-455"><span class="linenos"> 455</span></a>        
</span><span id="Helper-456"><a href="#Helper-456"><span class="linenos"> 456</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 2&#39;</span><span class="p">)</span>
</span><span id="Helper-457"><a href="#Helper-457"><span class="linenos"> 457</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-458"><a href="#Helper-458"><span class="linenos"> 458</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper-459"><a href="#Helper-459"><span class="linenos"> 459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-460"><a href="#Helper-460"><span class="linenos"> 460</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-461"><a href="#Helper-461"><span class="linenos"> 461</span></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="Helper-462"><a href="#Helper-462"><span class="linenos"> 462</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper-463"><a href="#Helper-463"><span class="linenos"> 463</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-464"><a href="#Helper-464"><span class="linenos"> 464</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</span><span id="Helper-465"><a href="#Helper-465"><span class="linenos"> 465</span></a>
</span><span id="Helper-466"><a href="#Helper-466"><span class="linenos"> 466</span></a>
</span><span id="Helper-467"><a href="#Helper-467"><span class="linenos"> 467</span></a>    <span class="k">def</span> <span class="nf">render_updates</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="Helper-468"><a href="#Helper-468"><span class="linenos"> 468</span></a>        <span class="n">updated</span><span class="p">,</span> <span class="n">new_links</span><span class="p">,</span> <span class="n">run_biber</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="Helper-469"><a href="#Helper-469"><span class="linenos"> 469</span></a>
</span><span id="Helper-470"><a href="#Helper-470"><span class="linenos"> 470</span></a>        
</span><span id="Helper-471"><a href="#Helper-471"><span class="linenos"> 471</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="Helper-472"><a href="#Helper-472"><span class="linenos"> 472</span></a>            <span class="k">if</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
</span><span id="Helper-473"><a href="#Helper-473"><span class="linenos"> 473</span></a>                <span class="k">continue</span>
</span><span id="Helper-474"><a href="#Helper-474"><span class="linenos"> 474</span></a>            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="Helper-475"><a href="#Helper-475"><span class="linenos"> 475</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span><span class="p">:</span>
</span><span id="Helper-476"><a href="#Helper-476"><span class="linenos"> 476</span></a>                    <span class="n">updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-477"><a href="#Helper-477"><span class="linenos"> 477</span></a>                    <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Helper-478"><a href="#Helper-478"><span class="linenos"> 478</span></a>                    <span class="c1">#fix reference in</span>
</span><span id="Helper-479"><a href="#Helper-479"><span class="linenos"> 479</span></a>                    <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">])</span>
</span><span id="Helper-480"><a href="#Helper-480"><span class="linenos"> 480</span></a>            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper-481"><a href="#Helper-481"><span class="linenos"> 481</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span><span class="p">:</span>
</span><span id="Helper-482"><a href="#Helper-482"><span class="linenos"> 482</span></a>                    <span class="n">updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-483"><a href="#Helper-483"><span class="linenos"> 483</span></a>                    <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Helper-484"><a href="#Helper-484"><span class="linenos"> 484</span></a>                    <span class="c1">#fix referenced in</span>
</span><span id="Helper-485"><a href="#Helper-485"><span class="linenos"> 485</span></a>                    <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">])</span>
</span><span id="Helper-486"><a href="#Helper-486"><span class="linenos"> 486</span></a>
</span><span id="Helper-487"><a href="#Helper-487"><span class="linenos"> 487</span></a>        
</span><span id="Helper-488"><a href="#Helper-488"><span class="linenos"> 488</span></a>        <span class="c1">#render the updated files</span>
</span><span id="Helper-489"><a href="#Helper-489"><span class="linenos"> 489</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
</span><span id="Helper-490"><a href="#Helper-490"><span class="linenos"> 490</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rendering </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper-491"><a href="#Helper-491"><span class="linenos"> 491</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">])</span>
</span><span id="Helper-492"><a href="#Helper-492"><span class="linenos"> 492</span></a>
</span><span id="Helper-493"><a href="#Helper-493"><span class="linenos"> 493</span></a>
</span><span id="Helper-494"><a href="#Helper-494"><span class="linenos"> 494</span></a>        <span class="n">rerendered</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-495"><a href="#Helper-495"><span class="linenos"> 495</span></a>
</span><span id="Helper-496"><a href="#Helper-496"><span class="linenos"> 496</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">new_links</span><span class="p">:</span>
</span><span id="Helper-497"><a href="#Helper-497"><span class="linenos"> 497</span></a>            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span> <span class="ow">in</span> <span class="n">rerendered</span><span class="p">:</span>
</span><span id="Helper-498"><a href="#Helper-498"><span class="linenos"> 498</span></a>                <span class="k">continue</span>
</span><span id="Helper-499"><a href="#Helper-499"><span class="linenos"> 499</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rendering </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper-500"><a href="#Helper-500"><span class="linenos"> 500</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</span><span id="Helper-501"><a href="#Helper-501"><span class="linenos"> 501</span></a>            <span class="n">rerendered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-502"><a href="#Helper-502"><span class="linenos"> 502</span></a>                
</span><span id="Helper-503"><a href="#Helper-503"><span class="linenos"> 503</span></a>
</span><span id="Helper-504"><a href="#Helper-504"><span class="linenos"> 504</span></a>
</span><span id="Helper-505"><a href="#Helper-505"><span class="linenos"> 505</span></a>
</span><span id="Helper-506"><a href="#Helper-506"><span class="linenos"> 506</span></a>    <span class="k">def</span> <span class="nf">synchronize</span><span class="p">():</span>
</span><span id="Helper-507"><a href="#Helper-507"><span class="linenos"> 507</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-508"><a href="#Helper-508"><span class="linenos"> 508</span></a><span class="sd">            Reads all the files that have been changed since the last call of this function and updates the database</span>
</span><span id="Helper-509"><a href="#Helper-509"><span class="linenos"> 509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-510"><a href="#Helper-510"><span class="linenos"> 510</span></a>
</span><span id="Helper-511"><a href="#Helper-511"><span class="linenos"> 511</span></a>
</span><span id="Helper-512"><a href="#Helper-512"><span class="linenos"> 512</span></a>        <span class="c1">#loop through all the tracked notes and check for required updates</span>
</span><span id="Helper-513"><a href="#Helper-513"><span class="linenos"> 513</span></a>        <span class="n">to_read</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-514"><a href="#Helper-514"><span class="linenos"> 514</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="Helper-515"><a href="#Helper-515"><span class="linenos"> 515</span></a>            <span class="c1">#try and get the edit date from the file system. </span>
</span><span id="Helper-516"><a href="#Helper-516"><span class="linenos"> 516</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-517"><a href="#Helper-517"><span class="linenos"> 517</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-518"><a href="#Helper-518"><span class="linenos"> 518</span></a>                <span class="n">modified</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper-519"><a href="#Helper-519"><span class="linenos"> 519</span></a>
</span><span id="Helper-520"><a href="#Helper-520"><span class="linenos"> 520</span></a>                <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span><span class="p">:</span>
</span><span id="Helper-521"><a href="#Helper-521"><span class="linenos"> 521</span></a>                    <span class="n">to_read</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-522"><a href="#Helper-522"><span class="linenos"> 522</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>
</span><span id="Helper-523"><a href="#Helper-523"><span class="linenos"> 523</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-524"><a href="#Helper-524"><span class="linenos"> 524</span></a>
</span><span id="Helper-525"><a href="#Helper-525"><span class="linenos"> 525</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper-526"><a href="#Helper-526"><span class="linenos"> 526</span></a>                <span class="c1">#Todo: file has been deleted or renamed without the database being updated really need to run force_synchronize.</span>
</span><span id="Helper-527"><a href="#Helper-527"><span class="linenos"> 527</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file not found for note with reference </span><span class="si">{note.reference}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper-528"><a href="#Helper-528"><span class="linenos"> 528</span></a>                <span class="k">pass</span>
</span><span id="Helper-529"><a href="#Helper-529"><span class="linenos"> 529</span></a>
</span><span id="Helper-530"><a href="#Helper-530"><span class="linenos"> 530</span></a>        <span class="c1">#update labels </span>
</span><span id="Helper-531"><a href="#Helper-531"><span class="linenos"> 531</span></a>        <span class="n">run_biber</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Helper-532"><a href="#Helper-532"><span class="linenos"> 532</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">to_read</span><span class="p">:</span>
</span><span id="Helper-533"><a href="#Helper-533"><span class="linenos"> 533</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-534"><a href="#Helper-534"><span class="linenos"> 534</span></a>            <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-535"><a href="#Helper-535"><span class="linenos"> 535</span></a>
</span><span id="Helper-536"><a href="#Helper-536"><span class="linenos"> 536</span></a>
</span><span id="Helper-537"><a href="#Helper-537"><span class="linenos"> 537</span></a>        <span class="n">new_links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-538"><a href="#Helper-538"><span class="linenos"> 538</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">to_read</span><span class="p">:</span>
</span><span id="Helper-539"><a href="#Helper-539"><span class="linenos"> 539</span></a>            <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Helper</span><span class="o">.</span><span class="n">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">))</span>
</span><span id="Helper-540"><a href="#Helper-540"><span class="linenos"> 540</span></a>
</span><span id="Helper-541"><a href="#Helper-541"><span class="linenos"> 541</span></a>
</span><span id="Helper-542"><a href="#Helper-542"><span class="linenos"> 542</span></a>        <span class="k">return</span> <span class="n">to_read</span><span class="p">,</span> <span class="n">new_links</span><span class="p">,</span> <span class="n">run_biber</span>
</span><span id="Helper-543"><a href="#Helper-543"><span class="linenos"> 543</span></a>
</span><span id="Helper-544"><a href="#Helper-544"><span class="linenos"> 544</span></a>
</span><span id="Helper-545"><a href="#Helper-545"><span class="linenos"> 545</span></a>
</span><span id="Helper-546"><a href="#Helper-546"><span class="linenos"> 546</span></a>    <span class="k">def</span> <span class="nf">force_synchronize</span><span class="p">():</span>
</span><span id="Helper-547"><a href="#Helper-547"><span class="linenos"> 547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-548"><a href="#Helper-548"><span class="linenos"> 548</span></a><span class="sd">            Reads the file documents.tex and adds these files to the database (/slipbox.db) and checks for files in /notes that aren&#39;t in the documents. Then fixes and confilcts with these before reading the notes and creating database objects for labels, links and citations. </span>
</span><span id="Helper-549"><a href="#Helper-549"><span class="linenos"> 549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-550"><a href="#Helper-550"><span class="linenos"> 550</span></a>        <span class="n">database</span><span class="o">.</span><span class="n">create_all_tables</span><span class="p">()</span>
</span><span id="Helper-551"><a href="#Helper-551"><span class="linenos"> 551</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper-552"><a href="#Helper-552"><span class="linenos"> 552</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">]</span>
</span><span id="Helper-553"><a href="#Helper-553"><span class="linenos"> 553</span></a>        <span class="c1">#get all the tracked notes (the ones in documents.tex)</span>
</span><span id="Helper-554"><a href="#Helper-554"><span class="linenos"> 554</span></a>        <span class="n">tracked_notes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Helper-555"><a href="#Helper-555"><span class="linenos"> 555</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-556"><a href="#Helper-556"><span class="linenos"> 556</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-557"><a href="#Helper-557"><span class="linenos"> 557</span></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">externaldocument\[)(.+?)(\-\]\{)(.+?)(\})&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-558"><a href="#Helper-558"><span class="linenos"> 558</span></a>                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="Helper-559"><a href="#Helper-559"><span class="linenos"> 559</span></a>                    <span class="n">reference_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Helper-560"><a href="#Helper-560"><span class="linenos"> 560</span></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Helper-561"><a href="#Helper-561"><span class="linenos"> 561</span></a>
</span><span id="Helper-562"><a href="#Helper-562"><span class="linenos"> 562</span></a>
</span><span id="Helper-563"><a href="#Helper-563"><span class="linenos"> 563</span></a>                    <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-564"><a href="#Helper-564"><span class="linenos"> 564</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> with reference </span><span class="si">{</span><span class="n">reference_name</span><span class="si">}</span><span class="s1"> missing from notes. Make new note now? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper-565"><a href="#Helper-565"><span class="linenos"> 565</span></a>                        <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper-566"><a href="#Helper-566"><span class="linenos"> 566</span></a>                            <span class="n">Helper</span><span class="o">.</span><span class="n">__createnotefile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-567"><a href="#Helper-567"><span class="linenos"> 567</span></a>                            <span class="n">tracked_notes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="Helper-568"><a href="#Helper-568"><span class="linenos"> 568</span></a>                            
</span><span id="Helper-569"><a href="#Helper-569"><span class="linenos"> 569</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-570"><a href="#Helper-570"><span class="linenos"> 570</span></a>                        <span class="n">tracked_notes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="Helper-571"><a href="#Helper-571"><span class="linenos"> 571</span></a>
</span><span id="Helper-572"><a href="#Helper-572"><span class="linenos"> 572</span></a>        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">reference_name</span> <span class="ow">in</span> <span class="n">tracked_notes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Helper-573"><a href="#Helper-573"><span class="linenos"> 573</span></a>            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-574"><a href="#Helper-574"><span class="linenos"> 574</span></a>            <span class="n">modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
</span><span id="Helper-575"><a href="#Helper-575"><span class="linenos"> 575</span></a>            
</span><span id="Helper-576"><a href="#Helper-576"><span class="linenos"> 576</span></a>
</span><span id="Helper-577"><a href="#Helper-577"><span class="linenos"> 577</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-578"><a href="#Helper-578"><span class="linenos"> 578</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper-579"><a href="#Helper-579"><span class="linenos"> 579</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">modified</span>
</span><span id="Helper-580"><a href="#Helper-580"><span class="linenos"> 580</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-581"><a href="#Helper-581"><span class="linenos"> 581</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span>
</span><span id="Helper-582"><a href="#Helper-582"><span class="linenos"> 582</span></a>
</span><span id="Helper-583"><a href="#Helper-583"><span class="linenos"> 583</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-584"><a href="#Helper-584"><span class="linenos"> 584</span></a>                    <span class="n">html_render</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;html/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">))</span>
</span><span id="Helper-585"><a href="#Helper-585"><span class="linenos"> 585</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="o">=</span> <span class="n">html_render</span>
</span><span id="Helper-586"><a href="#Helper-586"><span class="linenos"> 586</span></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Helper-587"><a href="#Helper-587"><span class="linenos"> 587</span></a>                    <span class="c1">#print(f&#39;{filename} is yet to be rendered as html&#39;)</span>
</span><span id="Helper-588"><a href="#Helper-588"><span class="linenos"> 588</span></a>                    <span class="k">pass</span>
</span><span id="Helper-589"><a href="#Helper-589"><span class="linenos"> 589</span></a>                
</span><span id="Helper-590"><a href="#Helper-590"><span class="linenos"> 590</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-591"><a href="#Helper-591"><span class="linenos"> 591</span></a>                    <span class="n">pdf_render</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pdf/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">))</span>
</span><span id="Helper-592"><a href="#Helper-592"><span class="linenos"> 592</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="o">=</span> <span class="n">pdf_render</span>
</span><span id="Helper-593"><a href="#Helper-593"><span class="linenos"> 593</span></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Helper-594"><a href="#Helper-594"><span class="linenos"> 594</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> is yet to be rendered as pdf&#39;</span><span class="p">)</span>
</span><span id="Helper-595"><a href="#Helper-595"><span class="linenos"> 595</span></a>                
</span><span id="Helper-596"><a href="#Helper-596"><span class="linenos"> 596</span></a>
</span><span id="Helper-597"><a href="#Helper-597"><span class="linenos"> 597</span></a>
</span><span id="Helper-598"><a href="#Helper-598"><span class="linenos"> 598</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">==</span> <span class="n">reference_name</span><span class="p">:</span>
</span><span id="Helper-599"><a href="#Helper-599"><span class="linenos"> 599</span></a>                    <span class="k">pass</span> <span class="c1">#nothing to do</span>
</span><span id="Helper-600"><a href="#Helper-600"><span class="linenos"> 600</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-601"><a href="#Helper-601"><span class="linenos"> 601</span></a>                    <span class="c1">#update note reference to the one in documents.tex, might want to check that this is the right thing to do</span>
</span><span id="Helper-602"><a href="#Helper-602"><span class="linenos"> 602</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="Helper-603"><a href="#Helper-603"><span class="linenos"> 603</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-604"><a href="#Helper-604"><span class="linenos"> 604</span></a>            
</span><span id="Helper-605"><a href="#Helper-605"><span class="linenos"> 605</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-606"><a href="#Helper-606"><span class="linenos"> 606</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-607"><a href="#Helper-607"><span class="linenos"> 607</span></a>                    <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">)</span>
</span><span id="Helper-608"><a href="#Helper-608"><span class="linenos"> 608</span></a>                    <span class="c1">#update the filename in database, might want to check that this is the right thing to do</span>
</span><span id="Helper-609"><a href="#Helper-609"><span class="linenos"> 609</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="Helper-610"><a href="#Helper-610"><span class="linenos"> 610</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-611"><a href="#Helper-611"><span class="linenos"> 611</span></a>                <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-612"><a href="#Helper-612"><span class="linenos"> 612</span></a>                    <span class="c1">#create the note if there are no close matches</span>
</span><span id="Helper-613"><a href="#Helper-613"><span class="linenos"> 613</span></a>                    <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="n">modified</span><span class="p">,</span> <span class="n">last_edit_date</span><span class="o">=</span><span class="n">modified</span><span class="p">)</span>
</span><span id="Helper-614"><a href="#Helper-614"><span class="linenos"> 614</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper-615"><a href="#Helper-615"><span class="linenos"> 615</span></a>
</span><span id="Helper-616"><a href="#Helper-616"><span class="linenos"> 616</span></a>
</span><span id="Helper-617"><a href="#Helper-617"><span class="linenos"> 617</span></a>
</span><span id="Helper-618"><a href="#Helper-618"><span class="linenos"> 618</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-619"><a href="#Helper-619"><span class="linenos"> 619</span></a>            <span class="c1">#add any notes to documents.tex</span>
</span><span id="Helper-620"><a href="#Helper-620"><span class="linenos"> 620</span></a>            <span class="k">if</span> <span class="n">note</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked_notes</span><span class="p">:</span>
</span><span id="Helper-621"><a href="#Helper-621"><span class="linenos"> 621</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">note</span><span class="si">}</span><span class="s1"> not tracked by the file documents.tex. Add to the file now? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper-622"><a href="#Helper-622"><span class="linenos"> 622</span></a>                <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span> 
</span><span id="Helper-623"><a href="#Helper-623"><span class="linenos"> 623</span></a>                    <span class="n">reference</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="Helper-624"><a href="#Helper-624"><span class="linenos"> 624</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reference (defaults to </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">):&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper-625"><a href="#Helper-625"><span class="linenos"> 625</span></a>                    <span class="n">new_reference</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
</span><span id="Helper-626"><a href="#Helper-626"><span class="linenos"> 626</span></a>                    <span class="k">if</span> <span class="n">new_reference</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Helper-627"><a href="#Helper-627"><span class="linenos"> 627</span></a>                        <span class="n">reference</span> <span class="o">=</span> <span class="n">new_reference</span>
</span><span id="Helper-628"><a href="#Helper-628"><span class="linenos"> 628</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-629"><a href="#Helper-629"><span class="linenos"> 629</span></a>                        <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
</span><span id="Helper-630"><a href="#Helper-630"><span class="linenos"> 630</span></a>                        <span class="n">Helper</span><span class="o">.</span><span class="n">addtodocuments</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
</span><span id="Helper-631"><a href="#Helper-631"><span class="linenos"> 631</span></a>                    <span class="k">except</span> <span class="n">pw</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
</span><span id="Helper-632"><a href="#Helper-632"><span class="linenos"> 632</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error adding note, note already exists in database&#39;</span><span class="p">)</span> 
</span><span id="Helper-633"><a href="#Helper-633"><span class="linenos"> 633</span></a>        
</span><span id="Helper-634"><a href="#Helper-634"><span class="linenos"> 634</span></a>        <span class="c1">#add labels</span>
</span><span id="Helper-635"><a href="#Helper-635"><span class="linenos"> 635</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="Helper-636"><a href="#Helper-636"><span class="linenos"> 636</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-637"><a href="#Helper-637"><span class="linenos"> 637</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-638"><a href="#Helper-638"><span class="linenos"> 638</span></a>                   
</span><span id="Helper-639"><a href="#Helper-639"><span class="linenos"> 639</span></a>        <span class="c1">#add connections</span>
</span><span id="Helper-640"><a href="#Helper-640"><span class="linenos"> 640</span></a>
</span><span id="Helper-641"><a href="#Helper-641"><span class="linenos"> 641</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span> 
</span><span id="Helper-642"><a href="#Helper-642"><span class="linenos"> 642</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-643"><a href="#Helper-643"><span class="linenos"> 643</span></a>
</span><span id="Helper-644"><a href="#Helper-644"><span class="linenos"> 644</span></a>
</span><span id="Helper-645"><a href="#Helper-645"><span class="linenos"> 645</span></a>            
</span><span id="Helper-646"><a href="#Helper-646"><span class="linenos"> 646</span></a>
</span><span id="Helper-647"><a href="#Helper-647"><span class="linenos"> 647</span></a>                        
</span><span id="Helper-648"><a href="#Helper-648"><span class="linenos"> 648</span></a>    <span class="k">def</span> <span class="nf">list_unreferenced</span><span class="p">():</span>
</span><span id="Helper-649"><a href="#Helper-649"><span class="linenos"> 649</span></a>        <span class="kn">from</span> <span class="nn">LatexZettel</span> <span class="kn">import</span> <span class="n">analysis</span>
</span><span id="Helper-650"><a href="#Helper-650"><span class="linenos"> 650</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-651"><a href="#Helper-651"><span class="linenos"> 651</span></a><span class="sd">            Prints a list of notes that are not referenced in any other note. These might want to be added to the index, for example. </span>
</span><span id="Helper-652"><a href="#Helper-652"><span class="linenos"> 652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-653"><a href="#Helper-653"><span class="linenos"> 653</span></a>        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="Helper-654"><a href="#Helper-654"><span class="linenos"> 654</span></a>        <span class="n">notes</span><span class="p">,</span> <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">calculate_adjacency_matrix</span><span class="p">()</span>
</span><span id="Helper-655"><a href="#Helper-655"><span class="linenos"> 655</span></a>
</span><span id="Helper-656"><a href="#Helper-656"><span class="linenos"> 656</span></a>        <span class="n">referenced_by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Helper-657"><a href="#Helper-657"><span class="linenos"> 657</span></a>        
</span><span id="Helper-658"><a href="#Helper-658"><span class="linenos"> 658</span></a>        <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Helper-659"><a href="#Helper-659"><span class="linenos"> 659</span></a>        <span class="k">for</span> <span class="n">note</span><span class="p">,</span> <span class="n">links_from</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">referenced_by</span><span class="p">):</span>
</span><span id="Helper-660"><a href="#Helper-660"><span class="linenos"> 660</span></a>            <span class="k">if</span> <span class="n">links_from</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper-661"><a href="#Helper-661"><span class="linenos"> 661</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper-662"><a href="#Helper-662"><span class="linenos"> 662</span></a>                <span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Helper-663"><a href="#Helper-663"><span class="linenos"> 663</span></a>
</span><span id="Helper-664"><a href="#Helper-664"><span class="linenos"> 664</span></a>    <span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper-665"><a href="#Helper-665"><span class="linenos"> 665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-666"><a href="#Helper-666"><span class="linenos"> 666</span></a>
</span><span id="Helper-667"><a href="#Helper-667"><span class="linenos"> 667</span></a><span class="sd">            Open the note default text editor in the directory /notes/slipbox. If no file is passed then this opens </span>
</span><span id="Helper-668"><a href="#Helper-668"><span class="linenos"> 668</span></a>
</span><span id="Helper-669"><a href="#Helper-669"><span class="linenos"> 669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-670"><a href="#Helper-670"><span class="linenos"> 670</span></a>
</span><span id="Helper-671"><a href="#Helper-671"><span class="linenos"> 671</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper-672"><a href="#Helper-672"><span class="linenos"> 672</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-673"><a href="#Helper-673"><span class="linenos"> 673</span></a>            <span class="n">most_recent</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Helper-674"><a href="#Helper-674"><span class="linenos"> 674</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;slipbox&#39;</span><span class="p">))</span>
</span><span id="Helper-675"><a href="#Helper-675"><span class="linenos"> 675</span></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">OPEN_COMMAND</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">most_recent</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="Helper-676"><a href="#Helper-676"><span class="linenos"> 676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-677"><a href="#Helper-677"><span class="linenos"> 677</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;slipbox&#39;</span><span class="p">))</span>
</span><span id="Helper-678"><a href="#Helper-678"><span class="linenos"> 678</span></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">OPEN_COMMAND</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">])</span>
</span><span id="Helper-679"><a href="#Helper-679"><span class="linenos"> 679</span></a>
</span><span id="Helper-680"><a href="#Helper-680"><span class="linenos"> 680</span></a>
</span><span id="Helper-681"><a href="#Helper-681"><span class="linenos"> 681</span></a>    <span class="k">def</span> <span class="nf">to_md</span><span class="p">(</span><span class="n">note_name</span><span class="p">):</span>
</span><span id="Helper-682"><a href="#Helper-682"><span class="linenos"> 682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;            </span>
</span><span id="Helper-683"><a href="#Helper-683"><span class="linenos"> 683</span></a><span class="sd">            Work in progress. Export a LaTeX document note to markdown, and convert references to [[WikiLink]] style references.</span>
</span><span id="Helper-684"><a href="#Helper-684"><span class="linenos"> 684</span></a>
</span><span id="Helper-685"><a href="#Helper-685"><span class="linenos"> 685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-686"><a href="#Helper-686"><span class="linenos"> 686</span></a>        <span class="k">def</span> <span class="nf">replace_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">md_links</span><span class="p">):</span>
</span><span id="Helper-687"><a href="#Helper-687"><span class="linenos"> 687</span></a>            <span class="n">replacement</span> <span class="o">=</span> <span class="s1">&#39;[[&#39;</span>
</span><span id="Helper-688"><a href="#Helper-688"><span class="linenos"> 688</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Helper-689"><a href="#Helper-689"><span class="linenos"> 689</span></a>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
</span><span id="Helper-690"><a href="#Helper-690"><span class="linenos"> 690</span></a>                <span class="n">replacement</span> <span class="o">+=</span> <span class="n">md_links</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span>
</span><span id="Helper-691"><a href="#Helper-691"><span class="linenos"> 691</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;hyper&#39;</span><span class="p">:</span>
</span><span id="Helper-692"><a href="#Helper-692"><span class="linenos"> 692</span></a>                <span class="n">replacement</span> <span class="o">+=</span> <span class="n">md_links</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</span><span id="Helper-693"><a href="#Helper-693"><span class="linenos"> 693</span></a>
</span><span id="Helper-694"><a href="#Helper-694"><span class="linenos"> 694</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">replacement</span><span class="p">)</span>
</span><span id="Helper-695"><a href="#Helper-695"><span class="linenos"> 695</span></a>
</span><span id="Helper-696"><a href="#Helper-696"><span class="linenos"> 696</span></a>            <span class="k">return</span> <span class="n">replacement</span> <span class="o">+</span> <span class="s1">&#39;]]&#39;</span>
</span><span id="Helper-697"><a href="#Helper-697"><span class="linenos"> 697</span></a>        <span class="c1"># load the file and convert exhyperref and excref to Wiki links</span>
</span><span id="Helper-698"><a href="#Helper-698"><span class="linenos"> 698</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-699"><a href="#Helper-699"><span class="linenos"> 699</span></a>        <span class="n">file_references</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-700"><a href="#Helper-700"><span class="linenos"> 700</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-701"><a href="#Helper-701"><span class="linenos"> 701</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-702"><a href="#Helper-702"><span class="linenos"> 702</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Helper-703"><a href="#Helper-703"><span class="linenos"> 703</span></a>                <span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex?(hyper)?(c)?ref(\[([^]+)\])?\{(.*?)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-704"><a href="#Helper-704"><span class="linenos"> 704</span></a>                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="Helper-705"><a href="#Helper-705"><span class="linenos"> 705</span></a>                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-706"><a href="#Helper-706"><span class="linenos"> 706</span></a>                        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="Helper-707"><a href="#Helper-707"><span class="linenos"> 707</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-708"><a href="#Helper-708"><span class="linenos"> 708</span></a>                        <span class="n">label</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
</span><span id="Helper-709"><a href="#Helper-709"><span class="linenos"> 709</span></a>                    <span class="n">file_references</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">label</span><span class="p">))</span> 
</span><span id="Helper-710"><a href="#Helper-710"><span class="linenos"> 710</span></a>                                 
</span><span id="Helper-711"><a href="#Helper-711"><span class="linenos"> 711</span></a>        <span class="n">md_links</span> <span class="o">=</span> <span class="p">{}</span> 
</span><span id="Helper-712"><a href="#Helper-712"><span class="linenos"> 712</span></a>        <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span> <span class="ow">in</span> <span class="n">file_references</span><span class="p">:</span>
</span><span id="Helper-713"><a href="#Helper-713"><span class="linenos"> 713</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-714"><a href="#Helper-714"><span class="linenos"> 714</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
</span><span id="Helper-715"><a href="#Helper-715"><span class="linenos"> 715</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-716"><a href="#Helper-716"><span class="linenos"> 716</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Helper-717"><a href="#Helper-717"><span class="linenos"> 717</span></a>
</span><span id="Helper-718"><a href="#Helper-718"><span class="linenos"> 718</span></a>            <span class="k">if</span> <span class="n">tex_label</span> <span class="o">==</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span>
</span><span id="Helper-719"><a href="#Helper-719"><span class="linenos"> 719</span></a>                <span class="n">md_links</span><span class="p">[(</span><span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span><span class="p">)]</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span>
</span><span id="Helper-720"><a href="#Helper-720"><span class="linenos"> 720</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-721"><a href="#Helper-721"><span class="linenos"> 721</span></a>                <span class="n">md_links</span><span class="p">[(</span><span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">#</span><span class="si">{</span><span class="n">tex_label</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper-722"><a href="#Helper-722"><span class="linenos"> 722</span></a>        <span class="n">new_file</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-723"><a href="#Helper-723"><span class="linenos"> 723</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Helper-724"><a href="#Helper-724"><span class="linenos"> 724</span></a>            <span class="n">new_file</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{(.*?)\}(\{(.*?)\})?&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span> <span class="p">:</span> <span class="n">replace_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">md_links</span><span class="p">),</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-725"><a href="#Helper-725"><span class="linenos"> 725</span></a>
</span><span id="Helper-726"><a href="#Helper-726"><span class="linenos"> 726</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper-727"><a href="#Helper-727"><span class="linenos"> 727</span></a>
</span><span id="Helper-728"><a href="#Helper-728"><span class="linenos"> 728</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span><span id="Helper-729"><a href="#Helper-729"><span class="linenos"> 729</span></a>
</span><span id="Helper-730"><a href="#Helper-730"><span class="linenos"> 730</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;pandoc&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;markdown/</span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s2">.md&quot;</span> <span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="n">new_file</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper-731"><a href="#Helper-731"><span class="linenos"> 731</span></a>
</span><span id="Helper-732"><a href="#Helper-732"><span class="linenos"> 732</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="Helper-733"><a href="#Helper-733"><span class="linenos"> 733</span></a>
</span><span id="Helper-734"><a href="#Helper-734"><span class="linenos"> 734</span></a>
</span><span id="Helper-735"><a href="#Helper-735"><span class="linenos"> 735</span></a>    <span class="k">def</span> <span class="nf">export_project</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">texfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper-736"><a href="#Helper-736"><span class="linenos"> 736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-737"><a href="#Helper-737"><span class="linenos"> 737</span></a>
</span><span id="Helper-738"><a href="#Helper-738"><span class="linenos"> 738</span></a><span class="sd">            Replaces \\transclude calls in a project file with the contents of the notes. Output is saved in project_dir/standalone</span>
</span><span id="Helper-739"><a href="#Helper-739"><span class="linenos"> 739</span></a>
</span><span id="Helper-740"><a href="#Helper-740"><span class="linenos"> 740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-741"><a href="#Helper-741"><span class="linenos"> 741</span></a>
</span><span id="Helper-742"><a href="#Helper-742"><span class="linenos"> 742</span></a>        <span class="k">if</span> <span class="n">texfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-743"><a href="#Helper-743"><span class="linenos"> 743</span></a>            <span class="n">texfile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">project_folder</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="Helper-744"><a href="#Helper-744"><span class="linenos"> 744</span></a>
</span><span id="Helper-745"><a href="#Helper-745"><span class="linenos"> 745</span></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">)</span>
</span><span id="Helper-746"><a href="#Helper-746"><span class="linenos"> 746</span></a>
</span><span id="Helper-747"><a href="#Helper-747"><span class="linenos"> 747</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-748"><a href="#Helper-748"><span class="linenos"> 748</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
</span><span id="Helper-749"><a href="#Helper-749"><span class="linenos"> 749</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-750"><a href="#Helper-750"><span class="linenos"> 750</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Export already exists, continue? (Warning: This will overwrite any changes you have made to the file </span><span class="si">{texfile}</span><span class="s1"> in </span><span class="si">{output_dir}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="Helper-751"><a href="#Helper-751"><span class="linenos"> 751</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper-752"><a href="#Helper-752"><span class="linenos"> 752</span></a>                <span class="k">return</span>
</span><span id="Helper-753"><a href="#Helper-753"><span class="linenos"> 753</span></a>
</span><span id="Helper-754"><a href="#Helper-754"><span class="linenos"> 754</span></a>
</span><span id="Helper-755"><a href="#Helper-755"><span class="linenos"> 755</span></a>
</span><span id="Helper-756"><a href="#Helper-756"><span class="linenos"> 756</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-757"><a href="#Helper-757"><span class="linenos"> 757</span></a>        <span class="n">input_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="n">texfile</span><span class="p">)</span>
</span><span id="Helper-758"><a href="#Helper-758"><span class="linenos"> 758</span></a>        
</span><span id="Helper-759"><a href="#Helper-759"><span class="linenos"> 759</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-760"><a href="#Helper-760"><span class="linenos"> 760</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-761"><a href="#Helper-761"><span class="linenos"> 761</span></a>
</span><span id="Helper-762"><a href="#Helper-762"><span class="linenos"> 762</span></a>                <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">transclude(\[[^]]+\]+)?\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-763"><a href="#Helper-763"><span class="linenos"> 763</span></a>                <span class="n">external_documents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">transclude(\[([^]]+)\])?\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-764"><a href="#Helper-764"><span class="linenos"> 764</span></a>                <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">external_documents</span><span class="p">:</span>
</span><span id="Helper-765"><a href="#Helper-765"><span class="linenos"> 765</span></a>                    <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Helper-766"><a href="#Helper-766"><span class="linenos"> 766</span></a>                    <span class="n">document</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Helper-767"><a href="#Helper-767"><span class="linenos"> 767</span></a>                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-768"><a href="#Helper-768"><span class="linenos"> 768</span></a>                        <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="Helper-769"><a href="#Helper-769"><span class="linenos"> 769</span></a>
</span><span id="Helper-770"><a href="#Helper-770"><span class="linenos"> 770</span></a>                    <span class="n">note_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">document</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-771"><a href="#Helper-771"><span class="linenos"> 771</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">note_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
</span><span id="Helper-772"><a href="#Helper-772"><span class="linenos"> 772</span></a>                        <span class="n">full_document</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
</span><span id="Helper-773"><a href="#Helper-773"><span class="linenos"> 773</span></a>                        <span class="n">import_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%&lt;\*</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;((.|</span><span class="se">\n</span><span class="s1">)*?)%&lt;/</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">full_document</span><span class="p">)</span>
</span><span id="Helper-774"><a href="#Helper-774"><span class="linenos"> 774</span></a>                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">import_text</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-775"><a href="#Helper-775"><span class="linenos"> 775</span></a>
</span><span id="Helper-776"><a href="#Helper-776"><span class="linenos"> 776</span></a>        <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">texfile</span><span class="p">)</span>
</span><span id="Helper-777"><a href="#Helper-777"><span class="linenos"> 777</span></a>
</span><span id="Helper-778"><a href="#Helper-778"><span class="linenos"> 778</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-779"><a href="#Helper-779"><span class="linenos"> 779</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="Helper-780"><a href="#Helper-780"><span class="linenos"> 780</span></a>
</span><span id="Helper-781"><a href="#Helper-781"><span class="linenos"> 781</span></a>    <span class="k">def</span> <span class="nf">export_draft</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper-782"><a href="#Helper-782"><span class="linenos"> 782</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper-783"><a href="#Helper-783"><span class="linenos"> 783</span></a><span class="sd">            Exports the export input_file (a file like /export/example.tex containing \ExecuteMetaData calls) and creates a .tex file (by default in /draft/filename.tex) where the \ExecuteMetadata commands are replaced with the body of the notes that they reference.</span>
</span><span id="Helper-784"><a href="#Helper-784"><span class="linenos"> 784</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper-785"><a href="#Helper-785"><span class="linenos"> 785</span></a>        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-786"><a href="#Helper-786"><span class="linenos"> 786</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-787"><a href="#Helper-787"><span class="linenos"> 787</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">)</span>
</span><span id="Helper-788"><a href="#Helper-788"><span class="linenos"> 788</span></a>            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-789"><a href="#Helper-789"><span class="linenos"> 789</span></a>                <span class="k">pass</span>
</span><span id="Helper-790"><a href="#Helper-790"><span class="linenos"> 790</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Helper-791"><a href="#Helper-791"><span class="linenos"> 791</span></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;draft/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper-792"><a href="#Helper-792"><span class="linenos"> 792</span></a>
</span><span id="Helper-793"><a href="#Helper-793"><span class="linenos"> 793</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-794"><a href="#Helper-794"><span class="linenos"> 794</span></a>    
</span><span id="Helper-795"><a href="#Helper-795"><span class="linenos"> 795</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-796"><a href="#Helper-796"><span class="linenos"> 796</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-797"><a href="#Helper-797"><span class="linenos"> 797</span></a>                <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ExecuteMetaData\[\.\./([^]]+)\]\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-798"><a href="#Helper-798"><span class="linenos"> 798</span></a>                <span class="n">external_documents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ExecuteMetaData\[\.\./([^]]+)\]\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-799"><a href="#Helper-799"><span class="linenos"> 799</span></a>                <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">external_documents</span><span class="p">:</span>
</span><span id="Helper-800"><a href="#Helper-800"><span class="linenos"> 800</span></a>                    <span class="n">import_file</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
</span><span id="Helper-801"><a href="#Helper-801"><span class="linenos"> 801</span></a>                    <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Helper-802"><a href="#Helper-802"><span class="linenos"> 802</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">import_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
</span><span id="Helper-803"><a href="#Helper-803"><span class="linenos"> 803</span></a>                        <span class="n">import_text_file</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="Helper-804"><a href="#Helper-804"><span class="linenos"> 804</span></a>                        <span class="n">import_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%&lt;\*</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;((.|</span><span class="se">\n</span><span class="s1">)*?)%&lt;/</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">import_text_file</span><span class="p">)</span>
</span><span id="Helper-805"><a href="#Helper-805"><span class="linenos"> 805</span></a>                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">import_text</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-806"><a href="#Helper-806"><span class="linenos"> 806</span></a>
</span><span id="Helper-807"><a href="#Helper-807"><span class="linenos"> 807</span></a>
</span><span id="Helper-808"><a href="#Helper-808"><span class="linenos"> 808</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-809"><a href="#Helper-809"><span class="linenos"> 809</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span><span id="Helper-810"><a href="#Helper-810"><span class="linenos"> 810</span></a>
</span><span id="Helper-811"><a href="#Helper-811"><span class="linenos"> 811</span></a>
</span><span id="Helper-812"><a href="#Helper-812"><span class="linenos"> 812</span></a>    <span class="k">def</span> <span class="nf">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="Helper-813"><a href="#Helper-813"><span class="linenos"> 813</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getcitations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-814"><a href="#Helper-814"><span class="linenos"> 814</span></a>        <span class="n">tracked</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">citations</span><span class="p">]</span>
</span><span id="Helper-815"><a href="#Helper-815"><span class="linenos"> 815</span></a>        
</span><span id="Helper-816"><a href="#Helper-816"><span class="linenos"> 816</span></a>        <span class="n">updates_to_citations</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Helper-817"><a href="#Helper-817"><span class="linenos"> 817</span></a>
</span><span id="Helper-818"><a href="#Helper-818"><span class="linenos"> 818</span></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Helper-819"><a href="#Helper-819"><span class="linenos"> 819</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">tracked</span><span class="p">:</span>
</span><span id="Helper-820"><a href="#Helper-820"><span class="linenos"> 820</span></a>                <span class="k">continue</span>
</span><span id="Helper-821"><a href="#Helper-821"><span class="linenos"> 821</span></a>            <span class="n">database</span><span class="o">.</span><span class="n">Citation</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">citationkey</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="Helper-822"><a href="#Helper-822"><span class="linenos"> 822</span></a>            <span class="n">updates_to_citations</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Helper-823"><a href="#Helper-823"><span class="linenos"> 823</span></a>            
</span><span id="Helper-824"><a href="#Helper-824"><span class="linenos"> 824</span></a>
</span><span id="Helper-825"><a href="#Helper-825"><span class="linenos"> 825</span></a>        <span class="k">for</span> <span class="n">citation</span> <span class="ow">in</span> <span class="n">tracked</span><span class="p">:</span>
</span><span id="Helper-826"><a href="#Helper-826"><span class="linenos"> 826</span></a>            <span class="k">if</span> <span class="n">citation</span><span class="o">.</span><span class="n">citationkey</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="Helper-827"><a href="#Helper-827"><span class="linenos"> 827</span></a>                <span class="n">citation</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="Helper-828"><a href="#Helper-828"><span class="linenos"> 828</span></a>                <span class="n">updates_to_citations</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Helper-829"><a href="#Helper-829"><span class="linenos"> 829</span></a>
</span><span id="Helper-830"><a href="#Helper-830"><span class="linenos"> 830</span></a>        <span class="k">return</span> <span class="n">updates_to_citations</span>
</span><span id="Helper-831"><a href="#Helper-831"><span class="linenos"> 831</span></a>                
</span><span id="Helper-832"><a href="#Helper-832"><span class="linenos"> 832</span></a>
</span><span id="Helper-833"><a href="#Helper-833"><span class="linenos"> 833</span></a>
</span><span id="Helper-834"><a href="#Helper-834"><span class="linenos"> 834</span></a>    <span class="k">def</span> <span class="nf">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="Helper-835"><a href="#Helper-835"><span class="linenos"> 835</span></a>        <span class="n">labels</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getlabels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-836"><a href="#Helper-836"><span class="linenos"> 836</span></a>        <span class="n">tracked_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">]</span>
</span><span id="Helper-837"><a href="#Helper-837"><span class="linenos"> 837</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="Helper-838"><a href="#Helper-838"><span class="linenos"> 838</span></a>            <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked_labels</span><span class="p">:</span>
</span><span id="Helper-839"><a href="#Helper-839"><span class="linenos"> 839</span></a>                <span class="n">database</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">note</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-840"><a href="#Helper-840"><span class="linenos"> 840</span></a>
</span><span id="Helper-841"><a href="#Helper-841"><span class="linenos"> 841</span></a>            <span class="c1">#remove extra labels</span>
</span><span id="Helper-842"><a href="#Helper-842"><span class="linenos"> 842</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
</span><span id="Helper-843"><a href="#Helper-843"><span class="linenos"> 843</span></a>            <span class="k">if</span> <span class="n">label</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="Helper-844"><a href="#Helper-844"><span class="linenos"> 844</span></a>                <span class="n">label</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="Helper-845"><a href="#Helper-845"><span class="linenos"> 845</span></a>                   
</span><span id="Helper-846"><a href="#Helper-846"><span class="linenos"> 846</span></a>        <span class="c1">#add connections</span>
</span><span id="Helper-847"><a href="#Helper-847"><span class="linenos"> 847</span></a>
</span><span id="Helper-848"><a href="#Helper-848"><span class="linenos"> 848</span></a>    <span class="k">def</span> <span class="nf">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="Helper-849"><a href="#Helper-849"><span class="linenos"> 849</span></a>
</span><span id="Helper-850"><a href="#Helper-850"><span class="linenos"> 850</span></a>        <span class="n">links</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getlinks</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-851"><a href="#Helper-851"><span class="linenos"> 851</span></a>        <span class="n">modified</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-852"><a href="#Helper-852"><span class="linenos"> 852</span></a>
</span><span id="Helper-853"><a href="#Helper-853"><span class="linenos"> 853</span></a>        <span class="n">tracked</span> <span class="o">=</span> <span class="p">[(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">]</span> 
</span><span id="Helper-854"><a href="#Helper-854"><span class="linenos"> 854</span></a>            <span class="c1">#add in untracked</span>
</span><span id="Helper-855"><a href="#Helper-855"><span class="linenos"> 855</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="Helper-856"><a href="#Helper-856"><span class="linenos"> 856</span></a>            <span class="k">if</span> <span class="n">link</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked</span><span class="p">:</span>
</span><span id="Helper-857"><a href="#Helper-857"><span class="linenos"> 857</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-858"><a href="#Helper-858"><span class="linenos"> 858</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">note__reference</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Helper-859"><a href="#Helper-859"><span class="linenos"> 859</span></a>                    <span class="n">link</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Link</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper-860"><a href="#Helper-860"><span class="linenos"> 860</span></a>                    <span class="n">modified</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span><span id="Helper-861"><a href="#Helper-861"><span class="linenos"> 861</span></a>                <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Label</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper-862"><a href="#Helper-862"><span class="linenos"> 862</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;label in </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1"> with details </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> does not exist&#39;</span><span class="p">)</span>
</span><span id="Helper-863"><a href="#Helper-863"><span class="linenos"> 863</span></a>
</span><span id="Helper-864"><a href="#Helper-864"><span class="linenos"> 864</span></a>        <span class="c1">#remove any that no longer exist</span>
</span><span id="Helper-865"><a href="#Helper-865"><span class="linenos"> 865</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
</span><span id="Helper-866"><a href="#Helper-866"><span class="linenos"> 866</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">label</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="Helper-867"><a href="#Helper-867"><span class="linenos"> 867</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;link </span><span class="si">{</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span><span class="w"> </span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">label</span><span class="p">)</span><span class="si">}</span><span class="s1"> no longer exists, deleting&#39;</span><span class="p">)</span>
</span><span id="Helper-868"><a href="#Helper-868"><span class="linenos"> 868</span></a>                <span class="n">link</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="Helper-869"><a href="#Helper-869"><span class="linenos"> 869</span></a>                <span class="n">modified</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span><span id="Helper-870"><a href="#Helper-870"><span class="linenos"> 870</span></a>
</span><span id="Helper-871"><a href="#Helper-871"><span class="linenos"> 871</span></a>
</span><span id="Helper-872"><a href="#Helper-872"><span class="linenos"> 872</span></a>        <span class="k">return</span> <span class="n">modified</span> 
</span><span id="Helper-873"><a href="#Helper-873"><span class="linenos"> 873</span></a>
</span><span id="Helper-874"><a href="#Helper-874"><span class="linenos"> 874</span></a>
</span><span id="Helper-875"><a href="#Helper-875"><span class="linenos"> 875</span></a>    <span class="k">def</span> <span class="nf">__getnotefiles</span><span class="p">(</span><span class="n">directory</span><span class="o">=</span><span class="s1">&#39;notes/slipbox&#39;</span><span class="p">):</span>
</span><span id="Helper-876"><a href="#Helper-876"><span class="linenos"> 876</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="s1">&#39;.tex&#39;</span><span class="p">)]</span>
</span><span id="Helper-877"><a href="#Helper-877"><span class="linenos"> 877</span></a>        <span class="k">return</span> <span class="n">notes</span>
</span><span id="Helper-878"><a href="#Helper-878"><span class="linenos"> 878</span></a>
</span><span id="Helper-879"><a href="#Helper-879"><span class="linenos"> 879</span></a>    <span class="k">def</span> <span class="nf">__createnotefile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="Helper-880"><a href="#Helper-880"><span class="linenos"> 880</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-881"><a href="#Helper-881"><span class="linenos"> 881</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">)</span>
</span><span id="Helper-882"><a href="#Helper-882"><span class="linenos"> 882</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-883"><a href="#Helper-883"><span class="linenos"> 883</span></a>            <span class="k">pass</span>
</span><span id="Helper-884"><a href="#Helper-884"><span class="linenos"> 884</span></a>
</span><span id="Helper-885"><a href="#Helper-885"><span class="linenos"> 885</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-886"><a href="#Helper-886"><span class="linenos"> 886</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;notes/slipbox&#39;</span><span class="p">)</span>
</span><span id="Helper-887"><a href="#Helper-887"><span class="linenos"> 887</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper-888"><a href="#Helper-888"><span class="linenos"> 888</span></a>            <span class="k">pass</span>
</span><span id="Helper-889"><a href="#Helper-889"><span class="linenos"> 889</span></a>
</span><span id="Helper-890"><a href="#Helper-890"><span class="linenos"> 890</span></a>
</span><span id="Helper-891"><a href="#Helper-891"><span class="linenos"> 891</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-892"><a href="#Helper-892"><span class="linenos"> 892</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-893"><a href="#Helper-893"><span class="linenos"> 893</span></a>                <span class="k">pass</span>
</span><span id="Helper-894"><a href="#Helper-894"><span class="linenos"> 894</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File notes/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex already exists, skipping copying the template&#39;</span><span class="p">)</span>
</span><span id="Helper-895"><a href="#Helper-895"><span class="linenos"> 895</span></a>            <span class="k">return</span>
</span><span id="Helper-896"><a href="#Helper-896"><span class="linenos"> 896</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper-897"><a href="#Helper-897"><span class="linenos"> 897</span></a>            <span class="k">pass</span>
</span><span id="Helper-898"><a href="#Helper-898"><span class="linenos"> 898</span></a>
</span><span id="Helper-899"><a href="#Helper-899"><span class="linenos"> 899</span></a>        
</span><span id="Helper-900"><a href="#Helper-900"><span class="linenos"> 900</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s1">&#39;template/note.tex&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-901"><a href="#Helper-901"><span class="linenos"> 901</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper-902"><a href="#Helper-902"><span class="linenos"> 902</span></a>        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="Helper-903"><a href="#Helper-903"><span class="linenos"> 903</span></a>
</span><span id="Helper-904"><a href="#Helper-904"><span class="linenos"> 904</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;template/note.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-905"><a href="#Helper-905"><span class="linenos"> 905</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-906"><a href="#Helper-906"><span class="linenos"> 906</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">title\{(.*?)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">title{&#39;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper-907"><a href="#Helper-907"><span class="linenos"> 907</span></a>
</span><span id="Helper-908"><a href="#Helper-908"><span class="linenos"> 908</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-909"><a href="#Helper-909"><span class="linenos"> 909</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper-910"><a href="#Helper-910"><span class="linenos"> 910</span></a>
</span><span id="Helper-911"><a href="#Helper-911"><span class="linenos"> 911</span></a>
</span><span id="Helper-912"><a href="#Helper-912"><span class="linenos"> 912</span></a>
</span><span id="Helper-913"><a href="#Helper-913"><span class="linenos"> 913</span></a>
</span><span id="Helper-914"><a href="#Helper-914"><span class="linenos"> 914</span></a>    <span class="k">def</span> <span class="nf">__getlabels</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="Helper-915"><a href="#Helper-915"><span class="linenos"> 915</span></a>        <span class="n">file_labels</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-916"><a href="#Helper-916"><span class="linenos"> 916</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-917"><a href="#Helper-917"><span class="linenos"> 917</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-918"><a href="#Helper-918"><span class="linenos"> 918</span></a>                <span class="n">labels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">(label|currentdoc)\{)(.*?)(\})&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-919"><a href="#Helper-919"><span class="linenos"> 919</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper-920"><a href="#Helper-920"><span class="linenos"> 920</span></a>                    <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Helper-921"><a href="#Helper-921"><span class="linenos"> 921</span></a>                    <span class="n">file_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
</span><span id="Helper-922"><a href="#Helper-922"><span class="linenos"> 922</span></a>                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="Helper-923"><a href="#Helper-923"><span class="linenos"> 923</span></a>                    <span class="k">pass</span>
</span><span id="Helper-924"><a href="#Helper-924"><span class="linenos"> 924</span></a>
</span><span id="Helper-925"><a href="#Helper-925"><span class="linenos"> 925</span></a>        <span class="k">return</span> <span class="n">file_labels</span>
</span><span id="Helper-926"><a href="#Helper-926"><span class="linenos"> 926</span></a>
</span><span id="Helper-927"><a href="#Helper-927"><span class="linenos"> 927</span></a>
</span><span id="Helper-928"><a href="#Helper-928"><span class="linenos"> 928</span></a>    <span class="k">def</span> <span class="nf">list_citations</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="Helper-929"><a href="#Helper-929"><span class="linenos"> 929</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">__getcitations</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
</span><span id="Helper-930"><a href="#Helper-930"><span class="linenos"> 930</span></a>
</span><span id="Helper-931"><a href="#Helper-931"><span class="linenos"> 931</span></a>    <span class="k">def</span> <span class="nf">__getcitations</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="Helper-932"><a href="#Helper-932"><span class="linenos"> 932</span></a>        <span class="n">citation_commands</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cite&#39;</span><span class="p">,</span> <span class="s1">&#39;parencite&#39;</span><span class="p">,</span> <span class="s1">&#39;footcite&#39;</span><span class="p">,</span> <span class="s1">&#39;footcitetext&#39;</span><span class="p">,</span> <span class="s1">&#39;textcite&#39;</span><span class="p">,</span> <span class="s1">&#39;smartcite&#39;</span><span class="p">,</span> <span class="s1">&#39;cite*&#39;</span><span class="p">,</span> <span class="s1">&#39;parencite*&#39;</span><span class="p">,</span> <span class="s1">&#39;supercite&#39;</span><span class="p">,</span> <span class="s1">&#39;autocite&#39;</span><span class="p">,</span> <span class="s1">&#39;autocite*&#39;</span><span class="p">,</span> <span class="s1">&#39;citeauthor&#39;</span><span class="p">,</span> <span class="s1">&#39;citeauthor*&#39;</span><span class="p">,</span> <span class="s1">&#39;citetitle&#39;</span><span class="p">,</span> <span class="s1">&#39;citeyear&#39;</span><span class="p">,</span> <span class="s1">&#39;citedate&#39;</span><span class="p">,</span> <span class="s1">&#39;citeurl&#39;</span><span class="p">,</span> <span class="s1">&#39;volcite&#39;</span><span class="p">,</span> <span class="s1">&#39;pvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;fvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;ftvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;svolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;tvolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;avolcite&#39;</span><span class="p">,</span> <span class="s1">&#39;fillcite&#39;</span><span class="p">,</span> <span class="s1">&#39;footfullcite&#39;</span><span class="p">,</span> <span class="s1">&#39;nocite&#39;</span><span class="p">,</span> <span class="s1">&#39;notecite&#39;</span><span class="p">,</span> <span class="s1">&#39;pnotecite&#39;</span><span class="p">,</span> <span class="s1">&#39;fnotecite&#39;</span><span class="p">]</span>
</span><span id="Helper-933"><a href="#Helper-933"><span class="linenos"> 933</span></a>
</span><span id="Helper-934"><a href="#Helper-934"><span class="linenos"> 934</span></a>
</span><span id="Helper-935"><a href="#Helper-935"><span class="linenos"> 935</span></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper-936"><a href="#Helper-936"><span class="linenos"> 936</span></a>        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper-937"><a href="#Helper-937"><span class="linenos"> 937</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-938"><a href="#Helper-938"><span class="linenos"> 938</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-939"><a href="#Helper-939"><span class="linenos"> 939</span></a>                <span class="n">citations</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">(&#39;</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">citation_commands</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)(\[([^]]+)\])?(\{[^\}]+\})?(\[([^]]+)\])?\{([^\}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-940"><a href="#Helper-940"><span class="linenos"> 940</span></a>                <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">citations</span><span class="p">:</span>
</span><span id="Helper-941"><a href="#Helper-941"><span class="linenos"> 941</span></a>                    <span class="n">key</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</span><span id="Helper-942"><a href="#Helper-942"><span class="linenos"> 942</span></a>                    <span class="n">keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="Helper-943"><a href="#Helper-943"><span class="linenos"> 943</span></a>
</span><span id="Helper-944"><a href="#Helper-944"><span class="linenos"> 944</span></a>
</span><span id="Helper-945"><a href="#Helper-945"><span class="linenos"> 945</span></a>        <span class="k">return</span> <span class="n">keys</span>
</span><span id="Helper-946"><a href="#Helper-946"><span class="linenos"> 946</span></a>
</span><span id="Helper-947"><a href="#Helper-947"><span class="linenos"> 947</span></a>    <span class="k">def</span> <span class="nf">__getlinks</span><span class="p">(</span><span class="n">note</span><span class="p">):</span>
</span><span id="Helper-948"><a href="#Helper-948"><span class="linenos"> 948</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper-949"><a href="#Helper-949"><span class="linenos"> 949</span></a>        <span class="n">file_references</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-950"><a href="#Helper-950"><span class="linenos"> 950</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-951"><a href="#Helper-951"><span class="linenos"> 951</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-952"><a href="#Helper-952"><span class="linenos"> 952</span></a>                <span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{(.*?)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper-953"><a href="#Helper-953"><span class="linenos"> 953</span></a>                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="Helper-954"><a href="#Helper-954"><span class="linenos"> 954</span></a>                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-955"><a href="#Helper-955"><span class="linenos"> 955</span></a>                        <span class="n">ref</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="Helper-956"><a href="#Helper-956"><span class="linenos"> 956</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-957"><a href="#Helper-957"><span class="linenos"> 957</span></a>                        <span class="n">ref</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
</span><span id="Helper-958"><a href="#Helper-958"><span class="linenos"> 958</span></a>                    <span class="n">file_references</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">ref</span><span class="p">))</span> 
</span><span id="Helper-959"><a href="#Helper-959"><span class="linenos"> 959</span></a>        <span class="k">return</span> <span class="n">file_references</span>
</span><span id="Helper-960"><a href="#Helper-960"><span class="linenos"> 960</span></a>
</span><span id="Helper-961"><a href="#Helper-961"><span class="linenos"> 961</span></a>    <span class="k">def</span> <span class="nf">__gettags</span><span class="p">():</span>
</span><span id="Helper-962"><a href="#Helper-962"><span class="linenos"> 962</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper-963"><a href="#Helper-963"><span class="linenos"> 963</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Helper-964"><a href="#Helper-964"><span class="linenos"> 964</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper-965"><a href="#Helper-965"><span class="linenos"> 965</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">note</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper-966"><a href="#Helper-966"><span class="linenos"> 966</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
</span><span id="Helper-967"><a href="#Helper-967"><span class="linenos"> 967</span></a>                <span class="n">last_line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Helper-968"><a href="#Helper-968"><span class="linenos"> 968</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\\\</span><span class="s2">end\{document\}&quot;</span><span class="p">,</span> <span class="n">last_line</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper-969"><a href="#Helper-969"><span class="linenos"> 969</span></a>                    <span class="n">note_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">last_line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</span><span id="Helper-970"><a href="#Helper-970"><span class="linenos"> 970</span></a>                    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">note_tags</span><span class="p">:</span>
</span><span id="Helper-971"><a href="#Helper-971"><span class="linenos"> 971</span></a>                        <span class="n">tags</span><span class="p">[</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;notes/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;notes/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]))[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper-972"><a href="#Helper-972"><span class="linenos"> 972</span></a>
</span><span id="Helper-973"><a href="#Helper-973"><span class="linenos"> 973</span></a>
</span><span id="Helper-974"><a href="#Helper-974"><span class="linenos"> 974</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
</span><span id="Helper-975"><a href="#Helper-975"><span class="linenos"> 975</span></a>
</span><span id="Helper-976"><a href="#Helper-976"><span class="linenos"> 976</span></a>    
</span><span id="Helper-977"><a href="#Helper-977"><span class="linenos"> 977</span></a>    
</span><span id="Helper-978"><a href="#Helper-978"><span class="linenos"> 978</span></a>    <span class="k">def</span> <span class="nf">__get_recent_files</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Helper-979"><a href="#Helper-979"><span class="linenos"> 979</span></a>        <span class="n">files</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper-980"><a href="#Helper-980"><span class="linenos"> 980</span></a>
</span><span id="Helper-981"><a href="#Helper-981"><span class="linenos"> 981</span></a>
</span><span id="Helper-982"><a href="#Helper-982"><span class="linenos"> 982</span></a>        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper-983"><a href="#Helper-983"><span class="linenos"> 983</span></a>            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
</span><span id="Helper-984"><a href="#Helper-984"><span class="linenos"> 984</span></a>       
</span><span id="Helper-985"><a href="#Helper-985"><span class="linenos"> 985</span></a>        <span class="n">file_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Helper-986"><a href="#Helper-986"><span class="linenos"> 986</span></a>        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
</span><span id="Helper-987"><a href="#Helper-987"><span class="linenos"> 987</span></a>            <span class="n">time</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper-988"><a href="#Helper-988"><span class="linenos"> 988</span></a>            <span class="k">if</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="p">:</span>
</span><span id="Helper-989"><a href="#Helper-989"><span class="linenos"> 989</span></a>                <span class="n">file_dict</span><span class="p">[</span><span class="n">time</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper-990"><a href="#Helper-990"><span class="linenos"> 990</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-991"><a href="#Helper-991"><span class="linenos"> 991</span></a>                <span class="n">file_dict</span><span class="p">[</span><span class="n">time</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="p">]</span>
</span><span id="Helper-992"><a href="#Helper-992"><span class="linenos"> 992</span></a>
</span><span id="Helper-993"><a href="#Helper-993"><span class="linenos"> 993</span></a>        <span class="n">ordered</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">file_dict</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper-994"><a href="#Helper-994"><span class="linenos"> 994</span></a>
</span><span id="Helper-995"><a href="#Helper-995"><span class="linenos"> 995</span></a>        
</span><span id="Helper-996"><a href="#Helper-996"><span class="linenos"> 996</span></a>        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper-997"><a href="#Helper-997"><span class="linenos"> 997</span></a>
</span><span id="Helper-998"><a href="#Helper-998"><span class="linenos"> 998</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">ordered</span><span class="p">):</span>
</span><span id="Helper-999"><a href="#Helper-999"><span class="linenos"> 999</span></a>            <span class="n">r</span> <span class="o">+=</span> <span class="n">file_dict</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
</span><span id="Helper-1000"><a href="#Helper-1000"><span class="linenos">1000</span></a>
</span><span id="Helper-1001"><a href="#Helper-1001"><span class="linenos">1001</span></a>        <span class="k">return</span> <span class="n">r</span>
</span><span id="Helper-1002"><a href="#Helper-1002"><span class="linenos">1002</span></a>
</span><span id="Helper-1003"><a href="#Helper-1003"><span class="linenos">1003</span></a>                
</span><span id="Helper-1004"><a href="#Helper-1004"><span class="linenos">1004</span></a>    <span class="k">def</span> <span class="nf">__getyesno</span><span class="p">():</span>
</span><span id="Helper-1005"><a href="#Helper-1005"><span class="linenos">1005</span></a>        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Helper-1006"><a href="#Helper-1006"><span class="linenos">1006</span></a>            <span class="n">a</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
</span><span id="Helper-1007"><a href="#Helper-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
</span><span id="Helper-1008"><a href="#Helper-1008"><span class="linenos">1008</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Helper-1009"><a href="#Helper-1009"><span class="linenos">1009</span></a>            <span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="s1">&#39;n&#39;</span><span class="p">:</span>
</span><span id="Helper-1010"><a href="#Helper-1010"><span class="linenos">1010</span></a>                <span class="k">return</span> <span class="kc">False</span>
</span><span id="Helper-1011"><a href="#Helper-1011"><span class="linenos">1011</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper-1012"><a href="#Helper-1012"><span class="linenos">1012</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please enter either </span><span class="se">\&#39;</span><span class="s1">y</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">n</span><span class="se">\&#39;</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Collection of functions for managing a LaTeX Zettelkasten. Each of these functions can be run from the command line by running</p>

<p><code>python manage.py function_name arg1 arg2 ...</code></p>

<p>For example, running </p>

<p><code>python manage.py newnote note_name</code></p>

<p>executes <code>Hepler.newnote(note_name)</code>.</p>

<p>These can be executed by hand (for now). The plan for the future is to get other applications (eg a text editor) to run these functions.</p>
</div>


                            <div id="Helper.help" class="classattr">
                                        <input id="Helper.help-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">help</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.help-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.help"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.help-39"><a href="#Helper.help-39"><span class="linenos">39</span></a>    <span class="k">def</span> <span class="nf">help</span><span class="p">():</span>
</span><span id="Helper.help-40"><a href="#Helper.help-40"><span class="linenos">40</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="Helper.help-41"><a href="#Helper.help-41"><span class="linenos">41</span></a><span class="s2">            Manage the LaTeX slip box. The file manage.py is documented with docstrings, see /docs for detailed information</span>
</span><span id="Helper.help-42"><a href="#Helper.help-42"><span class="linenos">42</span></a><span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Helper.addtodocuments" class="classattr">
                                        <input id="Helper.addtodocuments-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">addtodocuments</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">reference</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.addtodocuments-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.addtodocuments"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.addtodocuments-44"><a href="#Helper.addtodocuments-44"><span class="linenos">44</span></a>    <span class="k">def</span> <span class="nf">addtodocuments</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="Helper.addtodocuments-45"><a href="#Helper.addtodocuments-45"><span class="linenos">45</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.addtodocuments-46"><a href="#Helper.addtodocuments-46"><span class="linenos">46</span></a><span class="sd">            Adds line \externaldocument[reference-]{filename} to documents.tex</span>
</span><span id="Helper.addtodocuments-47"><a href="#Helper.addtodocuments-47"><span class="linenos">47</span></a><span class="sd">            If reference is not supplied then it defaults to, for example, NoteName if filename=note_name</span>
</span><span id="Helper.addtodocuments-48"><a href="#Helper.addtodocuments-48"><span class="linenos">48</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.addtodocuments-49"><a href="#Helper.addtodocuments-49"><span class="linenos">49</span></a>            
</span><span id="Helper.addtodocuments-50"><a href="#Helper.addtodocuments-50"><span class="linenos">50</span></a>
</span><span id="Helper.addtodocuments-51"><a href="#Helper.addtodocuments-51"><span class="linenos">51</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.addtodocuments-52"><a href="#Helper.addtodocuments-52"><span class="linenos">52</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;\externaldocument[</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">-]</span><span class="se">{{</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="se">}}\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Adds line \externaldocument[reference-]{filename} to documents.tex
If reference is not supplied then it defaults to, for example, NoteName if filename=note_name</p>
</div>


                            </div>
                            <div id="Helper.newnote" class="classattr">
                                        <input id="Helper.newnote-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">newnote</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">note_name</span>, </span><span class="param"><span class="n">reference_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.newnote-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.newnote"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.newnote-58"><a href="#Helper.newnote-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">newnote</span><span class="p">(</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="Helper.newnote-59"><a href="#Helper.newnote-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.newnote-60"><a href="#Helper.newnote-60"><span class="linenos">60</span></a><span class="sd">            Makes a new note with name note_name [Optional ReferenceName]</span>
</span><span id="Helper.newnote-61"><a href="#Helper.newnote-61"><span class="linenos">61</span></a><span class="sd">            Creates note with name note_name.tex, Second argument is optional and is the name in the reference, defaults to NoteName</span>
</span><span id="Helper.newnote-62"><a href="#Helper.newnote-62"><span class="linenos">62</span></a>
</span><span id="Helper.newnote-63"><a href="#Helper.newnote-63"><span class="linenos">63</span></a><span class="sd">            to do: check whether a file already exists etc</span>
</span><span id="Helper.newnote-64"><a href="#Helper.newnote-64"><span class="linenos">64</span></a>
</span><span id="Helper.newnote-65"><a href="#Helper.newnote-65"><span class="linenos">65</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.newnote-66"><a href="#Helper.newnote-66"><span class="linenos">66</span></a>        <span class="k">if</span> <span class="n">reference_name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Helper.newnote-67"><a href="#Helper.newnote-67"><span class="linenos">67</span></a>            <span class="n">reference_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">note_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="Helper.newnote-68"><a href="#Helper.newnote-68"><span class="linenos">68</span></a>        
</span><span id="Helper.newnote-69"><a href="#Helper.newnote-69"><span class="linenos">69</span></a>        <span class="c1">#see if the note already exists</span>
</span><span id="Helper.newnote-70"><a href="#Helper.newnote-70"><span class="linenos">70</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.newnote-71"><a href="#Helper.newnote-71"><span class="linenos">71</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note_name</span><span class="p">)</span>
</span><span id="Helper.newnote-72"><a href="#Helper.newnote-72"><span class="linenos">72</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A note with file name </span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s1"> already exists in the database. If this is not the case then run manage.py synchronize to update the database, and then try again&#39;</span><span class="p">)</span>
</span><span id="Helper.newnote-73"><a href="#Helper.newnote-73"><span class="linenos">73</span></a>            <span class="k">return</span> 
</span><span id="Helper.newnote-74"><a href="#Helper.newnote-74"><span class="linenos">74</span></a>        <span class="k">except</span> <span class="n">pw</span><span class="o">.</span><span class="n">OperationalError</span><span class="p">:</span>
</span><span id="Helper.newnote-75"><a href="#Helper.newnote-75"><span class="linenos">75</span></a>            <span class="n">database</span><span class="o">.</span><span class="n">create_all_tables</span><span class="p">()</span>
</span><span id="Helper.newnote-76"><a href="#Helper.newnote-76"><span class="linenos">76</span></a>        <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper.newnote-77"><a href="#Helper.newnote-77"><span class="linenos">77</span></a>            <span class="k">try</span><span class="p">:</span> 
</span><span id="Helper.newnote-78"><a href="#Helper.newnote-78"><span class="linenos">78</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">)</span>
</span><span id="Helper.newnote-79"><a href="#Helper.newnote-79"><span class="linenos">79</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A note with reference </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1"> already exists in the database. If this is not the case then run manage.py synchronize to update the database, and then try again. If the problem persists check the documents.tex file is correctly setup&#39;</span><span class="p">)</span>
</span><span id="Helper.newnote-80"><a href="#Helper.newnote-80"><span class="linenos">80</span></a>                <span class="k">return</span>
</span><span id="Helper.newnote-81"><a href="#Helper.newnote-81"><span class="linenos">81</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper.newnote-82"><a href="#Helper.newnote-82"><span class="linenos">82</span></a>                <span class="k">pass</span> 
</span><span id="Helper.newnote-83"><a href="#Helper.newnote-83"><span class="linenos">83</span></a>    
</span><span id="Helper.newnote-84"><a href="#Helper.newnote-84"><span class="linenos">84</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">__createnotefile</span><span class="p">(</span><span class="n">note_name</span><span class="p">)</span>
</span><span id="Helper.newnote-85"><a href="#Helper.newnote-85"><span class="linenos">85</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">addtodocuments</span><span class="p">(</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference_name</span><span class="p">)</span>
</span><span id="Helper.newnote-86"><a href="#Helper.newnote-86"><span class="linenos">86</span></a>        <span class="c1">#once created, add note to database </span>
</span><span id="Helper.newnote-87"><a href="#Helper.newnote-87"><span class="linenos">87</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note_name</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span> <span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span><span id="Helper.newnote-88"><a href="#Helper.newnote-88"><span class="linenos">88</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Makes a new note with name note_name [Optional ReferenceName]
Creates note with name note_name.tex, Second argument is optional and is the name in the reference, defaults to NoteName</p>

<p>to do: check whether a file already exists etc</p>
</div>


                            </div>
                            <div id="Helper.newproject" class="classattr">
                                        <input id="Helper.newproject-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">newproject</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">dir_name</span>, </span><span class="param"><span class="n">filename</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.newproject-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.newproject"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.newproject-90"><a href="#Helper.newproject-90"><span class="linenos"> 90</span></a>    <span class="k">def</span> <span class="nf">newproject</span><span class="p">(</span><span class="n">dir_name</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper.newproject-91"><a href="#Helper.newproject-91"><span class="linenos"> 91</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.newproject-92"><a href="#Helper.newproject-92"><span class="linenos"> 92</span></a><span class="sd">            Creates a project folder (for exporting notes) and copies the project.tex file into the folder</span>
</span><span id="Helper.newproject-93"><a href="#Helper.newproject-93"><span class="linenos"> 93</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.newproject-94"><a href="#Helper.newproject-94"><span class="linenos"> 94</span></a>
</span><span id="Helper.newproject-95"><a href="#Helper.newproject-95"><span class="linenos"> 95</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.newproject-96"><a href="#Helper.newproject-96"><span class="linenos"> 96</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">)</span>
</span><span id="Helper.newproject-97"><a href="#Helper.newproject-97"><span class="linenos"> 97</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper.newproject-98"><a href="#Helper.newproject-98"><span class="linenos"> 98</span></a>            <span class="k">pass</span>
</span><span id="Helper.newproject-99"><a href="#Helper.newproject-99"><span class="linenos"> 99</span></a>
</span><span id="Helper.newproject-100"><a href="#Helper.newproject-100"><span class="linenos">100</span></a>
</span><span id="Helper.newproject-101"><a href="#Helper.newproject-101"><span class="linenos">101</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.newproject-102"><a href="#Helper.newproject-102"><span class="linenos">102</span></a>            <span class="n">dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">dir_name</span><span class="p">)</span>
</span><span id="Helper.newproject-103"><a href="#Helper.newproject-103"><span class="linenos">103</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">dirpath</span><span class="p">)</span>
</span><span id="Helper.newproject-104"><a href="#Helper.newproject-104"><span class="linenos">104</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper.newproject-105"><a href="#Helper.newproject-105"><span class="linenos">105</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Error: project directory already exists&#39;</span><span class="p">)</span>
</span><span id="Helper.newproject-106"><a href="#Helper.newproject-106"><span class="linenos">106</span></a>
</span><span id="Helper.newproject-107"><a href="#Helper.newproject-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="Helper.newproject-108"><a href="#Helper.newproject-108"><span class="linenos">108</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dir_name</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="Helper.newproject-109"><a href="#Helper.newproject-109"><span class="linenos">109</span></a>
</span><span id="Helper.newproject-110"><a href="#Helper.newproject-110"><span class="linenos">110</span></a>        <span class="n">template</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;template&#39;</span><span class="p">,</span> <span class="s1">&#39;project.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.newproject-111"><a href="#Helper.newproject-111"><span class="linenos">111</span></a>        <span class="n">tex_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.newproject-112"><a href="#Helper.newproject-112"><span class="linenos">112</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">tex_file</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a project folder (for exporting notes) and copies the project.tex file into the folder</p>
</div>


                            </div>
                            <div id="Helper.list_recent_files" class="classattr">
                                        <input id="Helper.list_recent_files-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_recent_files</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n</span><span class="o">=</span><span class="mi">10</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.list_recent_files-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.list_recent_files"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.list_recent_files-115"><a href="#Helper.list_recent_files-115"><span class="linenos">115</span></a>    <span class="k">def</span> <span class="nf">list_recent_files</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
</span><span id="Helper.list_recent_files-116"><a href="#Helper.list_recent_files-116"><span class="linenos">116</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.list_recent_files-117"><a href="#Helper.list_recent_files-117"><span class="linenos">117</span></a><span class="sd">            List the most recently edited files.</span>
</span><span id="Helper.list_recent_files-118"><a href="#Helper.list_recent_files-118"><span class="linenos">118</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.list_recent_files-119"><a href="#Helper.list_recent_files-119"><span class="linenos">119</span></a>
</span><span id="Helper.list_recent_files-120"><a href="#Helper.list_recent_files-120"><span class="linenos">120</span></a>        <span class="n">recent_files</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span><span id="Helper.list_recent_files-121"><a href="#Helper.list_recent_files-121"><span class="linenos">121</span></a>
</span><span id="Helper.list_recent_files-122"><a href="#Helper.list_recent_files-122"><span class="linenos">122</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recent_files</span><span class="p">):</span>
</span><span id="Helper.list_recent_files-123"><a href="#Helper.list_recent_files-123"><span class="linenos">123</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">:</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>List the most recently edited files.</p>
</div>


                            </div>
                            <div id="Helper.rename_recent" class="classattr">
                                        <input id="Helper.rename_recent-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_recent</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n</span><span class="o">=</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.rename_recent-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.rename_recent"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.rename_recent-128"><a href="#Helper.rename_recent-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">rename_recent</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Helper.rename_recent-129"><a href="#Helper.rename_recent-129"><span class="linenos">129</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.rename_recent-130"><a href="#Helper.rename_recent-130"><span class="linenos">130</span></a><span class="sd">            Rename the most recent nth file.</span>
</span><span id="Helper.rename_recent-131"><a href="#Helper.rename_recent-131"><span class="linenos">131</span></a>
</span><span id="Helper.rename_recent-132"><a href="#Helper.rename_recent-132"><span class="linenos">132</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.rename_recent-133"><a href="#Helper.rename_recent-133"><span class="linenos">133</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="Helper.rename_recent-134"><a href="#Helper.rename_recent-134"><span class="linenos">134</span></a>        <span class="n">n</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
</span><span id="Helper.rename_recent-135"><a href="#Helper.rename_recent-135"><span class="linenos">135</span></a>
</span><span id="Helper.rename_recent-136"><a href="#Helper.rename_recent-136"><span class="linenos">136</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper.rename_recent-137"><a href="#Helper.rename_recent-137"><span class="linenos">137</span></a>
</span><span id="Helper.rename_recent-138"><a href="#Helper.rename_recent-138"><span class="linenos">138</span></a>        <span class="n">db_file</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper.rename_recent-139"><a href="#Helper.rename_recent-139"><span class="linenos">139</span></a>        
</span><span id="Helper.rename_recent-140"><a href="#Helper.rename_recent-140"><span class="linenos">140</span></a>        <span class="n">new_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Change file name to [</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">db_file</span><span class="o">.</span><span class="n">filename</span>
</span><span id="Helper.rename_recent-141"><a href="#Helper.rename_recent-141"><span class="linenos">141</span></a>        <span class="n">new_reference</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Change reference to [</span><span class="si">{</span><span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">]: &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">db_file</span><span class="o">.</span><span class="n">reference</span>
</span><span id="Helper.rename_recent-142"><a href="#Helper.rename_recent-142"><span class="linenos">142</span></a>
</span><span id="Helper.rename_recent-143"><a href="#Helper.rename_recent-143"><span class="linenos">143</span></a>
</span><span id="Helper.rename_recent-144"><a href="#Helper.rename_recent-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">new_name</span> <span class="o">!=</span> <span class="n">db_file</span><span class="o">.</span><span class="n">filename</span><span class="p">:</span>
</span><span id="Helper.rename_recent-145"><a href="#Helper.rename_recent-145"><span class="linenos">145</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">rename_file</span><span class="p">(</span><span class="n">db_file</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">new_name</span><span class="p">)</span>
</span><span id="Helper.rename_recent-146"><a href="#Helper.rename_recent-146"><span class="linenos">146</span></a>
</span><span id="Helper.rename_recent-147"><a href="#Helper.rename_recent-147"><span class="linenos">147</span></a>        <span class="k">if</span> <span class="n">new_reference</span> <span class="o">!=</span> <span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="p">:</span>
</span><span id="Helper.rename_recent-148"><a href="#Helper.rename_recent-148"><span class="linenos">148</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">rename_reference</span><span class="p">(</span><span class="n">db_file</span><span class="o">.</span><span class="n">reference</span><span class="p">,</span> <span class="n">new_reference</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rename the most recent nth file.</p>
</div>


                            </div>
                            <div id="Helper.rename_file" class="classattr">
                                        <input id="Helper.rename_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">old_filename</span>, </span><span class="param"><span class="n">new_filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.rename_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.rename_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.rename_file-150"><a href="#Helper.rename_file-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">rename_file</span><span class="p">(</span><span class="n">old_filename</span><span class="p">,</span> <span class="n">new_filename</span><span class="p">):</span>
</span><span id="Helper.rename_file-151"><a href="#Helper.rename_file-151"><span class="linenos">151</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.rename_file-152"><a href="#Helper.rename_file-152"><span class="linenos">152</span></a><span class="sd">            Rename the .tex file, fairly straightforward since only need to change documents.tex</span>
</span><span id="Helper.rename_file-153"><a href="#Helper.rename_file-153"><span class="linenos">153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.rename_file-154"><a href="#Helper.rename_file-154"><span class="linenos">154</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.rename_file-155"><a href="#Helper.rename_file-155"><span class="linenos">155</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="Helper.rename_file-156"><a href="#Helper.rename_file-156"><span class="linenos">156</span></a>                <span class="k">pass</span>
</span><span id="Helper.rename_file-157"><a href="#Helper.rename_file-157"><span class="linenos">157</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File, </span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex already exists&#39;</span><span class="p">)</span>
</span><span id="Helper.rename_file-158"><a href="#Helper.rename_file-158"><span class="linenos">158</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper.rename_file-159"><a href="#Helper.rename_file-159"><span class="linenos">159</span></a>            <span class="k">pass</span>
</span><span id="Helper.rename_file-160"><a href="#Helper.rename_file-160"><span class="linenos">160</span></a>        <span class="c1">#copy file</span>
</span><span id="Helper.rename_file-161"><a href="#Helper.rename_file-161"><span class="linenos">161</span></a>        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">new_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.rename_file-162"><a href="#Helper.rename_file-162"><span class="linenos">162</span></a>
</span><span id="Helper.rename_file-163"><a href="#Helper.rename_file-163"><span class="linenos">163</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">old_filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.rename_file-164"><a href="#Helper.rename_file-164"><span class="linenos">164</span></a>
</span><span id="Helper.rename_file-165"><a href="#Helper.rename_file-165"><span class="linenos">165</span></a>        <span class="c1">#change documents.tex</span>
</span><span id="Helper.rename_file-166"><a href="#Helper.rename_file-166"><span class="linenos">166</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">old_filename</span><span class="p">)</span>
</span><span id="Helper.rename_file-167"><a href="#Helper.rename_file-167"><span class="linenos">167</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">new_filename</span>
</span><span id="Helper.rename_file-168"><a href="#Helper.rename_file-168"><span class="linenos">168</span></a>
</span><span id="Helper.rename_file-169"><a href="#Helper.rename_file-169"><span class="linenos">169</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper.rename_file-170"><a href="#Helper.rename_file-170"><span class="linenos">170</span></a>
</span><span id="Helper.rename_file-171"><a href="#Helper.rename_file-171"><span class="linenos">171</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper.rename_file-172"><a href="#Helper.rename_file-172"><span class="linenos">172</span></a>
</span><span id="Helper.rename_file-173"><a href="#Helper.rename_file-173"><span class="linenos">173</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_file-174"><a href="#Helper.rename_file-174"><span class="linenos">174</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_file-175"><a href="#Helper.rename_file-175"><span class="linenos">175</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument\[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;\-\]\{&#39;</span> <span class="o">+</span> <span class="n">old_filename</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;-]{&#39;</span> <span class="o">+</span> <span class="n">new_filename</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.rename_file-176"><a href="#Helper.rename_file-176"><span class="linenos">176</span></a>
</span><span id="Helper.rename_file-177"><a href="#Helper.rename_file-177"><span class="linenos">177</span></a>
</span><span id="Helper.rename_file-178"><a href="#Helper.rename_file-178"><span class="linenos">178</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_file-179"><a href="#Helper.rename_file-179"><span class="linenos">179</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Rename the .tex file, fairly straightforward since only need to change documents.tex</p>
</div>


                            </div>
                            <div id="Helper.rename_reference" class="classattr">
                                        <input id="Helper.rename_reference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rename_reference</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">old_reference</span>, </span><span class="param"><span class="n">new_reference</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.rename_reference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.rename_reference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.rename_reference-182"><a href="#Helper.rename_reference-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="nf">rename_reference</span><span class="p">(</span><span class="n">old_reference</span><span class="p">,</span> <span class="n">new_reference</span><span class="p">):</span>
</span><span id="Helper.rename_reference-183"><a href="#Helper.rename_reference-183"><span class="linenos">183</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.rename_reference-184"><a href="#Helper.rename_reference-184"><span class="linenos">184</span></a><span class="sd">            Rename the reference used throughout the whole Zettelkasten. This function changes documents.tex and also any documents that reference this note.</span>
</span><span id="Helper.rename_reference-185"><a href="#Helper.rename_reference-185"><span class="linenos">185</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.rename_reference-186"><a href="#Helper.rename_reference-186"><span class="linenos">186</span></a>
</span><span id="Helper.rename_reference-187"><a href="#Helper.rename_reference-187"><span class="linenos">187</span></a>        <span class="c1">#function for regex replacement</span>
</span><span id="Helper.rename_reference-188"><a href="#Helper.rename_reference-188"><span class="linenos">188</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="Helper.rename_reference-189"><a href="#Helper.rename_reference-189"><span class="linenos">189</span></a>        <span class="k">def</span> <span class="nf">replace_text</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
</span><span id="Helper.rename_reference-190"><a href="#Helper.rename_reference-190"><span class="linenos">190</span></a>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.rename_reference-191"><a href="#Helper.rename_reference-191"><span class="linenos">191</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">excref</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper.rename_reference-192"><a href="#Helper.rename_reference-192"><span class="linenos">192</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.rename_reference-193"><a href="#Helper.rename_reference-193"><span class="linenos">193</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">excref[</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">]</span><span class="se">{{</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
</span><span id="Helper.rename_reference-194"><a href="#Helper.rename_reference-194"><span class="linenos">194</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.rename_reference-195"><a href="#Helper.rename_reference-195"><span class="linenos">195</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">exhyperref</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper.rename_reference-196"><a href="#Helper.rename_reference-196"><span class="linenos">196</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.rename_reference-197"><a href="#Helper.rename_reference-197"><span class="linenos">197</span></a>                <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">exhyperref[</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="si">}</span><span class="s1">]</span><span class="se">{{</span><span class="si">{</span><span class="n">new_reference</span><span class="si">}</span><span class="se">}}</span><span class="s1">&#39;</span>
</span><span id="Helper.rename_reference-198"><a href="#Helper.rename_reference-198"><span class="linenos">198</span></a>
</span><span id="Helper.rename_reference-199"><a href="#Helper.rename_reference-199"><span class="linenos">199</span></a>
</span><span id="Helper.rename_reference-200"><a href="#Helper.rename_reference-200"><span class="linenos">200</span></a>        <span class="c1"># Update documents.tex</span>
</span><span id="Helper.rename_reference-201"><a href="#Helper.rename_reference-201"><span class="linenos">201</span></a>
</span><span id="Helper.rename_reference-202"><a href="#Helper.rename_reference-202"><span class="linenos">202</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">old_reference</span><span class="p">)</span>
</span><span id="Helper.rename_reference-203"><a href="#Helper.rename_reference-203"><span class="linenos">203</span></a>
</span><span id="Helper.rename_reference-204"><a href="#Helper.rename_reference-204"><span class="linenos">204</span></a>        <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper.rename_reference-205"><a href="#Helper.rename_reference-205"><span class="linenos">205</span></a>
</span><span id="Helper.rename_reference-206"><a href="#Helper.rename_reference-206"><span class="linenos">206</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_reference-207"><a href="#Helper.rename_reference-207"><span class="linenos">207</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_reference-208"><a href="#Helper.rename_reference-208"><span class="linenos">208</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument\[&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">+</span> <span class="s1">&#39;\-\]\{&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">externaldocument[&#39;</span> <span class="o">+</span> <span class="n">new_reference</span> <span class="o">+</span> <span class="s1">&#39;-]{&#39;</span> <span class="o">+</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.rename_reference-209"><a href="#Helper.rename_reference-209"><span class="linenos">209</span></a>        
</span><span id="Helper.rename_reference-210"><a href="#Helper.rename_reference-210"><span class="linenos">210</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_reference-211"><a href="#Helper.rename_reference-211"><span class="linenos">211</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="Helper.rename_reference-212"><a href="#Helper.rename_reference-212"><span class="linenos">212</span></a>
</span><span id="Helper.rename_reference-213"><a href="#Helper.rename_reference-213"><span class="linenos">213</span></a>
</span><span id="Helper.rename_reference-214"><a href="#Helper.rename_reference-214"><span class="linenos">214</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> 
</span><span id="Helper.rename_reference-215"><a href="#Helper.rename_reference-215"><span class="linenos">215</span></a>            <span class="n">backrefs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper.rename_reference-216"><a href="#Helper.rename_reference-216"><span class="linenos">216</span></a>            <span class="k">for</span> <span class="n">backref</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">:</span>
</span><span id="Helper.rename_reference-217"><a href="#Helper.rename_reference-217"><span class="linenos">217</span></a>                <span class="n">backrefs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">backref</span><span class="p">)</span>
</span><span id="Helper.rename_reference-218"><a href="#Helper.rename_reference-218"><span class="linenos">218</span></a>            <span class="k">for</span> <span class="n">backref</span> <span class="ow">in</span> <span class="n">backrefs</span><span class="p">:</span>
</span><span id="Helper.rename_reference-219"><a href="#Helper.rename_reference-219"><span class="linenos">219</span></a>                <span class="n">lines</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper.rename_reference-220"><a href="#Helper.rename_reference-220"><span class="linenos">220</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">backref</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_reference-221"><a href="#Helper.rename_reference-221"><span class="linenos">221</span></a>                    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_reference-222"><a href="#Helper.rename_reference-222"><span class="linenos">222</span></a>                        <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{&#39;</span> <span class="o">+</span> <span class="n">old_reference</span> <span class="o">+</span> <span class="s1">&#39;\}&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="n">replace_text</span><span class="p">(</span><span class="n">m</span><span class="p">),</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.rename_reference-223"><a href="#Helper.rename_reference-223"><span class="linenos">223</span></a>
</span><span id="Helper.rename_reference-224"><a href="#Helper.rename_reference-224"><span class="linenos">224</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">backref</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.rename_reference-225"><a href="#Helper.rename_reference-225"><span class="linenos">225</span></a>                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</span><span id="Helper.rename_reference-226"><a href="#Helper.rename_reference-226"><span class="linenos">226</span></a>        
</span><span id="Helper.rename_reference-227"><a href="#Helper.rename_reference-227"><span class="linenos">227</span></a>        <span class="c1">#update note db</span>
</span><span id="Helper.rename_reference-228"><a href="#Helper.rename_reference-228"><span class="linenos">228</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">new_reference</span>
</span><span id="Helper.rename_reference-229"><a href="#Helper.rename_reference-229"><span class="linenos">229</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Rename the reference used throughout the whole Zettelkasten. This function changes documents.tex and also any documents that reference this note.</p>
</div>


                            </div>
                            <div id="Helper.remove_note" class="classattr">
                                        <input id="Helper.remove_note-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_note</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.remove_note-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.remove_note"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.remove_note-232"><a href="#Helper.remove_note-232"><span class="linenos">232</span></a>    <span class="k">def</span> <span class="nf">remove_note</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="Helper.remove_note-233"><a href="#Helper.remove_note-233"><span class="linenos">233</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.remove_note-234"><a href="#Helper.remove_note-234"><span class="linenos">234</span></a><span class="sd">            Delete a note with given filename</span>
</span><span id="Helper.remove_note-235"><a href="#Helper.remove_note-235"><span class="linenos">235</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.remove_note-236"><a href="#Helper.remove_note-236"><span class="linenos">236</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.remove_note-237"><a href="#Helper.remove_note-237"><span class="linenos">237</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.remove_note-238"><a href="#Helper.remove_note-238"><span class="linenos">238</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Delete database entry? (y/n)&#39;</span><span class="p">)</span> 
</span><span id="Helper.remove_note-239"><a href="#Helper.remove_note-239"><span class="linenos">239</span></a>            <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper.remove_note-240"><a href="#Helper.remove_note-240"><span class="linenos">240</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">delete_instance</span><span class="p">()</span>
</span><span id="Helper.remove_note-241"><a href="#Helper.remove_note-241"><span class="linenos">241</span></a>        <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper.remove_note-242"><a href="#Helper.remove_note-242"><span class="linenos">242</span></a>            <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Helper.remove_note-243"><a href="#Helper.remove_note-243"><span class="linenos">243</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No note with filename </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> exists in db&#39;</span><span class="p">)</span>
</span><span id="Helper.remove_note-244"><a href="#Helper.remove_note-244"><span class="linenos">244</span></a>
</span><span id="Helper.remove_note-245"><a href="#Helper.remove_note-245"><span class="linenos">245</span></a>
</span><span id="Helper.remove_note-246"><a href="#Helper.remove_note-246"><span class="linenos">246</span></a>
</span><span id="Helper.remove_note-247"><a href="#Helper.remove_note-247"><span class="linenos">247</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.remove_note-248"><a href="#Helper.remove_note-248"><span class="linenos">248</span></a>            <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="Helper.remove_note-249"><a href="#Helper.remove_note-249"><span class="linenos">249</span></a>        
</span><span id="Helper.remove_note-250"><a href="#Helper.remove_note-250"><span class="linenos">250</span></a>        <span class="n">to_delete</span><span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper.remove_note-251"><a href="#Helper.remove_note-251"><span class="linenos">251</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
</span><span id="Helper.remove_note-252"><a href="#Helper.remove_note-252"><span class="linenos">252</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">externaldocument\[)(.+?)(\-\]\</span><span class="se">{{</span><span class="s1">)</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">(\</span><span class="se">}}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper.remove_note-253"><a href="#Helper.remove_note-253"><span class="linenos">253</span></a>            <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="Helper.remove_note-254"><a href="#Helper.remove_note-254"><span class="linenos">254</span></a>                <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Helper.remove_note-255"><a href="#Helper.remove_note-255"><span class="linenos">255</span></a>           
</span><span id="Helper.remove_note-256"><a href="#Helper.remove_note-256"><span class="linenos">256</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">to_delete</span><span class="p">):</span>
</span><span id="Helper.remove_note-257"><a href="#Helper.remove_note-257"><span class="linenos">257</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;delete line </span><span class="si">{</span><span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="si">}</span><span class="s1"> from notes/documents.tex? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper.remove_note-258"><a href="#Helper.remove_note-258"><span class="linenos">258</span></a>            <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper.remove_note-259"><a href="#Helper.remove_note-259"><span class="linenos">259</span></a>                <span class="n">lines</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="Helper.remove_note-260"><a href="#Helper.remove_note-260"><span class="linenos">260</span></a>        
</span><span id="Helper.remove_note-261"><a href="#Helper.remove_note-261"><span class="linenos">261</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.remove_note-262"><a href="#Helper.remove_note-262"><span class="linenos">262</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
</span><span id="Helper.remove_note-263"><a href="#Helper.remove_note-263"><span class="linenos">263</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Helper.remove_note-264"><a href="#Helper.remove_note-264"><span class="linenos">264</span></a>
</span><span id="Helper.remove_note-265"><a href="#Helper.remove_note-265"><span class="linenos">265</span></a>
</span><span id="Helper.remove_note-266"><a href="#Helper.remove_note-266"><span class="linenos">266</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Delete notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper.remove_note-267"><a href="#Helper.remove_note-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper.remove_note-268"><a href="#Helper.remove_note-268"><span class="linenos">268</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.remove_note-269"><a href="#Helper.remove_note-269"><span class="linenos">269</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.remove_note-270"><a href="#Helper.remove_note-270"><span class="linenos">270</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper.remove_note-271"><a href="#Helper.remove_note-271"><span class="linenos">271</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error, no such file exists&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Delete a note with given filename</p>
</div>


                            </div>
                            <div id="Helper.render" class="classattr">
                                        <input id="Helper.render-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">render</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span>, </span><span class="param"><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span>, </span><span class="param"><span class="n">biber</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.render-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.render"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.render-275"><a href="#Helper.render-275"><span class="linenos">275</span></a>    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">biber</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Helper.render-276"><a href="#Helper.render-276"><span class="linenos">276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.render-277"><a href="#Helper.render-277"><span class="linenos">277</span></a>
</span><span id="Helper.render-278"><a href="#Helper.render-278"><span class="linenos">278</span></a><span class="sd">            Render the LaTeX file. By default renders as a pdf and output is stored in the folder /pdf. The other format option is html, although support is currently experimental.</span>
</span><span id="Helper.render-279"><a href="#Helper.render-279"><span class="linenos">279</span></a>
</span><span id="Helper.render-280"><a href="#Helper.render-280"><span class="linenos">280</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.render-281"><a href="#Helper.render-281"><span class="linenos">281</span></a>
</span><span id="Helper.render-282"><a href="#Helper.render-282"><span class="linenos">282</span></a>        <span class="k">if</span> <span class="n">biber</span><span class="p">:</span>
</span><span id="Helper.render-283"><a href="#Helper.render-283"><span class="linenos">283</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="Helper.render-284"><a href="#Helper.render-284"><span class="linenos">284</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.render-285"><a href="#Helper.render-285"><span class="linenos">285</span></a>
</span><span id="Helper.render-286"><a href="#Helper.render-286"><span class="linenos">286</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper.render-287"><a href="#Helper.render-287"><span class="linenos">287</span></a>        <span class="n">command</span><span class="p">,</span> <span class="n">options</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">renderers</span><span class="p">[</span><span class="nb">format</span><span class="p">]</span>
</span><span id="Helper.render-288"><a href="#Helper.render-288"><span class="linenos">288</span></a>        
</span><span id="Helper.render-289"><a href="#Helper.render-289"><span class="linenos">289</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.render-290"><a href="#Helper.render-290"><span class="linenos">290</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="Helper.render-291"><a href="#Helper.render-291"><span class="linenos">291</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper.render-292"><a href="#Helper.render-292"><span class="linenos">292</span></a>            <span class="k">pass</span>
</span><span id="Helper.render-293"><a href="#Helper.render-293"><span class="linenos">293</span></a>
</span><span id="Helper.render-294"><a href="#Helper.render-294"><span class="linenos">294</span></a>        
</span><span id="Helper.render-295"><a href="#Helper.render-295"><span class="linenos">295</span></a>        <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.render-296"><a href="#Helper.render-296"><span class="linenos">296</span></a>        <span class="n">linked_files</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper.render-297"><a href="#Helper.render-297"><span class="linenos">297</span></a>
</span><span id="Helper.render-298"><a href="#Helper.render-298"><span class="linenos">298</span></a>        <span class="n">external_documents</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Helper.render-299"><a href="#Helper.render-299"><span class="linenos">299</span></a>        <span class="n">references</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="Helper.render-300"><a href="#Helper.render-300"><span class="linenos">300</span></a>
</span><span id="Helper.render-301"><a href="#Helper.render-301"><span class="linenos">301</span></a>        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
</span><span id="Helper.render-302"><a href="#Helper.render-302"><span class="linenos">302</span></a>            <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">label</span><span class="o">.</span><span class="n">referenced_by</span><span class="p">:</span>
</span><span id="Helper.render-303"><a href="#Helper.render-303"><span class="linenos">303</span></a>                <span class="n">source</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">source</span>
</span><span id="Helper.render-304"><a href="#Helper.render-304"><span class="linenos">304</span></a>                <span class="n">references</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span id="Helper.render-305"><a href="#Helper.render-305"><span class="linenos">305</span></a>                <span class="n">linked_files</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">reference</span><span class="p">)</span>
</span><span id="Helper.render-306"><a href="#Helper.render-306"><span class="linenos">306</span></a>
</span><span id="Helper.render-307"><a href="#Helper.render-307"><span class="linenos">307</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">:</span>
</span><span id="Helper.render-308"><a href="#Helper.render-308"><span class="linenos">308</span></a>            <span class="n">target_note</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span>
</span><span id="Helper.render-309"><a href="#Helper.render-309"><span class="linenos">309</span></a>            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.render-310"><a href="#Helper.render-310"><span class="linenos">310</span></a>                <span class="n">references</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">target_note</span><span class="p">)</span> 
</span><span id="Helper.render-311"><a href="#Helper.render-311"><span class="linenos">311</span></a>      
</span><span id="Helper.render-312"><a href="#Helper.render-312"><span class="linenos">312</span></a>        <span class="c1">#inject external documents </span>
</span><span id="Helper.render-313"><a href="#Helper.render-313"><span class="linenos">313</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper.render-314"><a href="#Helper.render-314"><span class="linenos">314</span></a>            <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">references</span><span class="p">:</span>
</span><span id="Helper.render-315"><a href="#Helper.render-315"><span class="linenos">315</span></a>                <span class="k">if</span> <span class="n">reference</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.render-316"><a href="#Helper.render-316"><span class="linenos">316</span></a>                    <span class="n">external_documents</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">externaldocument[</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">reference</span><span class="si">}</span><span class="s2">-]</span><span class="se">{{</span><span class="si">{</span><span class="n">reference</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="se">}}\n</span><span class="s2">&quot;</span>
</span><span id="Helper.render-317"><a href="#Helper.render-317"><span class="linenos">317</span></a>       
</span><span id="Helper.render-318"><a href="#Helper.render-318"><span class="linenos">318</span></a>        <span class="n">referenced_by_section</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">section*{Referenced In}</span><span class="se">\n\\</span><span class="s2">begin</span><span class="si">{itemize}</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Helper.render-319"><a href="#Helper.render-319"><span class="linenos">319</span></a>        <span class="k">for</span> <span class="n">reference</span> <span class="ow">in</span> <span class="n">linked_files</span><span class="p">:</span>
</span><span id="Helper.render-320"><a href="#Helper.render-320"><span class="linenos">320</span></a>            <span class="n">referenced_by_section</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">item </span><span class="se">\\</span><span class="s2">excref</span><span class="se">{{</span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="se">}}</span><span class="s2">&quot;</span>
</span><span id="Helper.render-321"><a href="#Helper.render-321"><span class="linenos">321</span></a>
</span><span id="Helper.render-322"><a href="#Helper.render-322"><span class="linenos">322</span></a>        <span class="n">referenced_by_section</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{itemize}</span><span class="s2">&quot;</span>
</span><span id="Helper.render-323"><a href="#Helper.render-323"><span class="linenos">323</span></a>
</span><span id="Helper.render-324"><a href="#Helper.render-324"><span class="linenos">324</span></a>        
</span><span id="Helper.render-325"><a href="#Helper.render-325"><span class="linenos">325</span></a>
</span><span id="Helper.render-326"><a href="#Helper.render-326"><span class="linenos">326</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="Helper.render-327"><a href="#Helper.render-327"><span class="linenos">327</span></a>
</span><span id="Helper.render-328"><a href="#Helper.render-328"><span class="linenos">328</span></a>
</span><span id="Helper.render-329"><a href="#Helper.render-329"><span class="linenos">329</span></a>        <span class="n">path_to_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;../notes/slipbox/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="Helper.render-330"><a href="#Helper.render-330"><span class="linenos">330</span></a>
</span><span id="Helper.render-331"><a href="#Helper.render-331"><span class="linenos">331</span></a>
</span><span id="Helper.render-332"><a href="#Helper.render-332"><span class="linenos">332</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.render-333"><a href="#Helper.render-333"><span class="linenos">333</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">):</span>
</span><span id="Helper.render-334"><a href="#Helper.render-334"><span class="linenos">334</span></a>                <span class="k">pass</span>
</span><span id="Helper.render-335"><a href="#Helper.render-335"><span class="linenos">335</span></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper.render-336"><a href="#Helper.render-336"><span class="linenos">336</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No such file!&#39;</span><span class="p">)</span>
</span><span id="Helper.render-337"><a href="#Helper.render-337"><span class="linenos">337</span></a>            <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Can</span><span class="se">\&#39;</span><span class="s1">t find </span><span class="si">{</span><span class="n">path_to_file</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper.render-338"><a href="#Helper.render-338"><span class="linenos">338</span></a>
</span><span id="Helper.render-339"><a href="#Helper.render-339"><span class="linenos">339</span></a>
</span><span id="Helper.render-340"><a href="#Helper.render-340"><span class="linenos">340</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_to_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.render-341"><a href="#Helper.render-341"><span class="linenos">341</span></a>            <span class="n">contents</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="Helper.render-342"><a href="#Helper.render-342"><span class="linenos">342</span></a>
</span><span id="Helper.render-343"><a href="#Helper.render-343"><span class="linenos">343</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="Helper.render-344"><a href="#Helper.render-344"><span class="linenos">344</span></a>            <span class="n">options</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;--jobname=</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Helper.render-345"><a href="#Helper.render-345"><span class="linenos">345</span></a>        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper.render-346"><a href="#Helper.render-346"><span class="linenos">346</span></a>            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-j&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">]</span> <span class="o">+</span> <span class="n">options</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&quot;svg-&quot;&#39;</span><span class="p">]</span>
</span><span id="Helper.render-347"><a href="#Helper.render-347"><span class="linenos">347</span></a>            <span class="c1">#options = [&#39;-j&#39;, filename] + options</span>
</span><span id="Helper.render-348"><a href="#Helper.render-348"><span class="linenos">348</span></a>            
</span><span id="Helper.render-349"><a href="#Helper.render-349"><span class="linenos">349</span></a> 
</span><span id="Helper.render-350"><a href="#Helper.render-350"><span class="linenos">350</span></a>
</span><span id="Helper.render-351"><a href="#Helper.render-351"><span class="linenos">351</span></a>        <span class="n">document</span> <span class="o">=</span> <span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end</span><span class="si">{document}</span><span class="s1">&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Helper.render-352"><a href="#Helper.render-352"><span class="linenos">352</span></a>
</span><span id="Helper.render-353"><a href="#Helper.render-353"><span class="linenos">353</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">linked_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper.render-354"><a href="#Helper.render-354"><span class="linenos">354</span></a>            <span class="n">document</span> <span class="o">+=</span> <span class="n">referenced_by_section</span>
</span><span id="Helper.render-355"><a href="#Helper.render-355"><span class="linenos">355</span></a>
</span><span id="Helper.render-356"><a href="#Helper.render-356"><span class="linenos">356</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper.render-357"><a href="#Helper.render-357"><span class="linenos">357</span></a>            <span class="c1">#replace include with preamble_html and inject external documents</span>
</span><span id="Helper.render-358"><a href="#Helper.render-358"><span class="linenos">358</span></a>            <span class="n">document</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subimport{../template}</span><span class="si">{preamble.tex}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">subimport{../template}</span><span class="si">{preamble_html.tex}</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">external_documents</span><span class="p">)</span>
</span><span id="Helper.render-359"><a href="#Helper.render-359"><span class="linenos">359</span></a>
</span><span id="Helper.render-360"><a href="#Helper.render-360"><span class="linenos">360</span></a>        <span class="n">document</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">end</span><span class="si">{document}</span><span class="s2">&quot;</span>
</span><span id="Helper.render-361"><a href="#Helper.render-361"><span class="linenos">361</span></a>
</span><span id="Helper.render-362"><a href="#Helper.render-362"><span class="linenos">362</span></a>
</span><span id="Helper.render-363"><a href="#Helper.render-363"><span class="linenos">363</span></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">command</span><span class="p">,</span> <span class="o">*</span><span class="n">options</span><span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper.render-364"><a href="#Helper.render-364"><span class="linenos">364</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
</span><span id="Helper.render-365"><a href="#Helper.render-365"><span class="linenos">365</span></a>
</span><span id="Helper.render-366"><a href="#Helper.render-366"><span class="linenos">366</span></a>        <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper.render-367"><a href="#Helper.render-367"><span class="linenos">367</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to compile&#39;</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span> <span class="c1">#TODO: Exceptions</span>
</span><span id="Helper.render-368"><a href="#Helper.render-368"><span class="linenos">368</span></a>            <span class="k">return</span> <span class="n">process</span>
</span><span id="Helper.render-369"><a href="#Helper.render-369"><span class="linenos">369</span></a>
</span><span id="Helper.render-370"><a href="#Helper.render-370"><span class="linenos">370</span></a>
</span><span id="Helper.render-371"><a href="#Helper.render-371"><span class="linenos">371</span></a>        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper.render-372"><a href="#Helper.render-372"><span class="linenos">372</span></a>            <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Helper.render-373"><a href="#Helper.render-373"><span class="linenos">373</span></a>        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="Helper.render-374"><a href="#Helper.render-374"><span class="linenos">374</span></a>            <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Helper.render-375"><a href="#Helper.render-375"><span class="linenos">375</span></a>        <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper.render-376"><a href="#Helper.render-376"><span class="linenos">376</span></a>        
</span><span id="Helper.render-377"><a href="#Helper.render-377"><span class="linenos">377</span></a>        <span class="k">return</span> <span class="n">process</span>
</span></pre></div>


            <div class="docstring"><p>Render the LaTeX file. By default renders as a pdf and output is stored in the folder /pdf. The other format option is html, although support is currently experimental.</p>
</div>


                            </div>
                            <div id="Helper.render_all" class="classattr">
                                        <input id="Helper.render_all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">render_all</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.render_all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.render_all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.render_all-381"><a href="#Helper.render_all-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">render_all</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="Helper.render_all-382"><a href="#Helper.render_all-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.render_all-383"><a href="#Helper.render_all-383"><span class="linenos">383</span></a><span class="sd">            Function to replace renderallhtml and renderallpdf, rendering notes in a sensible order with regards to dependencies for PDFLaTeX links. Not currently implemented.</span>
</span><span id="Helper.render_all-384"><a href="#Helper.render_all-384"><span class="linenos">384</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.render_all-385"><a href="#Helper.render_all-385"><span class="linenos">385</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Function to replace renderallhtml and renderallpdf, rendering notes in a sensible order with regards to dependencies for PDFLaTeX links. Not currently implemented.</p>
</div>


                            </div>
                            <div id="Helper.biber" class="classattr">
                                        <input id="Helper.biber-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">biber</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">folder</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.biber-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.biber"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.biber-388"><a href="#Helper.biber-388"><span class="linenos">388</span></a>    <span class="k">def</span> <span class="nf">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">folder</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="Helper.biber-389"><a href="#Helper.biber-389"><span class="linenos">389</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.biber-390"><a href="#Helper.biber-390"><span class="linenos">390</span></a>
</span><span id="Helper.biber-391"><a href="#Helper.biber-391"><span class="linenos">391</span></a><span class="sd">            Run biber on the render of the note. Folder can be either html or pdf, depending on the format.</span>
</span><span id="Helper.biber-392"><a href="#Helper.biber-392"><span class="linenos">392</span></a>
</span><span id="Helper.biber-393"><a href="#Helper.biber-393"><span class="linenos">393</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.biber-394"><a href="#Helper.biber-394"><span class="linenos">394</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper.biber-395"><a href="#Helper.biber-395"><span class="linenos">395</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="Helper.biber-396"><a href="#Helper.biber-396"><span class="linenos">396</span></a>        <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;biber&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper.biber-397"><a href="#Helper.biber-397"><span class="linenos">397</span></a>        <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">process</span><span class="o">.</span><span class="n">stderr</span>
</span><span id="Helper.biber-398"><a href="#Helper.biber-398"><span class="linenos">398</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s1">&#39;../&#39;</span><span class="p">)</span>
</span><span id="Helper.biber-399"><a href="#Helper.biber-399"><span class="linenos">399</span></a>
</span><span id="Helper.biber-400"><a href="#Helper.biber-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="n">output</span><span class="p">,</span> <span class="n">error</span>
</span></pre></div>


            <div class="docstring"><p>Run biber on the render of the note. Folder can be either html or pdf, depending on the format.</p>
</div>


                            </div>
                            <div id="Helper.render_all_html" class="classattr">
                                        <input id="Helper.render_all_html-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">render_all_html</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.render_all_html-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.render_all_html"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.render_all_html-403"><a href="#Helper.render_all_html-403"><span class="linenos">403</span></a>    <span class="k">def</span> <span class="nf">render_all_html</span><span class="p">():</span>
</span><span id="Helper.render_all_html-404"><a href="#Helper.render_all_html-404"><span class="linenos">404</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.render_all_html-405"><a href="#Helper.render_all_html-405"><span class="linenos">405</span></a><span class="sd">            Renderes all the notes using make4ht. Saves output in /html</span>
</span><span id="Helper.render_all_html-406"><a href="#Helper.render_all_html-406"><span class="linenos">406</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.render_all_html-407"><a href="#Helper.render_all_html-407"><span class="linenos">407</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper.render_all_html-408"><a href="#Helper.render_all_html-408"><span class="linenos">408</span></a>        
</span><span id="Helper.render_all_html-409"><a href="#Helper.render_all_html-409"><span class="linenos">409</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper.render_all_html-410"><a href="#Helper.render_all_html-410"><span class="linenos">410</span></a>        
</span><span id="Helper.render_all_html-411"><a href="#Helper.render_all_html-411"><span class="linenos">411</span></a>
</span><span id="Helper.render_all_html-412"><a href="#Helper.render_all_html-412"><span class="linenos">412</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 1&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-413"><a href="#Helper.render_all_html-413"><span class="linenos">413</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper.render_all_html-414"><a href="#Helper.render_all_html-414"><span class="linenos">414</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper.render_all_html-415"><a href="#Helper.render_all_html-415"><span class="linenos">415</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-416"><a href="#Helper.render_all_html-416"><span class="linenos">416</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span> 
</span><span id="Helper.render_all_html-417"><a href="#Helper.render_all_html-417"><span class="linenos">417</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-418"><a href="#Helper.render_all_html-418"><span class="linenos">418</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running biber...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-419"><a href="#Helper.render_all_html-419"><span class="linenos">419</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-420"><a href="#Helper.render_all_html-420"><span class="linenos">420</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-421"><a href="#Helper.render_all_html-421"><span class="linenos">421</span></a>        
</span><span id="Helper.render_all_html-422"><a href="#Helper.render_all_html-422"><span class="linenos">422</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 2&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-423"><a href="#Helper.render_all_html-423"><span class="linenos">423</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper.render_all_html-424"><a href="#Helper.render_all_html-424"><span class="linenos">424</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper.render_all_html-425"><a href="#Helper.render_all_html-425"><span class="linenos">425</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-426"><a href="#Helper.render_all_html-426"><span class="linenos">426</span></a>            <span class="n">process</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-427"><a href="#Helper.render_all_html-427"><span class="linenos">427</span></a>            <span class="k">if</span> <span class="n">process</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper.render_all_html-428"><a href="#Helper.render_all_html-428"><span class="linenos">428</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_html-429"><a href="#Helper.render_all_html-429"><span class="linenos">429</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.render_all_html-430"><a href="#Helper.render_all_html-430"><span class="linenos">430</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">process</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Renderes all the notes using make4ht. Saves output in /html</p>
</div>


                            </div>
                            <div id="Helper.render_all_pdf" class="classattr">
                                        <input id="Helper.render_all_pdf-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">render_all_pdf</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.render_all_pdf-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.render_all_pdf"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.render_all_pdf-433"><a href="#Helper.render_all_pdf-433"><span class="linenos">433</span></a>    <span class="k">def</span> <span class="nf">render_all_pdf</span><span class="p">():</span>
</span><span id="Helper.render_all_pdf-434"><a href="#Helper.render_all_pdf-434"><span class="linenos">434</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.render_all_pdf-435"><a href="#Helper.render_all_pdf-435"><span class="linenos">435</span></a><span class="sd">            Renderes all the notes using pdflatex. Saves output in /pdf</span>
</span><span id="Helper.render_all_pdf-436"><a href="#Helper.render_all_pdf-436"><span class="linenos">436</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.render_all_pdf-437"><a href="#Helper.render_all_pdf-437"><span class="linenos">437</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper.render_all_pdf-438"><a href="#Helper.render_all_pdf-438"><span class="linenos">438</span></a>        
</span><span id="Helper.render_all_pdf-439"><a href="#Helper.render_all_pdf-439"><span class="linenos">439</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper.render_all_pdf-440"><a href="#Helper.render_all_pdf-440"><span class="linenos">440</span></a>        
</span><span id="Helper.render_all_pdf-441"><a href="#Helper.render_all_pdf-441"><span class="linenos">441</span></a>
</span><span id="Helper.render_all_pdf-442"><a href="#Helper.render_all_pdf-442"><span class="linenos">442</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 1&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-443"><a href="#Helper.render_all_pdf-443"><span class="linenos">443</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper.render_all_pdf-444"><a href="#Helper.render_all_pdf-444"><span class="linenos">444</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper.render_all_pdf-445"><a href="#Helper.render_all_pdf-445"><span class="linenos">445</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-446"><a href="#Helper.render_all_pdf-446"><span class="linenos">446</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> 
</span><span id="Helper.render_all_pdf-447"><a href="#Helper.render_all_pdf-447"><span class="linenos">447</span></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="Helper.render_all_pdf-448"><a href="#Helper.render_all_pdf-448"><span class="linenos">448</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-449"><a href="#Helper.render_all_pdf-449"><span class="linenos">449</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;running biber...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-450"><a href="#Helper.render_all_pdf-450"><span class="linenos">450</span></a>                <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">biber</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-451"><a href="#Helper.render_all_pdf-451"><span class="linenos">451</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-452"><a href="#Helper.render_all_pdf-452"><span class="linenos">452</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.render_all_pdf-453"><a href="#Helper.render_all_pdf-453"><span class="linenos">453</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;error!&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-454"><a href="#Helper.render_all_pdf-454"><span class="linenos">454</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">error</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-455"><a href="#Helper.render_all_pdf-455"><span class="linenos">455</span></a>        
</span><span id="Helper.render_all_pdf-456"><a href="#Helper.render_all_pdf-456"><span class="linenos">456</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;render pass 2&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-457"><a href="#Helper.render_all_pdf-457"><span class="linenos">457</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper.render_all_pdf-458"><a href="#Helper.render_all_pdf-458"><span class="linenos">458</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="Helper.render_all_pdf-459"><a href="#Helper.render_all_pdf-459"><span class="linenos">459</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;rendering </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-460"><a href="#Helper.render_all_pdf-460"><span class="linenos">460</span></a>            <span class="n">output</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-461"><a href="#Helper.render_all_pdf-461"><span class="linenos">461</span></a>            <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span><span id="Helper.render_all_pdf-462"><a href="#Helper.render_all_pdf-462"><span class="linenos">462</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</span><span id="Helper.render_all_pdf-463"><a href="#Helper.render_all_pdf-463"><span class="linenos">463</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.render_all_pdf-464"><a href="#Helper.render_all_pdf-464"><span class="linenos">464</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">error</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Renderes all the notes using pdflatex. Saves output in /pdf</p>
</div>


                            </div>
                            <div id="Helper.render_updates" class="classattr">
                                        <input id="Helper.render_updates-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">render_updates</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.render_updates-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.render_updates"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.render_updates-467"><a href="#Helper.render_updates-467"><span class="linenos">467</span></a>    <span class="k">def</span> <span class="nf">render_updates</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">):</span>
</span><span id="Helper.render_updates-468"><a href="#Helper.render_updates-468"><span class="linenos">468</span></a>        <span class="n">updated</span><span class="p">,</span> <span class="n">new_links</span><span class="p">,</span> <span class="n">run_biber</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
</span><span id="Helper.render_updates-469"><a href="#Helper.render_updates-469"><span class="linenos">469</span></a>
</span><span id="Helper.render_updates-470"><a href="#Helper.render_updates-470"><span class="linenos">470</span></a>        
</span><span id="Helper.render_updates-471"><a href="#Helper.render_updates-471"><span class="linenos">471</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="Helper.render_updates-472"><a href="#Helper.render_updates-472"><span class="linenos">472</span></a>            <span class="k">if</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
</span><span id="Helper.render_updates-473"><a href="#Helper.render_updates-473"><span class="linenos">473</span></a>                <span class="k">continue</span>
</span><span id="Helper.render_updates-474"><a href="#Helper.render_updates-474"><span class="linenos">474</span></a>            <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pdf&#39;</span><span class="p">:</span>
</span><span id="Helper.render_updates-475"><a href="#Helper.render_updates-475"><span class="linenos">475</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span><span class="p">:</span>
</span><span id="Helper.render_updates-476"><a href="#Helper.render_updates-476"><span class="linenos">476</span></a>                    <span class="n">updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.render_updates-477"><a href="#Helper.render_updates-477"><span class="linenos">477</span></a>                    <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Helper.render_updates-478"><a href="#Helper.render_updates-478"><span class="linenos">478</span></a>                    <span class="c1">#fix reference in</span>
</span><span id="Helper.render_updates-479"><a href="#Helper.render_updates-479"><span class="linenos">479</span></a>                    <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">])</span>
</span><span id="Helper.render_updates-480"><a href="#Helper.render_updates-480"><span class="linenos">480</span></a>            <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span><span id="Helper.render_updates-481"><a href="#Helper.render_updates-481"><span class="linenos">481</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span><span class="p">:</span>
</span><span id="Helper.render_updates-482"><a href="#Helper.render_updates-482"><span class="linenos">482</span></a>                    <span class="n">updated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.render_updates-483"><a href="#Helper.render_updates-483"><span class="linenos">483</span></a>                    <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Helper.render_updates-484"><a href="#Helper.render_updates-484"><span class="linenos">484</span></a>                    <span class="c1">#fix referenced in</span>
</span><span id="Helper.render_updates-485"><a href="#Helper.render_updates-485"><span class="linenos">485</span></a>                    <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">references</span><span class="p">])</span>
</span><span id="Helper.render_updates-486"><a href="#Helper.render_updates-486"><span class="linenos">486</span></a>
</span><span id="Helper.render_updates-487"><a href="#Helper.render_updates-487"><span class="linenos">487</span></a>        
</span><span id="Helper.render_updates-488"><a href="#Helper.render_updates-488"><span class="linenos">488</span></a>        <span class="c1">#render the updated files</span>
</span><span id="Helper.render_updates-489"><a href="#Helper.render_updates-489"><span class="linenos">489</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">updated</span><span class="p">:</span>
</span><span id="Helper.render_updates-490"><a href="#Helper.render_updates-490"><span class="linenos">490</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rendering </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper.render_updates-491"><a href="#Helper.render_updates-491"><span class="linenos">491</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">])</span>
</span><span id="Helper.render_updates-492"><a href="#Helper.render_updates-492"><span class="linenos">492</span></a>
</span><span id="Helper.render_updates-493"><a href="#Helper.render_updates-493"><span class="linenos">493</span></a>
</span><span id="Helper.render_updates-494"><a href="#Helper.render_updates-494"><span class="linenos">494</span></a>        <span class="n">rerendered</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper.render_updates-495"><a href="#Helper.render_updates-495"><span class="linenos">495</span></a>
</span><span id="Helper.render_updates-496"><a href="#Helper.render_updates-496"><span class="linenos">496</span></a>        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">new_links</span><span class="p">:</span>
</span><span id="Helper.render_updates-497"><a href="#Helper.render_updates-497"><span class="linenos">497</span></a>            <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span> <span class="ow">in</span> <span class="n">rerendered</span><span class="p">:</span>
</span><span id="Helper.render_updates-498"><a href="#Helper.render_updates-498"><span class="linenos">498</span></a>                <span class="k">continue</span>
</span><span id="Helper.render_updates-499"><a href="#Helper.render_updates-499"><span class="linenos">499</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Rendering </span><span class="si">{</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper.render_updates-500"><a href="#Helper.render_updates-500"><span class="linenos">500</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
</span><span id="Helper.render_updates-501"><a href="#Helper.render_updates-501"><span class="linenos">501</span></a>            <span class="n">rerendered</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="o">.</span><span class="n">target</span><span class="o">.</span><span class="n">note</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Helper.synchronize" class="classattr">
                                        <input id="Helper.synchronize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">synchronize</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.synchronize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.synchronize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.synchronize-506"><a href="#Helper.synchronize-506"><span class="linenos">506</span></a>    <span class="k">def</span> <span class="nf">synchronize</span><span class="p">():</span>
</span><span id="Helper.synchronize-507"><a href="#Helper.synchronize-507"><span class="linenos">507</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.synchronize-508"><a href="#Helper.synchronize-508"><span class="linenos">508</span></a><span class="sd">            Reads all the files that have been changed since the last call of this function and updates the database</span>
</span><span id="Helper.synchronize-509"><a href="#Helper.synchronize-509"><span class="linenos">509</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.synchronize-510"><a href="#Helper.synchronize-510"><span class="linenos">510</span></a>
</span><span id="Helper.synchronize-511"><a href="#Helper.synchronize-511"><span class="linenos">511</span></a>
</span><span id="Helper.synchronize-512"><a href="#Helper.synchronize-512"><span class="linenos">512</span></a>        <span class="c1">#loop through all the tracked notes and check for required updates</span>
</span><span id="Helper.synchronize-513"><a href="#Helper.synchronize-513"><span class="linenos">513</span></a>        <span class="n">to_read</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper.synchronize-514"><a href="#Helper.synchronize-514"><span class="linenos">514</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="Helper.synchronize-515"><a href="#Helper.synchronize-515"><span class="linenos">515</span></a>            <span class="c1">#try and get the edit date from the file system. </span>
</span><span id="Helper.synchronize-516"><a href="#Helper.synchronize-516"><span class="linenos">516</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.synchronize-517"><a href="#Helper.synchronize-517"><span class="linenos">517</span></a>                <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.synchronize-518"><a href="#Helper.synchronize-518"><span class="linenos">518</span></a>                <span class="n">modified</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="Helper.synchronize-519"><a href="#Helper.synchronize-519"><span class="linenos">519</span></a>
</span><span id="Helper.synchronize-520"><a href="#Helper.synchronize-520"><span class="linenos">520</span></a>                <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span><span class="p">:</span>
</span><span id="Helper.synchronize-521"><a href="#Helper.synchronize-521"><span class="linenos">521</span></a>                    <span class="n">to_read</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.synchronize-522"><a href="#Helper.synchronize-522"><span class="linenos">522</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">modified</span><span class="p">)</span>
</span><span id="Helper.synchronize-523"><a href="#Helper.synchronize-523"><span class="linenos">523</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper.synchronize-524"><a href="#Helper.synchronize-524"><span class="linenos">524</span></a>
</span><span id="Helper.synchronize-525"><a href="#Helper.synchronize-525"><span class="linenos">525</span></a>            <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="Helper.synchronize-526"><a href="#Helper.synchronize-526"><span class="linenos">526</span></a>                <span class="c1">#Todo: file has been deleted or renamed without the database being updated really need to run force_synchronize.</span>
</span><span id="Helper.synchronize-527"><a href="#Helper.synchronize-527"><span class="linenos">527</span></a>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file not found for note with reference </span><span class="si">{note.reference}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper.synchronize-528"><a href="#Helper.synchronize-528"><span class="linenos">528</span></a>                <span class="k">pass</span>
</span><span id="Helper.synchronize-529"><a href="#Helper.synchronize-529"><span class="linenos">529</span></a>
</span><span id="Helper.synchronize-530"><a href="#Helper.synchronize-530"><span class="linenos">530</span></a>        <span class="c1">#update labels </span>
</span><span id="Helper.synchronize-531"><a href="#Helper.synchronize-531"><span class="linenos">531</span></a>        <span class="n">run_biber</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Helper.synchronize-532"><a href="#Helper.synchronize-532"><span class="linenos">532</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">to_read</span><span class="p">:</span>
</span><span id="Helper.synchronize-533"><a href="#Helper.synchronize-533"><span class="linenos">533</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.synchronize-534"><a href="#Helper.synchronize-534"><span class="linenos">534</span></a>            <span class="n">run_biber</span><span class="p">[</span><span class="n">note</span><span class="p">]</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.synchronize-535"><a href="#Helper.synchronize-535"><span class="linenos">535</span></a>
</span><span id="Helper.synchronize-536"><a href="#Helper.synchronize-536"><span class="linenos">536</span></a>
</span><span id="Helper.synchronize-537"><a href="#Helper.synchronize-537"><span class="linenos">537</span></a>        <span class="n">new_links</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper.synchronize-538"><a href="#Helper.synchronize-538"><span class="linenos">538</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">to_read</span><span class="p">:</span>
</span><span id="Helper.synchronize-539"><a href="#Helper.synchronize-539"><span class="linenos">539</span></a>            <span class="n">new_links</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">Helper</span><span class="o">.</span><span class="n">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">))</span>
</span><span id="Helper.synchronize-540"><a href="#Helper.synchronize-540"><span class="linenos">540</span></a>
</span><span id="Helper.synchronize-541"><a href="#Helper.synchronize-541"><span class="linenos">541</span></a>
</span><span id="Helper.synchronize-542"><a href="#Helper.synchronize-542"><span class="linenos">542</span></a>        <span class="k">return</span> <span class="n">to_read</span><span class="p">,</span> <span class="n">new_links</span><span class="p">,</span> <span class="n">run_biber</span>
</span></pre></div>


            <div class="docstring"><p>Reads all the files that have been changed since the last call of this function and updates the database</p>
</div>


                            </div>
                            <div id="Helper.force_synchronize" class="classattr">
                                        <input id="Helper.force_synchronize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">force_synchronize</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.force_synchronize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.force_synchronize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.force_synchronize-546"><a href="#Helper.force_synchronize-546"><span class="linenos">546</span></a>    <span class="k">def</span> <span class="nf">force_synchronize</span><span class="p">():</span>
</span><span id="Helper.force_synchronize-547"><a href="#Helper.force_synchronize-547"><span class="linenos">547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.force_synchronize-548"><a href="#Helper.force_synchronize-548"><span class="linenos">548</span></a><span class="sd">            Reads the file documents.tex and adds these files to the database (/slipbox.db) and checks for files in /notes that aren&#39;t in the documents. Then fixes and confilcts with these before reading the notes and creating database objects for labels, links and citations. </span>
</span><span id="Helper.force_synchronize-549"><a href="#Helper.force_synchronize-549"><span class="linenos">549</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.force_synchronize-550"><a href="#Helper.force_synchronize-550"><span class="linenos">550</span></a>        <span class="n">database</span><span class="o">.</span><span class="n">create_all_tables</span><span class="p">()</span>
</span><span id="Helper.force_synchronize-551"><a href="#Helper.force_synchronize-551"><span class="linenos">551</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getnotefiles</span><span class="p">()</span>
</span><span id="Helper.force_synchronize-552"><a href="#Helper.force_synchronize-552"><span class="linenos">552</span></a>        <span class="n">notes</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">note</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">]</span>
</span><span id="Helper.force_synchronize-553"><a href="#Helper.force_synchronize-553"><span class="linenos">553</span></a>        <span class="c1">#get all the tracked notes (the ones in documents.tex)</span>
</span><span id="Helper.force_synchronize-554"><a href="#Helper.force_synchronize-554"><span class="linenos">554</span></a>        <span class="n">tracked_notes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Helper.force_synchronize-555"><a href="#Helper.force_synchronize-555"><span class="linenos">555</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;notes/documents.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-556"><a href="#Helper.force_synchronize-556"><span class="linenos">556</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-557"><a href="#Helper.force_synchronize-557"><span class="linenos">557</span></a>                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;(</span><span class="se">\\\\</span><span class="s1">externaldocument\[)(.+?)(\-\]\{)(.+?)(\})&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-558"><a href="#Helper.force_synchronize-558"><span class="linenos">558</span></a>                <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-559"><a href="#Helper.force_synchronize-559"><span class="linenos">559</span></a>                    <span class="n">reference_name</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-560"><a href="#Helper.force_synchronize-560"><span class="linenos">560</span></a>                    <span class="n">filename</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-561"><a href="#Helper.force_synchronize-561"><span class="linenos">561</span></a>
</span><span id="Helper.force_synchronize-562"><a href="#Helper.force_synchronize-562"><span class="linenos">562</span></a>
</span><span id="Helper.force_synchronize-563"><a href="#Helper.force_synchronize-563"><span class="linenos">563</span></a>                    <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-564"><a href="#Helper.force_synchronize-564"><span class="linenos">564</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> with reference </span><span class="si">{</span><span class="n">reference_name</span><span class="si">}</span><span class="s1"> missing from notes. Make new note now? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-565"><a href="#Helper.force_synchronize-565"><span class="linenos">565</span></a>                        <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper.force_synchronize-566"><a href="#Helper.force_synchronize-566"><span class="linenos">566</span></a>                            <span class="n">Helper</span><span class="o">.</span><span class="n">__createnotefile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-567"><a href="#Helper.force_synchronize-567"><span class="linenos">567</span></a>                            <span class="n">tracked_notes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="Helper.force_synchronize-568"><a href="#Helper.force_synchronize-568"><span class="linenos">568</span></a>                            
</span><span id="Helper.force_synchronize-569"><a href="#Helper.force_synchronize-569"><span class="linenos">569</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-570"><a href="#Helper.force_synchronize-570"><span class="linenos">570</span></a>                        <span class="n">tracked_notes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="Helper.force_synchronize-571"><a href="#Helper.force_synchronize-571"><span class="linenos">571</span></a>
</span><span id="Helper.force_synchronize-572"><a href="#Helper.force_synchronize-572"><span class="linenos">572</span></a>        <span class="k">for</span> <span class="n">filename</span><span class="p">,</span> <span class="n">reference_name</span> <span class="ow">in</span> <span class="n">tracked_notes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Helper.force_synchronize-573"><a href="#Helper.force_synchronize-573"><span class="linenos">573</span></a>            <span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-574"><a href="#Helper.force_synchronize-574"><span class="linenos">574</span></a>            <span class="n">modified</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">filepath</span><span class="p">))</span>
</span><span id="Helper.force_synchronize-575"><a href="#Helper.force_synchronize-575"><span class="linenos">575</span></a>            
</span><span id="Helper.force_synchronize-576"><a href="#Helper.force_synchronize-576"><span class="linenos">576</span></a>
</span><span id="Helper.force_synchronize-577"><a href="#Helper.force_synchronize-577"><span class="linenos">577</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-578"><a href="#Helper.force_synchronize-578"><span class="linenos">578</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-579"><a href="#Helper.force_synchronize-579"><span class="linenos">579</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span> <span class="o">=</span> <span class="n">modified</span>
</span><span id="Helper.force_synchronize-580"><a href="#Helper.force_synchronize-580"><span class="linenos">580</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-581"><a href="#Helper.force_synchronize-581"><span class="linenos">581</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">created</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">last_edit_date</span>
</span><span id="Helper.force_synchronize-582"><a href="#Helper.force_synchronize-582"><span class="linenos">582</span></a>
</span><span id="Helper.force_synchronize-583"><a href="#Helper.force_synchronize-583"><span class="linenos">583</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-584"><a href="#Helper.force_synchronize-584"><span class="linenos">584</span></a>                    <span class="n">html_render</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;html/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.html&#39;</span><span class="p">))</span>
</span><span id="Helper.force_synchronize-585"><a href="#Helper.force_synchronize-585"><span class="linenos">585</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_html</span> <span class="o">=</span> <span class="n">html_render</span>
</span><span id="Helper.force_synchronize-586"><a href="#Helper.force_synchronize-586"><span class="linenos">586</span></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-587"><a href="#Helper.force_synchronize-587"><span class="linenos">587</span></a>                    <span class="c1">#print(f&#39;{filename} is yet to be rendered as html&#39;)</span>
</span><span id="Helper.force_synchronize-588"><a href="#Helper.force_synchronize-588"><span class="linenos">588</span></a>                    <span class="k">pass</span>
</span><span id="Helper.force_synchronize-589"><a href="#Helper.force_synchronize-589"><span class="linenos">589</span></a>                
</span><span id="Helper.force_synchronize-590"><a href="#Helper.force_synchronize-590"><span class="linenos">590</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-591"><a href="#Helper.force_synchronize-591"><span class="linenos">591</span></a>                    <span class="n">pdf_render</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;pdf/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">))</span>
</span><span id="Helper.force_synchronize-592"><a href="#Helper.force_synchronize-592"><span class="linenos">592</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">last_build_date_pdf</span> <span class="o">=</span> <span class="n">pdf_render</span>
</span><span id="Helper.force_synchronize-593"><a href="#Helper.force_synchronize-593"><span class="linenos">593</span></a>                <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-594"><a href="#Helper.force_synchronize-594"><span class="linenos">594</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> is yet to be rendered as pdf&#39;</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-595"><a href="#Helper.force_synchronize-595"><span class="linenos">595</span></a>                
</span><span id="Helper.force_synchronize-596"><a href="#Helper.force_synchronize-596"><span class="linenos">596</span></a>
</span><span id="Helper.force_synchronize-597"><a href="#Helper.force_synchronize-597"><span class="linenos">597</span></a>
</span><span id="Helper.force_synchronize-598"><a href="#Helper.force_synchronize-598"><span class="linenos">598</span></a>                <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">==</span> <span class="n">reference_name</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-599"><a href="#Helper.force_synchronize-599"><span class="linenos">599</span></a>                    <span class="k">pass</span> <span class="c1">#nothing to do</span>
</span><span id="Helper.force_synchronize-600"><a href="#Helper.force_synchronize-600"><span class="linenos">600</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-601"><a href="#Helper.force_synchronize-601"><span class="linenos">601</span></a>                    <span class="c1">#update note reference to the one in documents.tex, might want to check that this is the right thing to do</span>
</span><span id="Helper.force_synchronize-602"><a href="#Helper.force_synchronize-602"><span class="linenos">602</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">reference</span> <span class="o">=</span> <span class="n">reference_name</span>
</span><span id="Helper.force_synchronize-603"><a href="#Helper.force_synchronize-603"><span class="linenos">603</span></a>                <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper.force_synchronize-604"><a href="#Helper.force_synchronize-604"><span class="linenos">604</span></a>            
</span><span id="Helper.force_synchronize-605"><a href="#Helper.force_synchronize-605"><span class="linenos">605</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-606"><a href="#Helper.force_synchronize-606"><span class="linenos">606</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-607"><a href="#Helper.force_synchronize-607"><span class="linenos">607</span></a>                    <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-608"><a href="#Helper.force_synchronize-608"><span class="linenos">608</span></a>                    <span class="c1">#update the filename in database, might want to check that this is the right thing to do</span>
</span><span id="Helper.force_synchronize-609"><a href="#Helper.force_synchronize-609"><span class="linenos">609</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="Helper.force_synchronize-610"><a href="#Helper.force_synchronize-610"><span class="linenos">610</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper.force_synchronize-611"><a href="#Helper.force_synchronize-611"><span class="linenos">611</span></a>                <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-612"><a href="#Helper.force_synchronize-612"><span class="linenos">612</span></a>                    <span class="c1">#create the note if there are no close matches</span>
</span><span id="Helper.force_synchronize-613"><a href="#Helper.force_synchronize-613"><span class="linenos">613</span></a>                    <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference_name</span><span class="p">,</span> <span class="n">created_at</span><span class="o">=</span><span class="n">modified</span><span class="p">,</span> <span class="n">last_edit_date</span><span class="o">=</span><span class="n">modified</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-614"><a href="#Helper.force_synchronize-614"><span class="linenos">614</span></a>                    <span class="n">note</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span><span id="Helper.force_synchronize-615"><a href="#Helper.force_synchronize-615"><span class="linenos">615</span></a>
</span><span id="Helper.force_synchronize-616"><a href="#Helper.force_synchronize-616"><span class="linenos">616</span></a>
</span><span id="Helper.force_synchronize-617"><a href="#Helper.force_synchronize-617"><span class="linenos">617</span></a>
</span><span id="Helper.force_synchronize-618"><a href="#Helper.force_synchronize-618"><span class="linenos">618</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">notes</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-619"><a href="#Helper.force_synchronize-619"><span class="linenos">619</span></a>            <span class="c1">#add any notes to documents.tex</span>
</span><span id="Helper.force_synchronize-620"><a href="#Helper.force_synchronize-620"><span class="linenos">620</span></a>            <span class="k">if</span> <span class="n">note</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tracked_notes</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-621"><a href="#Helper.force_synchronize-621"><span class="linenos">621</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;File </span><span class="si">{</span><span class="n">note</span><span class="si">}</span><span class="s1"> not tracked by the file documents.tex. Add to the file now? (y/n)&#39;</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-622"><a href="#Helper.force_synchronize-622"><span class="linenos">622</span></a>                <span class="k">if</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span> 
</span><span id="Helper.force_synchronize-623"><a href="#Helper.force_synchronize-623"><span class="linenos">623</span></a>                    <span class="n">reference</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">note</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)])</span>
</span><span id="Helper.force_synchronize-624"><a href="#Helper.force_synchronize-624"><span class="linenos">624</span></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reference (defaults to </span><span class="si">{</span><span class="n">reference</span><span class="si">}</span><span class="s1">):&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-625"><a href="#Helper.force_synchronize-625"><span class="linenos">625</span></a>                    <span class="n">new_reference</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span>
</span><span id="Helper.force_synchronize-626"><a href="#Helper.force_synchronize-626"><span class="linenos">626</span></a>                    <span class="k">if</span> <span class="n">new_reference</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-627"><a href="#Helper.force_synchronize-627"><span class="linenos">627</span></a>                        <span class="n">reference</span> <span class="o">=</span> <span class="n">new_reference</span>
</span><span id="Helper.force_synchronize-628"><a href="#Helper.force_synchronize-628"><span class="linenos">628</span></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-629"><a href="#Helper.force_synchronize-629"><span class="linenos">629</span></a>                        <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">note</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">reference</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-630"><a href="#Helper.force_synchronize-630"><span class="linenos">630</span></a>                        <span class="n">Helper</span><span class="o">.</span><span class="n">addtodocuments</span><span class="p">(</span><span class="n">note</span><span class="p">,</span> <span class="n">reference</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-631"><a href="#Helper.force_synchronize-631"><span class="linenos">631</span></a>                    <span class="k">except</span> <span class="n">pw</span><span class="o">.</span><span class="n">IntegrityError</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-632"><a href="#Helper.force_synchronize-632"><span class="linenos">632</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error adding note, note already exists in database&#39;</span><span class="p">)</span> 
</span><span id="Helper.force_synchronize-633"><a href="#Helper.force_synchronize-633"><span class="linenos">633</span></a>        
</span><span id="Helper.force_synchronize-634"><a href="#Helper.force_synchronize-634"><span class="linenos">634</span></a>        <span class="c1">#add labels</span>
</span><span id="Helper.force_synchronize-635"><a href="#Helper.force_synchronize-635"><span class="linenos">635</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span>
</span><span id="Helper.force_synchronize-636"><a href="#Helper.force_synchronize-636"><span class="linenos">636</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_labels</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-637"><a href="#Helper.force_synchronize-637"><span class="linenos">637</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_citations</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span><span id="Helper.force_synchronize-638"><a href="#Helper.force_synchronize-638"><span class="linenos">638</span></a>                   
</span><span id="Helper.force_synchronize-639"><a href="#Helper.force_synchronize-639"><span class="linenos">639</span></a>        <span class="c1">#add connections</span>
</span><span id="Helper.force_synchronize-640"><a href="#Helper.force_synchronize-640"><span class="linenos">640</span></a>
</span><span id="Helper.force_synchronize-641"><a href="#Helper.force_synchronize-641"><span class="linenos">641</span></a>        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="p">:</span> 
</span><span id="Helper.force_synchronize-642"><a href="#Helper.force_synchronize-642"><span class="linenos">642</span></a>            <span class="n">Helper</span><span class="o">.</span><span class="n">__update_links</span><span class="p">(</span><span class="n">note</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reads the file documents.tex and adds these files to the database (/slipbox.db) and checks for files in /notes that aren't in the documents. Then fixes and confilcts with these before reading the notes and creating database objects for labels, links and citations.</p>
</div>


                            </div>
                            <div id="Helper.list_unreferenced" class="classattr">
                                        <input id="Helper.list_unreferenced-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_unreferenced</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.list_unreferenced-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.list_unreferenced"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.list_unreferenced-648"><a href="#Helper.list_unreferenced-648"><span class="linenos">648</span></a>    <span class="k">def</span> <span class="nf">list_unreferenced</span><span class="p">():</span>
</span><span id="Helper.list_unreferenced-649"><a href="#Helper.list_unreferenced-649"><span class="linenos">649</span></a>        <span class="kn">from</span> <span class="nn">LatexZettel</span> <span class="kn">import</span> <span class="n">analysis</span>
</span><span id="Helper.list_unreferenced-650"><a href="#Helper.list_unreferenced-650"><span class="linenos">650</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.list_unreferenced-651"><a href="#Helper.list_unreferenced-651"><span class="linenos">651</span></a><span class="sd">            Prints a list of notes that are not referenced in any other note. These might want to be added to the index, for example. </span>
</span><span id="Helper.list_unreferenced-652"><a href="#Helper.list_unreferenced-652"><span class="linenos">652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.list_unreferenced-653"><a href="#Helper.list_unreferenced-653"><span class="linenos">653</span></a>        <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="Helper.list_unreferenced-654"><a href="#Helper.list_unreferenced-654"><span class="linenos">654</span></a>        <span class="n">notes</span><span class="p">,</span> <span class="n">adj_matrix</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">calculate_adjacency_matrix</span><span class="p">()</span>
</span><span id="Helper.list_unreferenced-655"><a href="#Helper.list_unreferenced-655"><span class="linenos">655</span></a>
</span><span id="Helper.list_unreferenced-656"><a href="#Helper.list_unreferenced-656"><span class="linenos">656</span></a>        <span class="n">referenced_by</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adj_matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Helper.list_unreferenced-657"><a href="#Helper.list_unreferenced-657"><span class="linenos">657</span></a>        
</span><span id="Helper.list_unreferenced-658"><a href="#Helper.list_unreferenced-658"><span class="linenos">658</span></a>        <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Helper.list_unreferenced-659"><a href="#Helper.list_unreferenced-659"><span class="linenos">659</span></a>        <span class="k">for</span> <span class="n">note</span><span class="p">,</span> <span class="n">links_from</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">notes</span><span class="p">,</span> <span class="n">referenced_by</span><span class="p">):</span>
</span><span id="Helper.list_unreferenced-660"><a href="#Helper.list_unreferenced-660"><span class="linenos">660</span></a>            <span class="k">if</span> <span class="n">links_from</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Helper.list_unreferenced-661"><a href="#Helper.list_unreferenced-661"><span class="linenos">661</span></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="Helper.list_unreferenced-662"><a href="#Helper.list_unreferenced-662"><span class="linenos">662</span></a>                <span class="n">number</span> <span class="o">+=</span> <span class="mi">1</span>
</span></pre></div>


    

                            </div>
                            <div id="Helper.edit" class="classattr">
                                        <input id="Helper.edit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">edit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.edit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.edit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.edit-664"><a href="#Helper.edit-664"><span class="linenos">664</span></a>    <span class="k">def</span> <span class="nf">edit</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper.edit-665"><a href="#Helper.edit-665"><span class="linenos">665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.edit-666"><a href="#Helper.edit-666"><span class="linenos">666</span></a>
</span><span id="Helper.edit-667"><a href="#Helper.edit-667"><span class="linenos">667</span></a><span class="sd">            Open the note default text editor in the directory /notes/slipbox. If no file is passed then this opens </span>
</span><span id="Helper.edit-668"><a href="#Helper.edit-668"><span class="linenos">668</span></a>
</span><span id="Helper.edit-669"><a href="#Helper.edit-669"><span class="linenos">669</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.edit-670"><a href="#Helper.edit-670"><span class="linenos">670</span></a>
</span><span id="Helper.edit-671"><a href="#Helper.edit-671"><span class="linenos">671</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper.edit-672"><a href="#Helper.edit-672"><span class="linenos">672</span></a>        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.edit-673"><a href="#Helper.edit-673"><span class="linenos">673</span></a>            <span class="n">most_recent</span> <span class="o">=</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__get_recent_files</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Helper.edit-674"><a href="#Helper.edit-674"><span class="linenos">674</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;slipbox&#39;</span><span class="p">))</span>
</span><span id="Helper.edit-675"><a href="#Helper.edit-675"><span class="linenos">675</span></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">OPEN_COMMAND</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">most_recent</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span>
</span><span id="Helper.edit-676"><a href="#Helper.edit-676"><span class="linenos">676</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.edit-677"><a href="#Helper.edit-677"><span class="linenos">677</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span><span class="s1">&#39;slipbox&#39;</span><span class="p">))</span>
</span><span id="Helper.edit-678"><a href="#Helper.edit-678"><span class="linenos">678</span></a>            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="n">OPEN_COMMAND</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Open the note default text editor in the directory /notes/slipbox. If no file is passed then this opens</p>
</div>


                            </div>
                            <div id="Helper.to_md" class="classattr">
                                        <input id="Helper.to_md-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_md</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">note_name</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.to_md-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.to_md"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.to_md-681"><a href="#Helper.to_md-681"><span class="linenos">681</span></a>    <span class="k">def</span> <span class="nf">to_md</span><span class="p">(</span><span class="n">note_name</span><span class="p">):</span>
</span><span id="Helper.to_md-682"><a href="#Helper.to_md-682"><span class="linenos">682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;            </span>
</span><span id="Helper.to_md-683"><a href="#Helper.to_md-683"><span class="linenos">683</span></a><span class="sd">            Work in progress. Export a LaTeX document note to markdown, and convert references to [[WikiLink]] style references.</span>
</span><span id="Helper.to_md-684"><a href="#Helper.to_md-684"><span class="linenos">684</span></a>
</span><span id="Helper.to_md-685"><a href="#Helper.to_md-685"><span class="linenos">685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.to_md-686"><a href="#Helper.to_md-686"><span class="linenos">686</span></a>        <span class="k">def</span> <span class="nf">replace_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">md_links</span><span class="p">):</span>
</span><span id="Helper.to_md-687"><a href="#Helper.to_md-687"><span class="linenos">687</span></a>            <span class="n">replacement</span> <span class="o">=</span> <span class="s1">&#39;[[&#39;</span>
</span><span id="Helper.to_md-688"><a href="#Helper.to_md-688"><span class="linenos">688</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Helper.to_md-689"><a href="#Helper.to_md-689"><span class="linenos">689</span></a>            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;c&#39;</span><span class="p">:</span>
</span><span id="Helper.to_md-690"><a href="#Helper.to_md-690"><span class="linenos">690</span></a>                <span class="n">replacement</span> <span class="o">+=</span> <span class="n">md_links</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span>
</span><span id="Helper.to_md-691"><a href="#Helper.to_md-691"><span class="linenos">691</span></a>            <span class="k">elif</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;hyper&#39;</span><span class="p">:</span>
</span><span id="Helper.to_md-692"><a href="#Helper.to_md-692"><span class="linenos">692</span></a>                <span class="n">replacement</span> <span class="o">+=</span> <span class="n">md_links</span><span class="p">[(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">))]</span> <span class="o">+</span> <span class="s1">&#39;|&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
</span><span id="Helper.to_md-693"><a href="#Helper.to_md-693"><span class="linenos">693</span></a>
</span><span id="Helper.to_md-694"><a href="#Helper.to_md-694"><span class="linenos">694</span></a>            <span class="nb">print</span><span class="p">(</span><span class="n">replacement</span><span class="p">)</span>
</span><span id="Helper.to_md-695"><a href="#Helper.to_md-695"><span class="linenos">695</span></a>
</span><span id="Helper.to_md-696"><a href="#Helper.to_md-696"><span class="linenos">696</span></a>            <span class="k">return</span> <span class="n">replacement</span> <span class="o">+</span> <span class="s1">&#39;]]&#39;</span>
</span><span id="Helper.to_md-697"><a href="#Helper.to_md-697"><span class="linenos">697</span></a>        <span class="c1"># load the file and convert exhyperref and excref to Wiki links</span>
</span><span id="Helper.to_md-698"><a href="#Helper.to_md-698"><span class="linenos">698</span></a>        <span class="n">file</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper.to_md-699"><a href="#Helper.to_md-699"><span class="linenos">699</span></a>        <span class="n">file_references</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Helper.to_md-700"><a href="#Helper.to_md-700"><span class="linenos">700</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;notes/slipbox/</span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.to_md-701"><a href="#Helper.to_md-701"><span class="linenos">701</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.to_md-702"><a href="#Helper.to_md-702"><span class="linenos">702</span></a>                <span class="n">file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span><span id="Helper.to_md-703"><a href="#Helper.to_md-703"><span class="linenos">703</span></a>                <span class="n">links</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex?(hyper)?(c)?ref(\[([^]+)\])?\{(.*?)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper.to_md-704"><a href="#Helper.to_md-704"><span class="linenos">704</span></a>                <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
</span><span id="Helper.to_md-705"><a href="#Helper.to_md-705"><span class="linenos">705</span></a>                    <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.to_md-706"><a href="#Helper.to_md-706"><span class="linenos">706</span></a>                        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="Helper.to_md-707"><a href="#Helper.to_md-707"><span class="linenos">707</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.to_md-708"><a href="#Helper.to_md-708"><span class="linenos">708</span></a>                        <span class="n">label</span> <span class="o">=</span> <span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
</span><span id="Helper.to_md-709"><a href="#Helper.to_md-709"><span class="linenos">709</span></a>                    <span class="n">file_references</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">link</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">label</span><span class="p">))</span> 
</span><span id="Helper.to_md-710"><a href="#Helper.to_md-710"><span class="linenos">710</span></a>                                 
</span><span id="Helper.to_md-711"><a href="#Helper.to_md-711"><span class="linenos">711</span></a>        <span class="n">md_links</span> <span class="o">=</span> <span class="p">{}</span> 
</span><span id="Helper.to_md-712"><a href="#Helper.to_md-712"><span class="linenos">712</span></a>        <span class="k">for</span> <span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span> <span class="ow">in</span> <span class="n">file_references</span><span class="p">:</span>
</span><span id="Helper.to_md-713"><a href="#Helper.to_md-713"><span class="linenos">713</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.to_md-714"><a href="#Helper.to_md-714"><span class="linenos">714</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">reference</span><span class="o">=</span><span class="n">ref</span><span class="p">)</span>
</span><span id="Helper.to_md-715"><a href="#Helper.to_md-715"><span class="linenos">715</span></a>            <span class="k">except</span> <span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span><span id="Helper.to_md-716"><a href="#Helper.to_md-716"><span class="linenos">716</span></a>                <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Helper.to_md-717"><a href="#Helper.to_md-717"><span class="linenos">717</span></a>
</span><span id="Helper.to_md-718"><a href="#Helper.to_md-718"><span class="linenos">718</span></a>            <span class="k">if</span> <span class="n">tex_label</span> <span class="o">==</span> <span class="s1">&#39;note&#39;</span><span class="p">:</span>
</span><span id="Helper.to_md-719"><a href="#Helper.to_md-719"><span class="linenos">719</span></a>                <span class="n">md_links</span><span class="p">[(</span><span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span><span class="p">)]</span> <span class="o">=</span> <span class="n">note</span><span class="o">.</span><span class="n">filename</span>
</span><span id="Helper.to_md-720"><a href="#Helper.to_md-720"><span class="linenos">720</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Helper.to_md-721"><a href="#Helper.to_md-721"><span class="linenos">721</span></a>                <span class="n">md_links</span><span class="p">[(</span><span class="n">ref</span><span class="p">,</span> <span class="n">tex_label</span><span class="p">)]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">note</span><span class="o">.</span><span class="n">filename</span><span class="si">}</span><span class="s1">#</span><span class="si">{</span><span class="n">tex_label</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper.to_md-722"><a href="#Helper.to_md-722"><span class="linenos">722</span></a>        <span class="n">new_file</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper.to_md-723"><a href="#Helper.to_md-723"><span class="linenos">723</span></a>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
</span><span id="Helper.to_md-724"><a href="#Helper.to_md-724"><span class="linenos">724</span></a>            <span class="n">new_file</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ex(hyper)?(c)?ref(\[([^]]+)\])?\{(.*?)\}(\{(.*?)\})?&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">m</span> <span class="p">:</span> <span class="n">replace_string</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">md_links</span><span class="p">),</span> <span class="n">line</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.to_md-725"><a href="#Helper.to_md-725"><span class="linenos">725</span></a>
</span><span id="Helper.to_md-726"><a href="#Helper.to_md-726"><span class="linenos">726</span></a>        <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="Helper.to_md-727"><a href="#Helper.to_md-727"><span class="linenos">727</span></a>
</span><span id="Helper.to_md-728"><a href="#Helper.to_md-728"><span class="linenos">728</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">new_file</span><span class="p">)</span>
</span><span id="Helper.to_md-729"><a href="#Helper.to_md-729"><span class="linenos">729</span></a>
</span><span id="Helper.to_md-730"><a href="#Helper.to_md-730"><span class="linenos">730</span></a>        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;pandoc&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="s2">&quot;markdown&quot;</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;latex&quot;</span><span class="p">,</span> <span class="s2">&quot;-o&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;markdown/</span><span class="si">{</span><span class="n">note_name</span><span class="si">}</span><span class="s2">.md&quot;</span> <span class="p">],</span> <span class="nb">input</span><span class="o">=</span><span class="n">new_file</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Helper.to_md-731"><a href="#Helper.to_md-731"><span class="linenos">731</span></a>
</span><span id="Helper.to_md-732"><a href="#Helper.to_md-732"><span class="linenos">732</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Work in progress. Export a LaTeX document note to markdown, and convert references to [[WikiLink]] style references.</p>
</div>


                            </div>
                            <div id="Helper.export_project" class="classattr">
                                        <input id="Helper.export_project-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">export_project</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">project_folder</span>, </span><span class="param"><span class="n">texfile</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.export_project-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.export_project"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.export_project-735"><a href="#Helper.export_project-735"><span class="linenos">735</span></a>    <span class="k">def</span> <span class="nf">export_project</span><span class="p">(</span><span class="n">project_folder</span><span class="p">,</span> <span class="n">texfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper.export_project-736"><a href="#Helper.export_project-736"><span class="linenos">736</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.export_project-737"><a href="#Helper.export_project-737"><span class="linenos">737</span></a>
</span><span id="Helper.export_project-738"><a href="#Helper.export_project-738"><span class="linenos">738</span></a><span class="sd">            Replaces \\transclude calls in a project file with the contents of the notes. Output is saved in project_dir/standalone</span>
</span><span id="Helper.export_project-739"><a href="#Helper.export_project-739"><span class="linenos">739</span></a>
</span><span id="Helper.export_project-740"><a href="#Helper.export_project-740"><span class="linenos">740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.export_project-741"><a href="#Helper.export_project-741"><span class="linenos">741</span></a>
</span><span id="Helper.export_project-742"><a href="#Helper.export_project-742"><span class="linenos">742</span></a>        <span class="k">if</span> <span class="n">texfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.export_project-743"><a href="#Helper.export_project-743"><span class="linenos">743</span></a>            <span class="n">texfile</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">project_folder</span><span class="si">}</span><span class="s1">.tex&#39;</span>
</span><span id="Helper.export_project-744"><a href="#Helper.export_project-744"><span class="linenos">744</span></a>
</span><span id="Helper.export_project-745"><a href="#Helper.export_project-745"><span class="linenos">745</span></a>        <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="s1">&#39;standalone&#39;</span><span class="p">)</span>
</span><span id="Helper.export_project-746"><a href="#Helper.export_project-746"><span class="linenos">746</span></a>
</span><span id="Helper.export_project-747"><a href="#Helper.export_project-747"><span class="linenos">747</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.export_project-748"><a href="#Helper.export_project-748"><span class="linenos">748</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>
</span><span id="Helper.export_project-749"><a href="#Helper.export_project-749"><span class="linenos">749</span></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper.export_project-750"><a href="#Helper.export_project-750"><span class="linenos">750</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Export already exists, continue? (Warning: This will overwrite any changes you have made to the file </span><span class="si">{texfile}</span><span class="s1"> in </span><span class="si">{output_dir}</span><span class="s1">)&#39;</span><span class="p">)</span>
</span><span id="Helper.export_project-751"><a href="#Helper.export_project-751"><span class="linenos">751</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">Helper</span><span class="o">.</span><span class="n">__getyesno</span><span class="p">():</span>
</span><span id="Helper.export_project-752"><a href="#Helper.export_project-752"><span class="linenos">752</span></a>                <span class="k">return</span>
</span><span id="Helper.export_project-753"><a href="#Helper.export_project-753"><span class="linenos">753</span></a>
</span><span id="Helper.export_project-754"><a href="#Helper.export_project-754"><span class="linenos">754</span></a>
</span><span id="Helper.export_project-755"><a href="#Helper.export_project-755"><span class="linenos">755</span></a>
</span><span id="Helper.export_project-756"><a href="#Helper.export_project-756"><span class="linenos">756</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper.export_project-757"><a href="#Helper.export_project-757"><span class="linenos">757</span></a>        <span class="n">input_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;projects&#39;</span><span class="p">,</span> <span class="n">project_folder</span><span class="p">,</span> <span class="n">texfile</span><span class="p">)</span>
</span><span id="Helper.export_project-758"><a href="#Helper.export_project-758"><span class="linenos">758</span></a>        
</span><span id="Helper.export_project-759"><a href="#Helper.export_project-759"><span class="linenos">759</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.export_project-760"><a href="#Helper.export_project-760"><span class="linenos">760</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.export_project-761"><a href="#Helper.export_project-761"><span class="linenos">761</span></a>
</span><span id="Helper.export_project-762"><a href="#Helper.export_project-762"><span class="linenos">762</span></a>                <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">transclude(\[[^]]+\]+)?\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.export_project-763"><a href="#Helper.export_project-763"><span class="linenos">763</span></a>                <span class="n">external_documents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">transclude(\[([^]]+)\])?\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper.export_project-764"><a href="#Helper.export_project-764"><span class="linenos">764</span></a>                <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">external_documents</span><span class="p">:</span>
</span><span id="Helper.export_project-765"><a href="#Helper.export_project-765"><span class="linenos">765</span></a>                    <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Helper.export_project-766"><a href="#Helper.export_project-766"><span class="linenos">766</span></a>                    <span class="n">document</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span id="Helper.export_project-767"><a href="#Helper.export_project-767"><span class="linenos">767</span></a>                    <span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.export_project-768"><a href="#Helper.export_project-768"><span class="linenos">768</span></a>                        <span class="n">tag</span> <span class="o">=</span> <span class="s1">&#39;note&#39;</span>
</span><span id="Helper.export_project-769"><a href="#Helper.export_project-769"><span class="linenos">769</span></a>
</span><span id="Helper.export_project-770"><a href="#Helper.export_project-770"><span class="linenos">770</span></a>                    <span class="n">note_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;notes&#39;</span><span class="p">,</span> <span class="s1">&#39;slipbox&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">document</span><span class="si">}</span><span class="s1">.tex&#39;</span><span class="p">)</span>
</span><span id="Helper.export_project-771"><a href="#Helper.export_project-771"><span class="linenos">771</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">note_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
</span><span id="Helper.export_project-772"><a href="#Helper.export_project-772"><span class="linenos">772</span></a>                        <span class="n">full_document</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> 
</span><span id="Helper.export_project-773"><a href="#Helper.export_project-773"><span class="linenos">773</span></a>                        <span class="n">import_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%&lt;\*</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;((.|</span><span class="se">\n</span><span class="s1">)*?)%&lt;/</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">full_document</span><span class="p">)</span>
</span><span id="Helper.export_project-774"><a href="#Helper.export_project-774"><span class="linenos">774</span></a>                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">import_text</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.export_project-775"><a href="#Helper.export_project-775"><span class="linenos">775</span></a>
</span><span id="Helper.export_project-776"><a href="#Helper.export_project-776"><span class="linenos">776</span></a>        <span class="n">out_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">texfile</span><span class="p">)</span>
</span><span id="Helper.export_project-777"><a href="#Helper.export_project-777"><span class="linenos">777</span></a>
</span><span id="Helper.export_project-778"><a href="#Helper.export_project-778"><span class="linenos">778</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.export_project-779"><a href="#Helper.export_project-779"><span class="linenos">779</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Replaces \transclude calls in a project file with the contents of the notes. Output is saved in project_dir/standalone</p>
</div>


                            </div>
                            <div id="Helper.export_draft" class="classattr">
                                        <input id="Helper.export_draft-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">export_draft</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">input_file</span>, </span><span class="param"><span class="n">output_file</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.export_draft-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.export_draft"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.export_draft-781"><a href="#Helper.export_draft-781"><span class="linenos">781</span></a>    <span class="k">def</span> <span class="nf">export_draft</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Helper.export_draft-782"><a href="#Helper.export_draft-782"><span class="linenos">782</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Helper.export_draft-783"><a href="#Helper.export_draft-783"><span class="linenos">783</span></a><span class="sd">            Exports the export input_file (a file like /export/example.tex containing \ExecuteMetaData calls) and creates a .tex file (by default in /draft/filename.tex) where the \ExecuteMetadata commands are replaced with the body of the notes that they reference.</span>
</span><span id="Helper.export_draft-784"><a href="#Helper.export_draft-784"><span class="linenos">784</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Helper.export_draft-785"><a href="#Helper.export_draft-785"><span class="linenos">785</span></a>        <span class="k">if</span> <span class="n">output_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Helper.export_draft-786"><a href="#Helper.export_draft-786"><span class="linenos">786</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="Helper.export_draft-787"><a href="#Helper.export_draft-787"><span class="linenos">787</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">)</span>
</span><span id="Helper.export_draft-788"><a href="#Helper.export_draft-788"><span class="linenos">788</span></a>            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="Helper.export_draft-789"><a href="#Helper.export_draft-789"><span class="linenos">789</span></a>                <span class="k">pass</span>
</span><span id="Helper.export_draft-790"><a href="#Helper.export_draft-790"><span class="linenos">790</span></a>            <span class="n">filename</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Helper.export_draft-791"><a href="#Helper.export_draft-791"><span class="linenos">791</span></a>            <span class="n">output_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;draft/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="Helper.export_draft-792"><a href="#Helper.export_draft-792"><span class="linenos">792</span></a>
</span><span id="Helper.export_draft-793"><a href="#Helper.export_draft-793"><span class="linenos">793</span></a>        <span class="n">output</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>
</span><span id="Helper.export_draft-794"><a href="#Helper.export_draft-794"><span class="linenos">794</span></a>    
</span><span id="Helper.export_draft-795"><a href="#Helper.export_draft-795"><span class="linenos">795</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.export_draft-796"><a href="#Helper.export_draft-796"><span class="linenos">796</span></a>            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.export_draft-797"><a href="#Helper.export_draft-797"><span class="linenos">797</span></a>                <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ExecuteMetaData\[\.\./([^]]+)\]\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.export_draft-798"><a href="#Helper.export_draft-798"><span class="linenos">798</span></a>                <span class="n">external_documents</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">ExecuteMetaData\[\.\./([^]]+)\]\{([^}]+)\}&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
</span><span id="Helper.export_draft-799"><a href="#Helper.export_draft-799"><span class="linenos">799</span></a>                <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">external_documents</span><span class="p">:</span>
</span><span id="Helper.export_draft-800"><a href="#Helper.export_draft-800"><span class="linenos">800</span></a>                    <span class="n">import_file</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> 
</span><span id="Helper.export_draft-801"><a href="#Helper.export_draft-801"><span class="linenos">801</span></a>                    <span class="n">tag</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Helper.export_draft-802"><a href="#Helper.export_draft-802"><span class="linenos">802</span></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">import_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
</span><span id="Helper.export_draft-803"><a href="#Helper.export_draft-803"><span class="linenos">803</span></a>                        <span class="n">import_text_file</span> <span class="o">=</span> <span class="n">in_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="Helper.export_draft-804"><a href="#Helper.export_draft-804"><span class="linenos">804</span></a>                        <span class="n">import_text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;%&lt;\*</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;((.|</span><span class="se">\n</span><span class="s1">)*?)%&lt;/</span><span class="si">{</span><span class="n">tag</span><span class="si">}</span><span class="s1">&gt;&#39;</span><span class="p">,</span> <span class="n">import_text_file</span><span class="p">)</span>
</span><span id="Helper.export_draft-805"><a href="#Helper.export_draft-805"><span class="linenos">805</span></a>                        <span class="n">output</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">import_text</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
</span><span id="Helper.export_draft-806"><a href="#Helper.export_draft-806"><span class="linenos">806</span></a>
</span><span id="Helper.export_draft-807"><a href="#Helper.export_draft-807"><span class="linenos">807</span></a>
</span><span id="Helper.export_draft-808"><a href="#Helper.export_draft-808"><span class="linenos">808</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Helper.export_draft-809"><a href="#Helper.export_draft-809"><span class="linenos">809</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Exports the export input_file (a file like /export/example.tex containing \ExecuteMetaData calls) and creates a .tex file (by default in /draft/filename.tex) where the \ExecuteMetadata commands are replaced with the body of the notes that they reference.</p>
</div>


                            </div>
                            <div id="Helper.list_citations" class="classattr">
                                        <input id="Helper.list_citations-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list_citations</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">filename</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Helper.list_citations-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Helper.list_citations"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Helper.list_citations-928"><a href="#Helper.list_citations-928"><span class="linenos">928</span></a>    <span class="k">def</span> <span class="nf">list_citations</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span><span id="Helper.list_citations-929"><a href="#Helper.list_citations-929"><span class="linenos">929</span></a>        <span class="n">Helper</span><span class="o">.</span><span class="n">__getcitations</span><span class="p">(</span><span class="n">database</span><span class="o">.</span><span class="n">Note</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">args</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-1015"><a href="#main-1015"><span class="linenos">1015</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span id="main-1016"><a href="#main-1016"><span class="linenos">1016</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="main-1017"><a href="#main-1017"><span class="linenos">1017</span></a><span class="sd">        </span>
</span><span id="main-1018"><a href="#main-1018"><span class="linenos">1018</span></a><span class="sd">        Execute the helper functions from the command line.</span>
</span><span id="main-1019"><a href="#main-1019"><span class="linenos">1019</span></a>
</span><span id="main-1020"><a href="#main-1020"><span class="linenos">1020</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="main-1021"><a href="#main-1021"><span class="linenos">1021</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="main-1022"><a href="#main-1022"><span class="linenos">1022</span></a>        <span class="n">func</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="main-1023"><a href="#main-1023"><span class="linenos">1023</span></a>    <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span id="main-1024"><a href="#main-1024"><span class="linenos">1024</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No argument passed, try &#39;</span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> help&#39;&quot;</span><span class="p">)</span>
</span><span id="main-1025"><a href="#main-1025"><span class="linenos">1025</span></a>        <span class="k">return</span>
</span><span id="main-1026"><a href="#main-1026"><span class="linenos">1026</span></a>
</span><span id="main-1027"><a href="#main-1027"><span class="linenos">1027</span></a>    <span class="k">try</span><span class="p">:</span> 
</span><span id="main-1028"><a href="#main-1028"><span class="linenos">1028</span></a>        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">Helper</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
</span><span id="main-1029"><a href="#main-1029"><span class="linenos">1029</span></a>    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
</span><span id="main-1030"><a href="#main-1030"><span class="linenos">1030</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unregognised command </span><span class="si">{</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">, try &#39;help&#39; for a list of availlable commands&quot;</span><span class="p">)</span>
</span><span id="main-1031"><a href="#main-1031"><span class="linenos">1031</span></a>
</span><span id="main-1032"><a href="#main-1032"><span class="linenos">1032</span></a>    <span class="n">function</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
</span></pre></div>


            <div class="docstring"><p>Execute the helper functions from the command line.</p>
</div>


                </section>
    </main>
</body>
</html>